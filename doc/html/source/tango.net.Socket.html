<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="style.css" type="text/css" />
		<title>net/Socket.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span>
<span>72</span>
<span>73</span>
<span>74</span>
<span>75</span>
<span>76</span>
<span>77</span>
<span>78</span>
<span>79</span>
<span>80</span>
<span>81</span>
<span>82</span>
<span>83</span>
<span>84</span>
<span>85</span>
<span>86</span>
<span>87</span>
<span>88</span>
<span>89</span>
<span>90</span>
<span>91</span>
<span>92</span>
<span>93</span>
<span>94</span>
<span>95</span>
<span>96</span>
<span>97</span>
<span>98</span>
<span>99</span>
<span>100</span>
<span>101</span>
<span>102</span>
<span>103</span>
<span>104</span>
<span>105</span>
<span>106</span>
<span>107</span>
<span>108</span>
<span>109</span>
<span>110</span>
<span>111</span>
<span>112</span>
<span>113</span>
<span>114</span>
<span>115</span>
<span>116</span>
<span>117</span>
<span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
<span>139</span>
<span>140</span>
<span>141</span>
<span>142</span>
<span>143</span>
<span>144</span>
<span>145</span>
<span>146</span>
<span>147</span>
<span>148</span>
<span>149</span>
<span>150</span>
<span>151</span>
<span>152</span>
<span>153</span>
<span>154</span>
<span>155</span>
<span>156</span>
<span>157</span>
<span>158</span>
<span>159</span>
<span>160</span>
<span>161</span>
<span>162</span>
<span>163</span>
<span>164</span>
<span>165</span>
<span>166</span>
<span>167</span>
<span>168</span>
<span>169</span>
<span>170</span>
<span>171</span>
<span>172</span>
<span>173</span>
<span>174</span>
<span>175</span>
<span>176</span>
<span>177</span>
<span>178</span>
<span>179</span>
<span>180</span>
<span>181</span>
<span>182</span>
<span>183</span>
<span>184</span>
<span>185</span>
<span>186</span>
<span>187</span>
<span>188</span>
<span>189</span>
<span>190</span>
<span>191</span>
<span>192</span>
<span>193</span>
<span>194</span>
<span>195</span>
<span>196</span>
<span>197</span>
<span>198</span>
<span>199</span>
<span>200</span>
<span>201</span>
<span>202</span>
<span>203</span>
<span>204</span>
<span>205</span>
<span>206</span>
<span>207</span>
<span>208</span>
<span>209</span>
<span>210</span>
<span>211</span>
<span>212</span>
<span>213</span>
<span>214</span>
<span>215</span>
<span>216</span>
<span>217</span>
<span>218</span>
<span>219</span>
<span>220</span>
<span>221</span>
<span>222</span>
<span>223</span>
<span>224</span>
<span>225</span>
<span>226</span>
<span>227</span>
<span>228</span>
<span>229</span>
<span>230</span>
<span>231</span>
<span>232</span>
<span>233</span>
<span>234</span>
<span>235</span>
<span>236</span>
<span>237</span>
<span>238</span>
<span>239</span>
<span>240</span>
<span>241</span>
<span>242</span>
<span>243</span>
<span>244</span>
<span>245</span>
<span>246</span>
<span>247</span>
<span>248</span>
<span>249</span>
<span>250</span>
<span>251</span>
<span>252</span>
<span>253</span>
<span>254</span>
<span>255</span>
<span>256</span>
<span>257</span>
<span>258</span>
<span>259</span>
<span>260</span>
<span>261</span>
<span>262</span>
<span>263</span>
<span>264</span>
<span>265</span>
<span>266</span>
<span>267</span>
<span>268</span>
<span>269</span>
<span>270</span>
<span>271</span>
<span>272</span>
<span>273</span>
<span>274</span>
<span>275</span>
<span>276</span>
<span>277</span>
<span>278</span>
<span>279</span>
<span>280</span>
<span>281</span>
<span>282</span>
<span>283</span>
<span>284</span>
<span>285</span>
<span>286</span>
<span>287</span>
<span>288</span>
<span>289</span>
<span>290</span>
<span>291</span>
<span>292</span>
<span>293</span>
<span>294</span>
<span>295</span>
<span>296</span>
<span>297</span>
<span>298</span>
<span>299</span>
<span>300</span>
<span>301</span>
<span>302</span>
<span>303</span>
<span>304</span>
<span>305</span>
<span>306</span>
<span>307</span>
<span>308</span>
<span>309</span>
<span>310</span>
<span>311</span>
<span>312</span>
<span>313</span>
<span>314</span>
<span>315</span>
<span>316</span>
<span>317</span>
<span>318</span>
<span>319</span>
<span>320</span>
<span>321</span>
<span>322</span>
<span>323</span>
<span>324</span>
<span>325</span>
<span>326</span>
<span>327</span>
<span>328</span>
<span>329</span>
<span>330</span>
<span>331</span>
<span>332</span>
<span>333</span>
<span>334</span>
<span>335</span>
<span>336</span>
<span>337</span>
<span>338</span>
<span>339</span>
<span>340</span>
<span>341</span>
<span>342</span>
<span>343</span>
<span>344</span>
<span>345</span>
<span>346</span>
<span>347</span>
<span>348</span>
<span>349</span>
<span>350</span>
<span>351</span>
<span>352</span>
<span>353</span>
<span>354</span>
<span>355</span>
<span>356</span>
<span>357</span>
<span>358</span>
<span>359</span>
<span>360</span>
<span>361</span>
<span>362</span>
<span>363</span>
<span>364</span>
<span>365</span>
<span>366</span>
<span>367</span>
<span>368</span>
<span>369</span>
<span>370</span>
<span>371</span>
<span>372</span>
<span>373</span>
<span>374</span>
<span>375</span>
<span>376</span>
<span>377</span>
<span>378</span>
<span>379</span>
<span>380</span>
<span>381</span>
<span>382</span>
<span>383</span>
<span>384</span>
<span>385</span>
<span>386</span>
<span>387</span>
<span>388</span>
<span>389</span>
<span>390</span>
<span>391</span>
<span>392</span>
<span>393</span>
<span>394</span>
<span>395</span>
<span>396</span>
<span>397</span>
<span>398</span>
<span>399</span>
<span>400</span>
<span>401</span>
<span>402</span>
<span>403</span>
<span>404</span>
<span>405</span>
<span>406</span>
<span>407</span>
<span>408</span>
<span>409</span>
<span>410</span>
<span>411</span>
<span>412</span>
<span>413</span>
<span>414</span>
<span>415</span>
<span>416</span>
<span>417</span>
<span>418</span>
<span>419</span>
<span>420</span>
<span>421</span>
<span>422</span>
<span>423</span>
<span>424</span>
<span>425</span>
<span>426</span>
<span>427</span>
<span>428</span>
<span>429</span>
<span>430</span>
<span>431</span>
<span>432</span>
<span>433</span>
<span>434</span>
<span>435</span>
<span>436</span>
<span>437</span>
<span>438</span>
<span>439</span>
<span>440</span>
<span>441</span>
<span>442</span>
<span>443</span>
<span>444</span>
<span>445</span>
<span>446</span>
<span>447</span>
<span>448</span>
<span>449</span>
<span>450</span>
<span>451</span>
<span>452</span>
<span>453</span>
<span>454</span>
<span>455</span>
<span>456</span>
<span>457</span>
<span>458</span>
<span>459</span>
<span>460</span>
<span>461</span>
<span>462</span>
<span>463</span>
<span>464</span>
<span>465</span>
<span>466</span>
<span>467</span>
<span>468</span>
<span>469</span>
<span>470</span>
<span>471</span>
<span>472</span>
<span>473</span>
<span>474</span>
<span>475</span>
<span>476</span>
<span>477</span>
<span>478</span>
<span>479</span>
<span>480</span>
<span>481</span>
<span>482</span>
<span>483</span>
<span>484</span>
<span>485</span>
<span>486</span>
<span>487</span>
<span>488</span>
<span>489</span>
<span>490</span>
<span>491</span>
<span>492</span>
<span>493</span>
<span>494</span>
<span>495</span>
<span>496</span>
<span>497</span>
<span>498</span>
<span>499</span>
<span>500</span>
<span>501</span>
<span>502</span>
<span>503</span>
<span>504</span>
<span>505</span>
<span>506</span>
<span>507</span>
<span>508</span>
<span>509</span>
<span>510</span>
<span>511</span>
<span>512</span>
<span>513</span>
<span>514</span>
<span>515</span>
<span>516</span>
<span>517</span>
<span>518</span>
<span>519</span>
<span>520</span>
<span>521</span>
<span>522</span>
<span>523</span>
<span>524</span>
<span>525</span>
<span>526</span>
<span>527</span>
<span>528</span>
<span>529</span>
<span>530</span>
<span>531</span>
<span>532</span>
<span>533</span>
<span>534</span>
<span>535</span>
<span>536</span>
<span>537</span>
<span>538</span>
<span>539</span>
<span>540</span>
<span>541</span>
<span>542</span>
<span>543</span>
<span>544</span>
<span>545</span>
<span>546</span>
<span>547</span>
<span>548</span>
<span>549</span>
<span>550</span>
<span>551</span>
<span>552</span>
<span>553</span>
<span>554</span>
<span>555</span>
<span>556</span>
<span>557</span>
<span>558</span>
<span>559</span>
<span>560</span>
<span>561</span>
<span>562</span>
<span>563</span>
<span>564</span>
<span>565</span>
<span>566</span>
<span>567</span>
<span>568</span>
<span>569</span>
<span>570</span>
<span>571</span>
<span>572</span>
<span>573</span>
<span>574</span>
<span>575</span>
<span>576</span>
<span>577</span>
<span>578</span>
<span>579</span>
<span>580</span>
<span>581</span>
<span>582</span>
<span>583</span>
<span>584</span>
<span>585</span>
<span>586</span>
<span>587</span>
<span>588</span>
<span>589</span>
<span>590</span>
<span>591</span>
<span>592</span>
<span>593</span>
<span>594</span>
<span>595</span>
<span>596</span>
<span>597</span>
<span>598</span>
<span>599</span>
<span>600</span>
<span>601</span>
<span>602</span>
<span>603</span>
<span>604</span>
<span>605</span>
<span>606</span>
<span>607</span>
<span>608</span>
<span>609</span>
<span>610</span>
<span>611</span>
<span>612</span>
<span>613</span>
<span>614</span>
<span>615</span>
<span>616</span>
<span>617</span>
<span>618</span>
<span>619</span>
<span>620</span>
<span>621</span>
<span>622</span>
<span>623</span>
<span>624</span>
<span>625</span>
<span>626</span>
<span>627</span>
<span>628</span>
<span>629</span>
<span>630</span>
<span>631</span>
<span>632</span>
<span>633</span>
<span>634</span>
<span>635</span>
<span>636</span>
<span>637</span>
<span>638</span>
<span>639</span>
<span>640</span>
<span>641</span>
<span>642</span>
<span>643</span>
<span>644</span>
<span>645</span>
<span>646</span>
<span>647</span>
<span>648</span>
<span>649</span>
<span>650</span>
<span>651</span>
<span>652</span>
<span>653</span>
<span>654</span>
<span>655</span>
<span>656</span>
<span>657</span>
<span>658</span>
<span>659</span>
<span>660</span>
<span>661</span>
<span>662</span>
<span>663</span>
<span>664</span>
<span>665</span>
<span>666</span>
<span>667</span>
<span>668</span>
<span>669</span>
<span>670</span>
<span>671</span>
<span>672</span>
<span>673</span>
<span>674</span>
<span>675</span>
<span>676</span>
<span>677</span>
<span>678</span>
<span>679</span>
<span>680</span>
<span>681</span>
<span>682</span>
<span>683</span>
<span>684</span>
<span>685</span>
<span>686</span>
<span>687</span>
<span>688</span>
<span>689</span>
<span>690</span>
<span>691</span>
<span>692</span>
<span>693</span>
<span>694</span>
<span>695</span>
<span>696</span>
<span>697</span>
<span>698</span>
<span>699</span>
<span>700</span>
<span>701</span>
<span>702</span>
<span>703</span>
<span>704</span>
<span>705</span>
<span>706</span>
<span>707</span>
<span>708</span>
<span>709</span>
<span>710</span>
<span>711</span>
<span>712</span>
<span>713</span>
<span>714</span>
<span>715</span>
<span>716</span>
<span>717</span>
<span>718</span>
<span>719</span>
<span>720</span>
<span>721</span>
<span>722</span>
<span>723</span>
<span>724</span>
<span>725</span>
<span>726</span>
<span>727</span>
<span>728</span>
<span>729</span>
<span>730</span>
<span>731</span>
<span>732</span>
<span>733</span>
<span>734</span>
<span>735</span>
<span>736</span>
<span>737</span>
<span>738</span>
<span>739</span>
<span>740</span>
<span>741</span>
<span>742</span>
<span>743</span>
<span>744</span>
<span>745</span>
<span>746</span>
<span>747</span>
<span>748</span>
<span>749</span>
<span>750</span>
<span>751</span>
<span>752</span>
<span>753</span>
<span>754</span>
<span>755</span>
<span>756</span>
<span>757</span>
<span>758</span>
<span>759</span>
<span>760</span>
<span>761</span>
<span>762</span>
<span>763</span>
<span>764</span>
<span>765</span>
<span>766</span>
<span>767</span>
<span>768</span>
<span>769</span>
<span>770</span>
<span>771</span>
<span>772</span>
<span>773</span>
<span>774</span>
<span>775</span>
<span>776</span>
<span>777</span>
<span>778</span>
<span>779</span>
<span>780</span>
<span>781</span>
<span>782</span>
<span>783</span>
<span>784</span>
<span>785</span>
<span>786</span>
<span>787</span>
<span>788</span>
<span>789</span>
<span>790</span>
<span>791</span>
<span>792</span>
<span>793</span>
<span>794</span>
<span>795</span>
<span>796</span>
<span>797</span>
<span>798</span>
<span>799</span>
<span>800</span>
<span>801</span>
<span>802</span>
<span>803</span>
<span>804</span>
<span>805</span>
<span>806</span>
<span>807</span>
<span>808</span>
<span>809</span>
<span>810</span>
<span>811</span>
<span>812</span>
<span>813</span>
<span>814</span>
<span>815</span>
<span>816</span>
<span>817</span>
<span>818</span>
<span>819</span>
<span>820</span>
<span>821</span>
<span>822</span>
<span>823</span>
<span>824</span>
<span>825</span>
<span>826</span>
<span>827</span>
<span>828</span>
<span>829</span>
<span>830</span>
<span>831</span>
<span>832</span>
<span>833</span>
<span>834</span>
<span>835</span>
<span>836</span>
<span>837</span>
<span>838</span>
<span>839</span>
<span>840</span>
<span>841</span>
<span>842</span>
<span>843</span>
<span>844</span>
<span>845</span>
<span>846</span>
<span>847</span>
<span>848</span>
<span>849</span>
<span>850</span>
<span>851</span>
<span>852</span>
<span>853</span>
<span>854</span>
<span>855</span>
<span>856</span>
<span>857</span>
<span>858</span>
<span>859</span>
<span>860</span>
<span>861</span>
<span>862</span>
<span>863</span>
<span>864</span>
<span>865</span>
<span>866</span>
<span>867</span>
<span>868</span>
<span>869</span>
<span>870</span>
<span>871</span>
<span>872</span>
<span>873</span>
<span>874</span>
<span>875</span>
<span>876</span>
<span>877</span>
<span>878</span>
<span>879</span>
<span>880</span>
<span>881</span>
<span>882</span>
<span>883</span>
<span>884</span>
<span>885</span>
<span>886</span>
<span>887</span>
<span>888</span>
<span>889</span>
<span>890</span>
<span>891</span>
<span>892</span>
<span>893</span>
<span>894</span>
<span>895</span>
<span>896</span>
<span>897</span>
<span>898</span>
<span>899</span>
<span>900</span>
<span>901</span>
<span>902</span>
<span>903</span>
<span>904</span>
<span>905</span>
<span>906</span>
<span>907</span>
<span>908</span>
<span>909</span>
<span>910</span>
<span>911</span>
<span>912</span>
<span>913</span>
<span>914</span>
<span>915</span>
<span>916</span>
<span>917</span>
<span>918</span>
<span>919</span>
<span>920</span>
<span>921</span>
<span>922</span>
<span>923</span>
<span>924</span>
<span>925</span>
<span>926</span>
<span>927</span>
<span>928</span>
<span>929</span>
<span>930</span>
<span>931</span>
<span>932</span>
<span>933</span>
<span>934</span>
<span>935</span>
<span>936</span>
<span>937</span>
<span>938</span>
<span>939</span>
<span>940</span>
<span>941</span>
<span>942</span>
<span>943</span>
<span>944</span>
<span>945</span>
<span>946</span>
<span>947</span>
<span>948</span>
<span>949</span>
<span>950</span>
<span>951</span>
<span>952</span>
<span>953</span>
<span>954</span>
<span>955</span>
<span>956</span>
<span>957</span>
<span>958</span>
<span>959</span>
<span>960</span>
<span>961</span>
<span>962</span>
<span>963</span>
<span>964</span>
<span>965</span>
<span>966</span>
<span>967</span>
<span>968</span>
<span>969</span>
<span>970</span>
<span>971</span>
<span>972</span>
<span>973</span>
<span>974</span>
<span>975</span>
<span>976</span>
<span>977</span>
<span>978</span>
<span>979</span>
<span>980</span>
<span>981</span>
<span>982</span>
<span>983</span>
<span>984</span>
<span>985</span>
<span>986</span>
<span>987</span>
<span>988</span>
<span>989</span>
<span>990</span>
<span>991</span>
<span>992</span>
<span>993</span>
<span>994</span>
<span>995</span>
<span>996</span>
<span>997</span>
<span>998</span>
<span>999</span>
<span>1000</span>
<span>1001</span>
<span>1002</span>
<span>1003</span>
<span>1004</span>
<span>1005</span>
<span>1006</span>
<span>1007</span>
<span>1008</span>
<span>1009</span>
<span>1010</span>
<span>1011</span>
<span>1012</span>
<span>1013</span>
<span>1014</span>
<span>1015</span>
<span>1016</span>
<span>1017</span>
<span>1018</span>
<span>1019</span>
<span>1020</span>
<span>1021</span>
<span>1022</span>
<span>1023</span>
<span>1024</span>
<span>1025</span>
<span>1026</span>
<span>1027</span>
<span>1028</span>
<span>1029</span>
<span>1030</span>
<span>1031</span>
<span>1032</span>
<span>1033</span>
<span>1034</span>
<span>1035</span>
<span>1036</span>
<span>1037</span>
<span>1038</span>
<span>1039</span>
<span>1040</span>
<span>1041</span>
<span>1042</span>
<span>1043</span>
<span>1044</span>
<span>1045</span>
<span>1046</span>
<span>1047</span>
<span>1048</span>
<span>1049</span>
<span>1050</span>
<span>1051</span>
<span>1052</span>
<span>1053</span>
<span>1054</span>
<span>1055</span>
<span>1056</span>
<span>1057</span>
<span>1058</span>
<span>1059</span>
<span>1060</span>
<span>1061</span>
<span>1062</span>
<span>1063</span>
<span>1064</span>
<span>1065</span>
<span>1066</span>
<span>1067</span>
<span>1068</span>
<span>1069</span>
<span>1070</span>
<span>1071</span>
<span>1072</span>
<span>1073</span>
<span>1074</span>
<span>1075</span>
<span>1076</span>
<span>1077</span>
<span>1078</span>
<span>1079</span>
<span>1080</span>
<span>1081</span>
<span>1082</span>
<span>1083</span>
<span>1084</span>
<span>1085</span>
<span>1086</span>
<span>1087</span>
<span>1088</span>
<span>1089</span>
<span>1090</span>
<span>1091</span>
<span>1092</span>
<span>1093</span>
<span>1094</span>
<span>1095</span>
<span>1096</span>
<span>1097</span>
<span>1098</span>
<span>1099</span>
<span>1100</span>
<span>1101</span>
<span>1102</span>
<span>1103</span>
<span>1104</span>
<span>1105</span>
<span>1106</span>
<span>1107</span>
<span>1108</span>
<span>1109</span>
<span>1110</span>
<span>1111</span>
<span>1112</span>
<span>1113</span>
<span>1114</span>
<span>1115</span>
<span>1116</span>
<span>1117</span>
<span>1118</span>
<span>1119</span>
<span>1120</span>
<span>1121</span>
<span>1122</span>
<span>1123</span>
<span>1124</span>
<span>1125</span>
<span>1126</span>
<span>1127</span>
<span>1128</span>
<span>1129</span>
<span>1130</span>
<span>1131</span>
<span>1132</span>
<span>1133</span>
<span>1134</span>
<span>1135</span>
<span>1136</span>
<span>1137</span>
<span>1138</span>
<span>1139</span>
<span>1140</span>
<span>1141</span>
<span>1142</span>
<span>1143</span>
<span>1144</span>
<span>1145</span>
<span>1146</span>
<span>1147</span>
<span>1148</span>
<span>1149</span>
<span>1150</span>
<span>1151</span>
<span>1152</span>
<span>1153</span>
<span>1154</span>
<span>1155</span>
<span>1156</span>
<span>1157</span>
<span>1158</span>
<span>1159</span>
<span>1160</span>
<span>1161</span>
<span>1162</span>
<span>1163</span>
<span>1164</span>
<span>1165</span>
<span>1166</span>
<span>1167</span>
<span>1168</span>
<span>1169</span>
<span>1170</span>
<span>1171</span>
<span>1172</span>
<span>1173</span>
<span>1174</span>
<span>1175</span>
<span>1176</span>
<span>1177</span>
<span>1178</span>
<span>1179</span>
<span>1180</span>
<span>1181</span>
<span>1182</span>
<span>1183</span>
<span>1184</span>
<span>1185</span>
<span>1186</span>
<span>1187</span>
<span>1188</span>
<span>1189</span>
<span>1190</span>
<span>1191</span>
<span>1192</span>
<span>1193</span>
<span>1194</span>
<span>1195</span>
<span>1196</span>
<span>1197</span>
<span>1198</span>
<span>1199</span>
<span>1200</span>
<span>1201</span>
<span>1202</span>
<span>1203</span>
<span>1204</span>
<span>1205</span>
<span>1206</span>
<span>1207</span>
<span>1208</span>
<span>1209</span>
<span>1210</span>
<span>1211</span>
<span>1212</span>
<span>1213</span>
<span>1214</span>
<span>1215</span>
<span>1216</span>
<span>1217</span>
<span>1218</span>
<span>1219</span>
<span>1220</span>
<span>1221</span>
<span>1222</span>
<span>1223</span>
<span>1224</span>
<span>1225</span>
<span>1226</span>
<span>1227</span>
<span>1228</span>
<span>1229</span>
<span>1230</span>
<span>1231</span>
<span>1232</span>
<span>1233</span>
<span>1234</span>
<span>1235</span>
<span>1236</span>
<span>1237</span>
<span>1238</span>
<span>1239</span>
<span>1240</span>
<span>1241</span>
<span>1242</span>
<span>1243</span>
<span>1244</span>
<span>1245</span>
<span>1246</span>
<span>1247</span>
<span>1248</span>
<span>1249</span>
<span>1250</span>
<span>1251</span>
<span>1252</span>
<span>1253</span>
<span>1254</span>
<span>1255</span>
<span>1256</span>
<span>1257</span>
<span>1258</span>
<span>1259</span>
<span>1260</span>
<span>1261</span>
<span>1262</span>
<span>1263</span>
<span>1264</span>
<span>1265</span>
<span>1266</span>
<span>1267</span>
<span>1268</span>
<span>1269</span>
<span>1270</span>
<span>1271</span>
<span>1272</span>
<span>1273</span>
<span>1274</span>
<span>1275</span>
<span>1276</span>
<span>1277</span>
<span>1278</span>
<span>1279</span>
<span>1280</span>
<span>1281</span>
<span>1282</span>
<span>1283</span>
<span>1284</span>
<span>1285</span>
<span>1286</span>
<span>1287</span>
<span>1288</span>
<span>1289</span>
<span>1290</span>
<span>1291</span>
<span>1292</span>
<span>1293</span>
<span>1294</span>
<span>1295</span>
<span>1296</span>
<span>1297</span>
<span>1298</span>
<span>1299</span>
<span>1300</span>
<span>1301</span>
<span>1302</span>
<span>1303</span>
<span>1304</span>
<span>1305</span>
<span>1306</span>
<span>1307</span>
<span>1308</span>
<span>1309</span>
<span>1310</span>
<span>1311</span>
<span>1312</span>
<span>1313</span>
<span>1314</span>
<span>1315</span>
<span>1316</span>
<span>1317</span>
<span>1318</span>
<span>1319</span>
<span>1320</span>
<span>1321</span>
<span>1322</span>
<span>1323</span>
<span>1324</span>
<span>1325</span>
<span>1326</span>
<span>1327</span>
<span>1328</span>
<span>1329</span>
<span>1330</span>
<span>1331</span>
<span>1332</span>
<span>1333</span>
<span>1334</span>
<span>1335</span>
<span>1336</span>
<span>1337</span>
<span>1338</span>
<span>1339</span>
<span>1340</span>
<span>1341</span>
<span>1342</span>
<span>1343</span>
<span>1344</span>
<span>1345</span>
<span>1346</span>
<span>1347</span>
<span>1348</span>
<span>1349</span>
<span>1350</span>
<span>1351</span>
<span>1352</span>
<span>1353</span>
<span>1354</span>
<span>1355</span>
<span>1356</span>
<span>1357</span>
<span>1358</span>
<span>1359</span>
<span>1360</span>
<span>1361</span>
<span>1362</span>
<span>1363</span>
<span>1364</span>
<span>1365</span>
<span>1366</span>
<span>1367</span>
<span>1368</span>
<span>1369</span>
<span>1370</span>
<span>1371</span>
<span>1372</span>
<span>1373</span>
<span>1374</span>
<span>1375</span>
<span>1376</span>
<span>1377</span>
<span>1378</span>
<span>1379</span>
<span>1380</span>
<span>1381</span>
<span>1382</span>
<span>1383</span>
<span>1384</span>
<span>1385</span>
<span>1386</span>
<span>1387</span>
<span>1388</span>
<span>1389</span>
<span>1390</span>
<span>1391</span>
<span>1392</span>
<span>1393</span>
<span>1394</span>
<span>1395</span>
<span>1396</span>
<span>1397</span>
<span>1398</span>
<span>1399</span>
<span>1400</span>
<span>1401</span>
<span>1402</span>
<span>1403</span>
<span>1404</span>
<span>1405</span>
<span>1406</span>
<span>1407</span>
<span>1408</span>
<span>1409</span>
<span>1410</span>
<span>1411</span>
<span>1412</span>
<span>1413</span>
<span>1414</span>
<span>1415</span>
<span>1416</span>
<span>1417</span>
<span>1418</span>
<span>1419</span>
<span>1420</span>
<span>1421</span>
<span>1422</span>
<span>1423</span>
<span>1424</span>
<span>1425</span>
<span>1426</span>
<span>1427</span>
<span>1428</span>
<span>1429</span>
<span>1430</span>
<span>1431</span>
<span>1432</span>
<span>1433</span>
<span>1434</span>
<span>1435</span>
<span>1436</span>
<span>1437</span>
<span>1438</span>
<span>1439</span>
<span>1440</span>
<span>1441</span>
<span>1442</span>
<span>1443</span>
<span>1444</span>
<span>1445</span>
<span>1446</span>
<span>1447</span>
<span>1448</span>
<span>1449</span>
<span>1450</span>
<span>1451</span>
<span>1452</span>
<span>1453</span>
<span>1454</span>
<span>1455</span>
<span>1456</span>
<span>1457</span>
<span>1458</span>
<span>1459</span>
<span>1460</span>
<span>1461</span>
<span>1462</span>
<span>1463</span>
<span>1464</span>
<span>1465</span>
<span>1466</span>
<span>1467</span>
<span>1468</span>
<span>1469</span>
<span>1470</span>
<span>1471</span>
<span>1472</span>
<span>1473</span>
<span>1474</span>
<span>1475</span>
<span>1476</span>
<span>1477</span>
<span>1478</span>
<span>1479</span>
<span>1480</span>
<span>1481</span>
<span>1482</span>
<span>1483</span>
<span>1484</span>
<span>1485</span>
<span>1486</span>
<span>1487</span>
<span>1488</span>
<span>1489</span>
<span>1490</span>
<span>1491</span>
<span>1492</span>
<span>1493</span>
<span>1494</span>
<span>1495</span>
<span>1496</span>
<span>1497</span>
<span>1498</span>
<span>1499</span>
<span>1500</span>
<span>1501</span>
<span>1502</span>
<span>1503</span>
<span>1504</span>
<span>1505</span>
<span>1506</span>
<span>1507</span>
<span>1508</span>
<span>1509</span>
<span>1510</span>
<span>1511</span>
<span>1512</span>
<span>1513</span>
<span>1514</span>
<span>1515</span>
<span>1516</span>
<span>1517</span>
<span>1518</span>
<span>1519</span>
<span>1520</span>
<span>1521</span>
<span>1522</span>
<span>1523</span>
<span>1524</span>
<span>1525</span>
<span>1526</span>
<span>1527</span>
<span>1528</span>
<span>1529</span>
<span>1530</span>
<span>1531</span>
<span>1532</span>
<span>1533</span>
<span>1534</span>
<span>1535</span>
<span>1536</span>
<span>1537</span>
<span>1538</span>
<span>1539</span>
<span>1540</span>
<span>1541</span>
<span>1542</span>
<span>1543</span>
<span>1544</span>
<span>1545</span>
<span>1546</span>
<span>1547</span>
<span>1548</span>
<span>1549</span>
<span>1550</span>
<span>1551</span>
<span>1552</span>
<span>1553</span>
<span>1554</span>
<span>1555</span>
<span>1556</span>
<span>1557</span>
<span>1558</span>
<span>1559</span>
<span>1560</span>
<span>1561</span>
<span>1562</span>
<span>1563</span>
<span>1564</span>
<span>1565</span>
<span>1566</span>
<span>1567</span>
<span>1568</span>
<span>1569</span>
<span>1570</span>
<span>1571</span>
<span>1572</span>
<span>1573</span>
<span>1574</span>
<span>1575</span>
<span>1576</span>
<span>1577</span>
<span>1578</span>
<span>1579</span>
<span>1580</span>
<span>1581</span>
<span>1582</span>
<span>1583</span>
<span>1584</span>
<span>1585</span>
<span>1586</span>
<span>1587</span>
<span>1588</span>
<span>1589</span>
<span>1590</span>
<span>1591</span>
<span>1592</span>
<span>1593</span>
<span>1594</span>
<span>1595</span>
<span>1596</span>
<span>1597</span>
<span>1598</span>
<span>1599</span>
<span>1600</span>
<span>1601</span>
<span>1602</span>
<span>1603</span>
<span>1604</span>
<span>1605</span>
<span>1606</span>
<span>1607</span>
<span>1608</span>
<span>1609</span>
<span>1610</span>
<span>1611</span>
<span>1612</span>
<span>1613</span>
<span>1614</span>
<span>1615</span>
<span>1616</span>
<span>1617</span>
<span>1618</span>
<span>1619</span>
<span>1620</span>
<span>1621</span>
<span>1622</span>
<span>1623</span>
<span>1624</span>
<span>1625</span>
<span>1626</span>
<span>1627</span>
<span>1628</span>
<span>1629</span>
<span>1630</span>
<span>1631</span>
<span>1632</span>
<span>1633</span>
<span>1634</span>
<span>1635</span>
<span>1636</span>
<span>1637</span>
<span>1638</span>
<span>1639</span>
<span>1640</span>
<span>1641</span>
<span>1642</span>
<span>1643</span>
<span>1644</span>
<span>1645</span>
<span>1646</span>
<span>1647</span>
<span>1648</span>
<span>1649</span>
<span>1650</span>
<span>1651</span>
<span>1652</span>
<span>1653</span>
<span>1654</span>
<span>1655</span>
<span>1656</span>
<span>1657</span>
<span>1658</span>
<span>1659</span>
<span>1660</span>
<span>1661</span>
<span>1662</span>
<span>1663</span>
<span>1664</span>
<span>1665</span>
<span>1666</span>
<span>1667</span>
<span>1668</span>
<span>1669</span>
<span>1670</span>
<span>1671</span>
<span>1672</span>
<span>1673</span>
<span>1674</span>
<span>1675</span>
<span>1676</span>
<span>1677</span>
<span>1678</span>
<span>1679</span>
<span>1680</span>
<span>1681</span>
<span>1682</span>
<span>1683</span>
<span>1684</span>
<span>1685</span>
<span>1686</span>
<span>1687</span>
<span>1688</span>
<span>1689</span>
<span>1690</span>
<span>1691</span>
<span>1692</span>
<span>1693</span>
<span>1694</span>
<span>1695</span>
<span>1696</span>
<span>1697</span>
<span>1698</span>
<span>1699</span>
<span>1700</span>
<span>1701</span>
<span>1702</span>
<span>1703</span>
<span>1704</span>
<span>1705</span>
<span>1706</span>
<span>1707</span>
<span>1708</span>
<span>1709</span>
<span>1710</span>
<span>1711</span>
<span>1712</span>
<span>1713</span>
<span>1714</span>
<span>1715</span>
<span>1716</span>
<span>1717</span>
<span>1718</span>
<span>1719</span>
<span>1720</span>
<span>1721</span>
<span>1722</span>
<span>1723</span>
<span>1724</span>
<span>1725</span>
<span>1726</span>
<span>1727</span>
<span>1728</span>
<span>1729</span>
<span>1730</span>
<span>1731</span>
<span>1732</span>
<span>1733</span>
<span>1734</span>
<span>1735</span>
<span>1736</span>
<span>1737</span>
<span>1738</span>
<span>1739</span>
<span>1740</span>
<span>1741</span>
<span>1742</span>
<span>1743</span>
<span>1744</span>
<span>1745</span>
<span>1746</span>
<span>1747</span>
<span>1748</span>
<span>1749</span>
<span>1750</span>
<span>1751</span>
<span>1752</span>
<span>1753</span>
<span>1754</span>
<span>1755</span>
<span>1756</span>
<span>1757</span>
<span>1758</span>
<span>1759</span>
<span>1760</span>
<span>1761</span>
<span>1762</span>
<span>1763</span>
<span>1764</span>
<span>1765</span>
<span>1766</span>
<span>1767</span>
<span>1768</span>
<span>1769</span>
<span>1770</span>
<span>1771</span>
<span>1772</span>
<span>1773</span>
<span>1774</span>
<span>1775</span>
<span>1776</span>
<span>1777</span>
<span>1778</span>
<span>1779</span>
<span>1780</span>
<span>1781</span>
<span>1782</span>
<span>1783</span>
<span>1784</span>
<span>1785</span>
<span>1786</span>
<span>1787</span>
<span>1788</span>
<span>1789</span>
<span>1790</span>
<span>1791</span>
<span>1792</span>
<span>1793</span>
<span>1794</span>
<span>1795</span>
<span>1796</span>
<span>1797</span>
<span>1798</span>
<span>1799</span>
<span>1800</span>
<span>1801</span>
<span>1802</span>
<span>1803</span>
<span>1804</span>
<span>1805</span>
<span>1806</span>
<span>1807</span>
<span>1808</span>
<span>1809</span>
<span>1810</span>
<span>1811</span>
<span>1812</span>
<span>1813</span>
<span>1814</span>
<span>1815</span>
<span>1816</span>
<span>1817</span>
<span>1818</span>
<span>1819</span>
<span>1820</span>
<span>1821</span>
<span>1822</span>
<span>1823</span>
<span>1824</span>
<span>1825</span>
<span>1826</span>
<span>1827</span>
<span>1828</span>
<span>1829</span>
<span>1830</span>
<span>1831</span>
<span>1832</span>
<span>1833</span>
<span>1834</span>
<span>1835</span>
<span>1836</span>
<span>1837</span>
<span>1838</span>
<span>1839</span>
<span>1840</span>
<span>1841</span>
<span>1842</span>
<span>1843</span>
<span>1844</span>
<span>1845</span>
<span>1846</span>
<span>1847</span>
<span>1848</span>
<span>1849</span>
<span>1850</span>
<span>1851</span>
<span>1852</span>
<span>1853</span>
<span>1854</span>
<span>1855</span>
<span>1856</span>
<span>1857</span>
<span>1858</span>
<span>1859</span>
<span>1860</span>
<span>1861</span>
<span>1862</span>
<span>1863</span>
<span>1864</span>
<span>1865</span>
<span>1866</span>
<span>1867</span>
<span>1868</span>
<span>1869</span>
<span>1870</span>
<span>1871</span>
<span>1872</span>
<span>1873</span>
<span>1874</span>
<span>1875</span>
<span>1876</span>
<span>1877</span>
<span>1878</span>
<span>1879</span>
<span>1880</span>
<span>1881</span>
<span>1882</span>
<span>1883</span>
<span>1884</span>
<span>1885</span>
<span>1886</span>
<span>1887</span>
<span>1888</span>
<span>1889</span>
<span>1890</span>
<span>1891</span>
<span>1892</span>
<span>1893</span>
<span>1894</span>
<span>1895</span>
<span>1896</span>
<span>1897</span>
<span>1898</span>
<span>1899</span>
<span>1900</span>
<span>1901</span>
<span>1902</span>
<span>1903</span>
<span>1904</span>
<span>1905</span>
<span>1906</span>
<span>1907</span>
<span>1908</span>
<span>1909</span>
<span>1910</span>
<span>1911</span>
<span>1912</span>
<span>1913</span>
<span>1914</span>
<span>1915</span>
<span>1916</span>
<span>1917</span>
<span>1918</span>
<span>1919</span>
<span>1920</span>
<span>1921</span>
<span>1922</span>
<span>1923</span>
<span>1924</span>
<span>1925</span>
<span>1926</span>
<span>1927</span>
<span>1928</span>
<span>1929</span>
<span>1930</span>
<span>1931</span>
<span>1932</span>
<span>1933</span>
<span>1934</span>
<span>1935</span>
<span>1936</span>
<span>1937</span>
<span>1938</span>
<span>1939</span>
<span>1940</span>
<span>1941</span>
<span>1942</span>
<span>1943</span>
<span>1944</span>
<span>1945</span>
<span>1946</span>
<span>1947</span>
<span>1948</span>
<span>1949</span>
<span>1950</span>
<span>1951</span>
<span>1952</span>
<span>1953</span>
<span>1954</span>
<span>1955</span>
<span>1956</span>
<span>1957</span>
<span>1958</span>
<span>1959</span>
<span>1960</span>
<span>1961</span>
<span>1962</span>
<span>1963</span>
<span>1964</span>
<span>1965</span>
<span>1966</span>
<span>1967</span>
<span>1968</span>
<span>1969</span>
<span>1970</span>
<span>1971</span>
<span>1972</span>
<span>1973</span>
<span>1974</span>
<span>1975</span>
<span>1976</span>
<span>1977</span>
<span>1978</span>
<span>1979</span>
<span>1980</span>
<span>1981</span>
<span>1982</span>
<span>1983</span>
<span>1984</span>
<span>1985</span>
<span>1986</span>
<span>1987</span>
<span>1988</span>
<span>1989</span>
<span>1990</span>
<span>1991</span>
<span>1992</span>
<span>1993</span>
<span>1994</span>
<span>1995</span>
<span>1996</span>
<span>1997</span>
<span>1998</span>
<span>1999</span>
<span>2000</span>
<span>2001</span>
<span>2002</span>
<span>2003</span>
<span>2004</span>
<span>2005</span>
<span>2006</span>
<span>2007</span>
<span>2008</span>
<span>2009</span>
<span>2010</span>
<span>2011</span>
<span>2012</span>
<span>2013</span>
<span>2014</span>
<span>2015</span>
<span>2016</span>
<span>2017</span>
<span>2018</span>
<span>2019</span>
<span>2020</span>
<span>2021</span>
<span>2022</span>
<span>2023</span>
<span>2024</span>
<span>2025</span>
<span>2026</span>
<span>2027</span>
<span>2028</span>
<span>2029</span>
<span>2030</span>
<span>2031</span>
<span>2032</span>
<span>2033</span>
<span>2034</span>
<span>2035</span>
<span>2036</span>
<span>2037</span>
<span>2038</span>
<span>2039</span>
<span>2040</span>
<span>2041</span>
<span>2042</span>
<span>2043</span>
<span>2044</span>
<span>2045</span>
<span>2046</span>
<span>2047</span>
<span>2048</span>
<span>2049</span>
<span>2050</span>
<span>2051</span>
<span>2052</span>
<span>2053</span>
<span>2054</span>
<span>2055</span>
<span>2056</span>
<span>2057</span>
<span>2058</span>
<span>2059</span>
<span>2060</span>
<span>2061</span>
<span>2062</span>
<span>2063</span>
<span>2064</span>
<span>2065</span>
<span>2066</span>
<span>2067</span>
<span>2068</span>
<span>2069</span>
<span>2070</span>
<span>2071</span>
<span>2072</span>
<span>2073</span>
<span>2074</span>
<span>2075</span>
<span>2076</span>
<span>2077</span>
<span>2078</span>
<span>2079</span>
<span>2080</span>
<span>2081</span>
<span>2082</span>
<span>2083</span>
<span>2084</span>
<span>2085</span>
<span>2086</span>
<span>2087</span>
<span>2088</span>
<span>2089</span>
<span>2090</span>
<span>2091</span>
<span>2092</span>
<span>2093</span>
<span>2094</span>
<span>2095</span>
<span>2096</span>
<span>2097</span>
<span>2098</span>
<span>2099</span>
<span>2100</span>
<span>2101</span>
<span>2102</span>
<span>2103</span>
<span>2104</span>
<span>2105</span>
<span>2106</span>
<span>2107</span>
<span>2108</span>
<span>2109</span>
<span>2110</span>
<span>2111</span>
<span>2112</span>
<span>2113</span>
<span>2114</span>
<span>2115</span>
<span>2116</span>
<span>2117</span>
<span>2118</span>
<span>2119</span>
<span>2120</span>
<span>2121</span>
<span>2122</span>
<span>2123</span>
<span>2124</span>
<span>2125</span>
<span>2126</span>
<span>2127</span>
<span>2128</span>
<span>2129</span>
<span>2130</span>
<span>2131</span>
<span>2132</span>
<span>2133</span>
<span>2134</span>
<span>2135</span>
<span>2136</span>
<span>2137</span>
<span>2138</span>
<span>2139</span>
<span>2140</span>
<span>2141</span>
<span>2142</span>
<span>2143</span>
<span>2144</span>
<span>2145</span>
<span>2146</span>
<span>2147</span>
<span>2148</span>
<span>2149</span>
<span>2150</span>
<span>2151</span>
<span>2152</span>
<span>2153</span>
<span>2154</span>
<span>2155</span>
<span>2156</span>
<span>2157</span>
<span>2158</span>
<span>2159</span>
<span>2160</span>
<span>2161</span>
<span>2162</span>
<span>2163</span>
<span>2164</span>
<span>2165</span>
<span>2166</span>
<span>2167</span>
<span>2168</span>
<span>2169</span>
<span>2170</span>
<span>2171</span>
<span>2172</span>
<span>2173</span>
<span>2174</span>
<span>2175</span>
<span>2176</span>
<span>2177</span>
<span>2178</span>
<span>2179</span>
<span>2180</span>
<span>2181</span>
<span>2182</span>
<span>2183</span>
<span>2184</span>
<span>2185</span>
<span>2186</span>
<span>2187</span>
<span>2188</span>
<span>2189</span>
<span>2190</span>
<span>2191</span>
<span>2192</span>
<span>2193</span>
<span>2194</span>
<span>2195</span>
<span>2196</span>
<span>2197</span>
<span>2198</span>
<span>2199</span>
<span>2200</span>
<span>2201</span>
<span>2202</span>
<span>2203</span>
<span>2204</span>
<span>2205</span>
<span>2206</span>
<span>2207</span>
<span>2208</span>
<span>2209</span>
<span>2210</span>
<span>2211</span>
<span>2212</span>
<span>2213</span>
<span>2214</span>
<span>2215</span>
<span>2216</span>
<span>2217</span>
<span>2218</span>
<span>2219</span>
<span>2220</span>
<span>2221</span>
<span>2222</span>
<span>2223</span>
<span>2224</span>
<span>2225</span>
<span>2226</span>
<span>2227</span>
<span>2228</span>
<span>2229</span>
<span>2230</span>
<span>2231</span>
<span>2232</span>
<span>2233</span>
<span>2234</span>
<span>2235</span>
<span>2236</span>
<span>2237</span>
<span>2238</span>
<span>2239</span>
<span>2240</span>
<span>2241</span>
<span>2242</span>
<span>2243</span>
<span>2244</span>
<span>2245</span>
<span>2246</span>
<span>2247</span>
<span>2248</span>
<span>2249</span>
<span>2250</span>
<span>2251</span>
<span>2252</span>
<span>2253</span>
<span>2254</span>
<span>2255</span>
<span>2256</span>
<span>2257</span>
<span>2258</span>
<span>2259</span>
<span>2260</span>
<span>2261</span>
<span>2262</span>
<span>2263</span>
<span>2264</span>
<span>2265</span>
<span>2266</span>
<span>2267</span>
<span>2268</span>
<span>2269</span>
<span>2270</span>
<span>2271</span>
<span>2272</span>
<span>2273</span>
<span>2274</span>
<span>2275</span>
<span>2276</span>
<span>2277</span>
<span>2278</span>
<span>2279</span>
<span>2280</span>
<span>2281</span>
<span>2282</span>
<span>2283</span>
<span>2284</span>
<span>2285</span>
<span>2286</span>
<span>2287</span>
<span>2288</span>
<span>2289</span>
<span>2290</span>
<span>2291</span>
<span>2292</span>
<span>2293</span>
<span>2294</span>
<span>2295</span>
<span>2296</span>
<span>2297</span>
<span>2298</span>
<span>2299</span>
<span>2300</span>
<span>2301</span>
<span>2302</span>
<span>2303</span>
<span>2304</span>
<span>2305</span>
<span>2306</span>
<span>2307</span>
<span>2308</span>
<span>2309</span>
<span>2310</span>
<span>2311</span>
<span>2312</span>
<span>2313</span>
<span>2314</span>
<span>2315</span>
<span>2316</span>
<span>2317</span>
<span>2318</span>
<span>2319</span>
<span>2320</span>
<span>2321</span>
<span>2322</span>
<span>2323</span>
<span>2324</span>
<span>2325</span>
<span>2326</span>
<span>2327</span>
<span>2328</span>
<span>2329</span>
<span>2330</span>
<span>2331</span>
<span>2332</span>
<span>2333</span>
<span>2334</span>
<span>2335</span>
<span>2336</span>
<span>2337</span>
<span>2338</span>
<span>2339</span>
<span>2340</span>
<span>2341</span>
<span>2342</span>
<span>2343</span>
<span>2344</span>
<span>2345</span>
<span>2346</span>
<span>2347</span>
<span>2348</span>
<span>2349</span>
<span>2350</span>
<span>2351</span>
<span>2352</span>
<span>2353</span>
<span>2354</span>
<span>2355</span>
<span>2356</span>
<span>2357</span>
<span>2358</span>
<span>2359</span>
<span>2360</span>
<span>2361</span>
<span>2362</span>
<span>2363</span>
<span>2364</span>
<span>2365</span>
<span>2366</span>
<span>2367</span>
<span>2368</span>
<span>2369</span>
<span>2370</span>
<span>2371</span>
<span>2372</span>
<span>2373</span>
<span>2374</span>
<span>2375</span>
<span>2376</span>
<span>2377</span>
<span>2378</span>
<span>2379</span>
<span>2380</span>
<span>2381</span>
<span>2382</span>
<span>2383</span>
<span>2384</span>
<span>2385</span>
<span>2386</span>
<span>2387</span>
<span>2388</span>
<span>2389</span>
<span>2390</span>
<span>2391</span>
<span>2392</span>
<span>2393</span>
<span>2394</span>
<span>2395</span>
<span>2396</span>
<span>2397</span>
<span>2398</span>
<span>2399</span>
<span>2400</span>
<span>2401</span>
<span>2402</span>
<span>2403</span>
<span>2404</span>
<span>2405</span>
<span>2406</span>
<span>2407</span>
<span>2408</span>
<span>2409</span>
<span>2410</span>
<span>2411</span>
<span>2412</span>
<span>2413</span>
<span>2414</span>
<span>2415</span>
<span>2416</span>
<span>2417</span>
<span>2418</span>
<span>2419</span>
<span>2420</span>
<span>2421</span>
<span>2422</span>
<span>2423</span>
<span>2424</span>
<span>2425</span>
<span>2426</span>
<span>2427</span>
<span>2428</span>
<span>2429</span>
<span>2430</span>
<span>2431</span>
<span>2432</span>
<span>2433</span>
<span>2434</span>
<span>2435</span>
<span>2436</span>
<span>2437</span>
<span>2438</span>
<span>2439</span>
<span>2440</span>
<span>2441</span>
<span>2442</span>
<span>2443</span>
<span>2444</span>
<span>2445</span>
<span>2446</span>
<span>2447</span>
<span>2448</span>
<span>2449</span>
<span>2450</span>
<span>2451</span>
<span>2452</span>
<span>2453</span>
<span>2454</span>
<span>2455</span>
<span>2456</span>
<span>2457</span>
<span>2458</span>
<span>2459</span>
<span>2460</span>
<span>2461</span>
<span>2462</span>
<span>2463</span>
<span>2464</span>
<span>2465</span>
<span>2466</span>
<span>2467</span>
<span>2468</span>
<span>2469</span>
<span>2470</span>
<span>2471</span>
<span>2472</span>
<span>2473</span>
<span>2474</span>
<span>2475</span>
<span>2476</span>
<span>2477</span>
<span>2478</span>
<span>2479</span>
<span>2480</span>
<span>2481</span>
<span>2482</span>
<span>2483</span>
<span>2484</span>
<span>2485</span>
<span>2486</span>
</pre></td><td id='code'><pre><span class='com'>/*
        Copyright (C) 2004 Christopher E. Miller
        
        This software is provided 'as-is', without any express or implied
        warranty.  In no event will the authors be held liable for any damages
        arising from the use of this software.
        
        Permission is granted to anyone to use this software for any purpose,
        including commercial applications, and to alter it and redistribute it
        freely, subject to the following restrictions:
        
        1. The origin of this software must not be misrepresented; you must not
           claim that you wrote the original software. If you use this software
           in a product, an acknowledgment in the product documentation would be
           appreciated but is not required.

        2. Altered source versions must be plainly marked as such, and must not be
           misrepresented as being the original software.

        3. This notice may not be removed or altered from any source distribution.

*/</span>

<span class='com'>/*******************************************************************************

        copyright:      Copyright (c) 2004 Kris Bell. All rights reserved

        license:        BSD style: $(LICENSE)
      
        version:        Initial release: March 2004
        
        author:         Christopher Miller 
                        Kris Bell
                        Anders F Bjorklund (Darwin patches)


        The original code has been modified in several ways:

        1) It has been altered to fit within the Mango environment, meaning
           that certain original classes have been reorganized, and/or have
           subclassed Mango base-classes. For example, the original Socket
           class has been wrapped with three distinct subclasses, and now
           derives from class tango.io.Resource.

        2) All exception instances now subclass the Mango IOException.

        3) Construction of new Socket instances via accept() is now
           overloadable.

        4) Constants and enums have been moved within a class boundary to
           ensure explicit namespace usage.

        5) changed Socket.select() to loop if it was interrupted.


        All changes within the main body of code all marked with &quot;MANGO:&quot;

        For a good tutorial on socket-programming I highly recommend going 
        here: http://www.ecst.csuchico.edu/~beej/guide/net/      

*******************************************************************************/</span>


<span class='com'>// MANGO: added all this module &amp; import stuff ...</span>
<span class='kw2'>module</span> tango.net.Socket;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.text.Text;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.convert.Integer;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.os.OS;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.core.Interval;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.Conduit,
                tango.io.Exception;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.model.IBuffer;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.stdc.stdint;
<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.stdc.errno;


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>version</span> <span class='opr'>(</span>linux<span class='opr'>)</span>
         <span class='kw4'>version</span> <span class='opr'>=</span> BsdSockets;

<span class='kw4'>version</span> <span class='opr'>(</span>darwin<span class='opr'>)</span>
         <span class='kw4'>version</span> <span class='opr'>=</span> BsdSockets;

<span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
         <span class='kw4'>version</span> <span class='opr'>=</span> BsdSockets;


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>version</span> <span class='opr'>(</span>Win32<span class='opr'>)</span>
        <span class='opr'>{</span>
        <span class='kw4'>private</span> <span class='kw2'>typedef</span> <span class='kw4'>int</span> socket_t <span class='opr'>=</span> <span class='opr'>~</span><span class='nbr'>0</span>;

        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> IOCPARM_MASK <span class='opr'>=</span>  <span class='nbr'>0</span>x7f;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> IOC_IN <span class='opr'>=</span>        <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span><span class='nbr'>0</span>x80000000;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> FIONBIO <span class='opr'>=</span>       <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span> <span class='opr'>(</span>IOC_IN | <span class='opr'>(</span><span class='opr'>(</span><span class='kw4'>int</span>.sizeof <span class='opr'>&amp;</span> IOCPARM_MASK<span class='opr'>)</span> <span class='opr'>&lt;</span><span class='opr'>&lt;</span> <span class='nbr'>16</span><span class='opr'>)</span> | <span class='opr'>(</span><span class='nbr'>102</span> <span class='opr'>&lt;</span><span class='opr'>&lt;</span> <span class='nbr'>8</span><span class='opr'>)</span> | <span class='nbr'>126</span><span class='opr'>)</span>;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> SOL_SOCKET <span class='opr'>=</span>    <span class='nbr'>0</span>xFFFF;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> SO_TYPE <span class='opr'>=</span>       <span class='nbr'>0</span>x1008;

        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> WSADESCRIPTION_LEN <span class='opr'>=</span> <span class='nbr'>256</span>;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> WSASYS_STATUS_LEN <span class='opr'>=</span> <span class='nbr'>128</span>;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> WSAEWOULDBLOCK <span class='opr'>=</span>  <span class='nbr'>10035</span>;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> WSAEINTR <span class='opr'>=</span>        <span class='nbr'>10004</span>;
                
                
        <span class='kw4'>struct</span> WSADATA
        <span class='opr'>{</span>
                        WORD wVersion;
                        WORD wHighVersion;
                        <span class='kw4'>char</span> szDescription<span class='opr'>[</span>WSADESCRIPTION_LEN<span class='opr'>+</span><span class='nbr'>1</span><span class='opr'>]</span>;
                        <span class='kw4'>char</span> szSystemStatus<span class='opr'>[</span>WSASYS_STATUS_LEN<span class='opr'>+</span><span class='nbr'>1</span><span class='opr'>]</span>;
                        <span class='kw4'>ushort</span> iMaxSockets;
                        <span class='kw4'>ushort</span> iMaxUdpDg;
                        <span class='kw4'>char</span><span class='opr'>*</span> lpVendorInfo;
        <span class='opr'>}</span>
        <span class='kw2'>alias</span> WSADATA<span class='opr'>*</span> LPWSADATA;
                
        <span class='kw2'>extern</span>  <span class='opr'>(</span>Windows<span class='opr'>)</span>
                <span class='opr'>{</span>
                <span class='kw4'>int</span> WSAStartup<span class='opr'>(</span>WORD wVersionRequested, LPWSADATA lpWSAData<span class='opr'>)</span>;
                <span class='kw4'>int</span> WSACleanup<span class='opr'>(</span><span class='opr'>)</span>;
                socket_t socket<span class='opr'>(</span><span class='kw4'>int</span> af, <span class='kw4'>int</span> type, <span class='kw4'>int</span> protocol<span class='opr'>)</span>;
                <span class='kw4'>int</span> ioctlsocket<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> cmd, <span class='kw4'>uint</span><span class='opr'>*</span> argp<span class='opr'>)</span>;
                <span class='kw4'>int</span> getsockopt<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> level, <span class='kw4'>int</span> optname, <span class='kw4'>char</span><span class='opr'>*</span> optval, <span class='kw4'>int</span><span class='opr'>*</span> optlen<span class='opr'>)</span>;
                <span class='kw4'>uint</span> inet_addr<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span> cp<span class='opr'>)</span>;
                <span class='kw4'>int</span> bind<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> connect<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> listen<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> backlog<span class='opr'>)</span>;
                socket_t accept<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> addr, <span class='kw4'>int</span><span class='opr'>*</span> addrlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> closesocket<span class='opr'>(</span>socket_t s<span class='opr'>)</span>;
                <span class='kw4'>int</span> shutdown<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> how<span class='opr'>)</span>;
                <span class='kw4'>int</span> getpeername<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span><span class='opr'>*</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> getsockname<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span><span class='opr'>*</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> send<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags<span class='opr'>)</span>;
                <span class='kw4'>int</span> sendto<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags, sockaddr<span class='opr'>*</span> to, <span class='kw4'>int</span> tolen<span class='opr'>)</span>;
                <span class='kw4'>int</span> recv<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags<span class='opr'>)</span>;
                <span class='kw4'>int</span> recvfrom<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags, sockaddr<span class='opr'>*</span> from, <span class='kw4'>int</span><span class='opr'>*</span> fromlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> select<span class='opr'>(</span><span class='kw4'>int</span> nfds, fd_set<span class='opr'>*</span> readfds, fd_set<span class='opr'>*</span> writefds, fd_set<span class='opr'>*</span> errorfds, timeval<span class='opr'>*</span> timeout<span class='opr'>)</span>;
                <span class='com'>//int __WSAFDIsSet(socket_t s, fd_set* fds);</span>
                <span class='kw4'>int</span> getsockopt<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> level, <span class='kw4'>int</span> optname, <span class='kw4'>void</span><span class='opr'>*</span> optval, <span class='kw4'>int</span><span class='opr'>*</span> optlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> setsockopt<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> level, <span class='kw4'>int</span> optname, <span class='kw4'>void</span><span class='opr'>*</span> optval, <span class='kw4'>int</span> optlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> gethostname<span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> namebuffer, <span class='kw4'>int</span> buflen<span class='opr'>)</span>;
                <span class='kw4'>char</span><span class='opr'>*</span> inet_ntoa<span class='opr'>(</span><span class='kw4'>uint</span> ina<span class='opr'>)</span>;
                hostent<span class='opr'>*</span> gethostbyname<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span> name<span class='opr'>)</span>;
                hostent<span class='opr'>*</span> gethostbyaddr<span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> addr, <span class='kw4'>int</span> len, <span class='kw4'>int</span> type<span class='opr'>)</span>;
                <span class='kw4'>int</span> WSAGetLastError<span class='opr'>(</span><span class='opr'>)</span>;
                <span class='opr'>}</span>

        <span class='kw4'>static</span> <span class='kw2'>this</span><span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                WSADATA wd;
                <span class='kw1'>if</span> <span class='opr'>(</span>WSAStartup <span class='opr'>(</span><span class='nbr'>0</span>x0101, <span class='opr'>&amp;</span>wd<span class='opr'>)</span><span class='opr'>)</span>
                    <span class='kw2'>throw</span> <span class='kw2'>new</span> SocketException<span class='opr'>(</span><span class='str'>&quot;Unable to initialize socket library.&quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>


        <span class='kw4'>static</span> <span class='opr'>~</span><span class='kw2'>this</span><span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                WSACleanup<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='opr'>}</span>

<span class='kw4'>version</span> <span class='opr'>(</span>BsdSockets<span class='opr'>)</span>
        <span class='opr'>{</span>
        <span class='kw4'>private</span> <span class='kw2'>typedef</span> <span class='kw4'>int</span> socket_t <span class='opr'>=</span> <span class='opr'>-</span><span class='nbr'>1</span>;
        
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> F_GETFL       <span class='opr'>=</span> <span class='nbr'>3</span>;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> F_SETFL       <span class='opr'>=</span> <span class='nbr'>4</span>;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> O_NONBLOCK    <span class='opr'>=</span> <span class='nbr'>0</span>x4000;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> SOL_SOCKET_D  <span class='opr'>=</span> <span class='nbr'>0</span>xFFFF;
        <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> SO_TYPE       <span class='opr'>=</span> <span class='nbr'>0</span>x1008;

        <span class='kw4'>version</span> <span class='opr'>(</span>Phobos<span class='opr'>)</span>
                <span class='opr'>{</span>
                <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> EINTR <span class='opr'>=</span> <span class='nbr'>4</span>;
                <span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> EINPROGRESS <span class='opr'>=</span> <span class='nbr'>115</span>; 
                <span class='opr'>}</span>
                
        <span class='kw4'>private</span> <span class='kw2'>alias</span> SOL_SOCKET_D SOL_SOCKET; <span class='com'>// symbol conflict, when linking</span>

        <span class='kw2'>extern</span>  <span class='opr'>(</span>C<span class='opr'>)</span>
                <span class='opr'>{</span>
                socket_t socket<span class='opr'>(</span><span class='kw4'>int</span> af, <span class='kw4'>int</span> type, <span class='kw4'>int</span> protocol<span class='opr'>)</span>;
                <span class='kw4'>int</span> fcntl<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> f, <span class='opr'>..</span>.<span class='opr'>)</span>;
                <span class='kw4'>int</span> getsockopt<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> level, <span class='kw4'>int</span> optname, <span class='kw4'>char</span><span class='opr'>*</span> optval, <span class='kw4'>int</span><span class='opr'>*</span> optlen<span class='opr'>)</span>;
                <span class='kw4'>uint</span> inet_addr<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span> cp<span class='opr'>)</span>;
                <span class='kw4'>int</span> bind<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> connect<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> listen<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> backlog<span class='opr'>)</span>;
                socket_t accept<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> addr, <span class='kw4'>int</span><span class='opr'>*</span> addrlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> close<span class='opr'>(</span>socket_t s<span class='opr'>)</span>;
                <span class='kw4'>int</span> shutdown<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> how<span class='opr'>)</span>;
                <span class='kw4'>int</span> getpeername<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span><span class='opr'>*</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> getsockname<span class='opr'>(</span>socket_t s, sockaddr<span class='opr'>*</span> name, <span class='kw4'>int</span><span class='opr'>*</span> namelen<span class='opr'>)</span>;
                <span class='kw4'>int</span> send<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags<span class='opr'>)</span>;
                <span class='kw4'>int</span> sendto<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags, sockaddr<span class='opr'>*</span> to, <span class='kw4'>int</span> tolen<span class='opr'>)</span>;
                <span class='kw4'>int</span> recv<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags<span class='opr'>)</span>;
                <span class='kw4'>int</span> recvfrom<span class='opr'>(</span>socket_t s, <span class='kw4'>void</span><span class='opr'>*</span> buf, <span class='kw4'>int</span> len, <span class='kw4'>int</span> flags, sockaddr<span class='opr'>*</span> from, <span class='kw4'>int</span><span class='opr'>*</span> fromlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> select<span class='opr'>(</span><span class='kw4'>int</span> nfds, fd_set<span class='opr'>*</span> readfds, fd_set<span class='opr'>*</span> writefds, fd_set<span class='opr'>*</span> errorfds, timeval<span class='opr'>*</span> timeout<span class='opr'>)</span>;
                <span class='kw4'>int</span> getsockopt<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> level, <span class='kw4'>int</span> optname, <span class='kw4'>void</span><span class='opr'>*</span> optval, <span class='kw4'>int</span><span class='opr'>*</span> optlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> setsockopt<span class='opr'>(</span>socket_t s, <span class='kw4'>int</span> level, <span class='kw4'>int</span> optname, <span class='kw4'>void</span><span class='opr'>*</span> optval, <span class='kw4'>int</span> optlen<span class='opr'>)</span>;
                <span class='kw4'>int</span> gethostname<span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> namebuffer, <span class='kw4'>int</span> buflen<span class='opr'>)</span>;
                <span class='kw4'>char</span><span class='opr'>*</span> inet_ntoa<span class='opr'>(</span><span class='kw4'>uint</span> ina<span class='opr'>)</span>;
                hostent<span class='opr'>*</span> gethostbyname<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span> name<span class='opr'>)</span>;
                hostent<span class='opr'>*</span> gethostbyaddr<span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> addr, <span class='kw4'>int</span> len, <span class='kw4'>int</span> type<span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>private</span> <span class='kw4'>const</span> socket_t INVALID_SOCKET <span class='opr'>=</span> socket_t.init;
<span class='kw4'>private</span> <span class='kw4'>const</span> <span class='kw4'>int</span> SOCKET_ERROR <span class='opr'>=</span> <span class='opr'>-</span><span class='nbr'>1</span>;



<span class='com'>/+
#ifdef INCLUDE_ALL_FOR_DOXYGEN
+/</span>

<span class='com'>/*******************************************************************************
        
        Internal structs: 

*******************************************************************************/</span>

<span class='kw4'>struct</span> timeval
<span class='opr'>{</span>
        <span class='kw4'>int</span> tv_sec; <span class='com'>//seconds</span>
        <span class='kw4'>int</span> tv_usec; <span class='com'>//microseconds</span>
<span class='opr'>}</span>


<span class='com'>//transparent</span>
<span class='kw4'>struct</span> fd_set
<span class='opr'>{</span>
<span class='opr'>}</span>


<span class='kw4'>struct</span> sockaddr
<span class='opr'>{</span>
        <span class='kw4'>ushort</span> sa_family;               
        <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>14</span><span class='opr'>]</span> sa_data <span class='opr'>=</span> <span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span>;             
<span class='opr'>}</span>


<span class='kw4'>struct</span> hostent
<span class='opr'>{</span>
        <span class='kw4'>char</span><span class='opr'>*</span> h_name;
        <span class='kw4'>char</span><span class='opr'>*</span><span class='opr'>*</span> h_aliases;
        <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>short</span> h_addrtype;
                <span class='kw4'>short</span> h_length;
        <span class='opr'>}</span>
        <span class='kw1'>else</span> <span class='kw4'>version</span><span class='opr'>(</span>BsdSockets<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> h_addrtype;
                <span class='kw4'>int</span> h_length;
        <span class='opr'>}</span>
        <span class='kw4'>char</span><span class='opr'>*</span><span class='opr'>*</span> h_addr_list;
        
        
        <span class='kw4'>char</span><span class='opr'>*</span> h_addr<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> h_addr_list<span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************
        
        conversions for network byte-order

*******************************************************************************/</span>

<span class='kw4'>version</span><span class='opr'>(</span>BigEndian<span class='opr'>)</span>
<span class='opr'>{</span>
        uint16_t htons<span class='opr'>(</span>uint16_t x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> x;
        <span class='opr'>}</span>
        
        
        uint32_t htonl<span class='opr'>(</span>uint32_t x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> x;
        <span class='opr'>}</span>
<span class='opr'>}</span>
<span class='kw1'>else</span> <span class='kw4'>version</span><span class='opr'>(</span>LittleEndian<span class='opr'>)</span>
<span class='opr'>{</span>
        <span class='kw2'>import</span> tango.core.intrinsic;
        
        
        uint16_t htons<span class='opr'>(</span>uint16_t x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span>uint16_t<span class='opr'>)</span> <span class='opr'>(</span><span class='opr'>(</span>x <span class='opr'>&gt;</span><span class='opr'>&gt;</span> <span class='nbr'>8</span><span class='opr'>)</span> | <span class='opr'>(</span>x <span class='opr'>&lt;</span><span class='opr'>&lt;</span> <span class='nbr'>8</span><span class='opr'>)</span><span class='opr'>)</span>;
        <span class='opr'>}</span>


        uint32_t htonl<span class='opr'>(</span>uint32_t x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> bswap<span class='opr'>(</span>x<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>
<span class='kw1'>else</span>
<span class='opr'>{</span>
        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
<span class='opr'>}</span>


uint16_t ntohs<span class='opr'>(</span>uint16_t x<span class='opr'>)</span>
<span class='opr'>{</span>
        <span class='kw1'>return</span> htons<span class='opr'>(</span>x<span class='opr'>)</span>;
<span class='opr'>}</span>


uint32_t ntohl<span class='opr'>(</span>uint32_t x<span class='opr'>)</span>
<span class='opr'>{</span>
        <span class='kw1'>return</span> htonl<span class='opr'>(</span>x<span class='opr'>)</span>;
<span class='opr'>}</span>

<span class='com'>/+
#endif
+/</span>



<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>private</span> <span class='kw2'>extern</span> <span class='opr'>(</span>C<span class='opr'>)</span> <span class='kw4'>int</span> strlen<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span><span class='opr'>)</span>;

<span class='kw4'>private</span> <span class='kw4'>static</span> <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> toString<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span> s<span class='opr'>)</span>
<span class='opr'>{</span>
        <span class='kw1'>return</span> s ? s<span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> strlen<span class='opr'>(</span>s<span class='opr'>)</span><span class='opr'>]</span> : <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span><span class='opr'>)</span><span class='kw2'>null</span>;
<span class='opr'>}</span>

<span class='kw4'>private</span> <span class='kw4'>static</span> <span class='kw4'>char</span><span class='opr'>*</span> convert2C <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> input, <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> output<span class='opr'>)</span>
<span class='opr'>{</span>
        output <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> input.length<span class='opr'>]</span> <span class='opr'>=</span> input;
        output <span class='opr'>[</span>input.length<span class='opr'>]</span> <span class='opr'>=</span> <span class='nbr'>0</span>;
        <span class='kw1'>return</span> output.ptr;
<span class='opr'>}</span>
        
        
<span class='com'>/*******************************************************************************

        Public interface ...

*******************************************************************************/</span>

<span class='kw4'>public</span>:


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>class</span> HostException: IOException
<span class='opr'>{</span>
        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span><span class='opr'>(</span>msg<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>class</span> SocketException: IOException
<span class='opr'>{</span>
        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span><span class='opr'>(</span>msg<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>class</span> AddressException: SocketException
<span class='opr'>{</span>
        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span><span class='opr'>(</span>msg<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>class</span> SocketAcceptException: SocketException
<span class='opr'>{</span>
        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span><span class='opr'>(</span>msg<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>static</span> <span class='kw4'>int</span> lastError <span class='opr'>(</span><span class='opr'>)</span>
<span class='opr'>{</span>
        <span class='kw4'>version</span> <span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>       
                <span class='kw1'>return</span> WSAGetLastError<span class='opr'>(</span><span class='opr'>)</span>;
                <span class='opr'>}</span> 
        <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                <span class='opr'>{</span>
                <span class='kw1'>return</span> errno;
                <span class='opr'>}</span>
<span class='opr'>}</span>

        
<span class='com'>/*******************************************************************************

        MANGO: socket now subclasses tango.io.Resource

*******************************************************************************/</span>

<span class='kw4'>class</span> Socket : Conduit
<span class='opr'>{</span>
        <span class='kw4'>private</span> socket_t sock;
        <span class='kw4'>private</span> AddressFamily _family;

        <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='kw4'>private</span> <span class='kw4'>bool</span> _blocking <span class='opr'>=</span> <span class='kw2'>false</span>;
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='com'>/+
        #ifdef INCLUDE_ALL_FOR_DOXYGEN
        +/</span>
        
        <span class='kw4'>version</span> <span class='opr'>(</span>Win32<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>/***************************************************************


                ***************************************************************/</span>

                <span class='kw4'>enum</span> Option: <span class='kw4'>int</span>
                <span class='opr'>{</span>
                        <span class='com'>//consistent</span>
                        SO_DEBUG <span class='opr'>=</span>         <span class='nbr'>0</span>x1,

                        <span class='com'>//possibly Winsock-only values</span>
                        SO_BROADCAST <span class='opr'>=</span>  <span class='nbr'>0</span>x20,
                        SO_REUSEADDR <span class='opr'>=</span>  <span class='nbr'>0</span>x4,
                        SO_LINGER <span class='opr'>=</span>     <span class='nbr'>0</span>x80,
                        SO_DONTLINGER <span class='opr'>=</span> <span class='opr'>~</span><span class='opr'>(</span>SO_LINGER<span class='opr'>)</span>,
                        SO_OOBINLINE <span class='opr'>=</span>  <span class='nbr'>0</span>x100,
                        SO_SNDBUF <span class='opr'>=</span>     <span class='nbr'>0</span>x1001,
                        SO_RCVBUF <span class='opr'>=</span>     <span class='nbr'>0</span>x1002,
                        SO_ERROR <span class='opr'>=</span>      <span class='nbr'>0</span>x1007,

                        SO_ACCEPTCONN <span class='opr'>=</span>    <span class='nbr'>0</span>x2, <span class='com'>// ?</span>
                        SO_KEEPALIVE <span class='opr'>=</span>     <span class='nbr'>0</span>x8, <span class='com'>// ?</span>
                        SO_DONTROUTE <span class='opr'>=</span>     <span class='nbr'>0</span>x10, <span class='com'>// ?</span>
                        SO_TYPE <span class='opr'>=</span>          <span class='nbr'>0</span>x1008, <span class='com'>// ?</span>

                        <span class='com'>// OptionLevel.IP settings</span>
                        IP_MULTICAST_LOOP <span class='opr'>=</span> <span class='nbr'>0</span>x4,
                        IP_ADD_MEMBERSHIP <span class='opr'>=</span> <span class='nbr'>0</span>x5,
                        IP_DROP_MEMBERSHIP <span class='opr'>=</span> <span class='nbr'>0</span>x6,
                <span class='opr'>}</span>

                <span class='com'>/***************************************************************


                ***************************************************************/</span>

                <span class='kw2'>union</span> linger
                <span class='opr'>{</span>
                        <span class='kw4'>struct</span> <span class='opr'>{</span>
                               <span class='kw4'>ushort</span> l_onoff;          <span class='com'>// option on/off</span>
                               <span class='kw4'>ushort</span> l_linger;         <span class='com'>// linger time</span>
                               <span class='opr'>}</span>;
                        <span class='kw4'>ushort</span><span class='opr'>[</span><span class='nbr'>2</span><span class='opr'>]</span>       array;          <span class='com'>// combined </span>
                <span class='opr'>}</span>

                <span class='com'>/***************************************************************


                ***************************************************************/</span>

                <span class='kw4'>enum</span> OptionLevel
                <span class='opr'>{</span>
                        SOCKET <span class='opr'>=</span>  <span class='nbr'>0</span>xFFFF, 
                        IP <span class='opr'>=</span>      <span class='nbr'>0</span>,
                        TCP <span class='opr'>=</span>     <span class='nbr'>6</span>,
                        UDP <span class='opr'>=</span>     <span class='nbr'>17</span>,
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>darwin<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>enum</span> Option: <span class='kw4'>int</span>
                <span class='opr'>{</span>
                        SO_DEBUG        <span class='opr'>=</span> <span class='nbr'>0</span>x0001,        <span class='com'>/* turn on debugging info recording */</span>
                        SO_BROADCAST    <span class='opr'>=</span> <span class='nbr'>0</span>x0020,        <span class='com'>/* permit sending of broadcast msgs */</span>
                        SO_REUSEADDR    <span class='opr'>=</span> <span class='nbr'>0</span>x0004,        <span class='com'>/* allow local address reuse */</span>
                        SO_LINGER       <span class='opr'>=</span> <span class='nbr'>0</span>x0080,        <span class='com'>/* linger on close if data present */</span>
                        SO_DONTLINGER   <span class='opr'>=</span> <span class='opr'>~</span><span class='opr'>(</span>SO_LINGER<span class='opr'>)</span>,
                        SO_OOBINLINE    <span class='opr'>=</span> <span class='nbr'>0</span>x0100,        <span class='com'>/* leave received OOB data in line */</span>
                        SO_ACCEPTCONN   <span class='opr'>=</span> <span class='nbr'>0</span>x0002,        <span class='com'>/* socket has had listen() */</span>
                        SO_KEEPALIVE    <span class='opr'>=</span> <span class='nbr'>0</span>x0008,        <span class='com'>/* keep connections alive */</span>
                        SO_DONTROUTE    <span class='opr'>=</span> <span class='nbr'>0</span>x0010,        <span class='com'>/* just use interface addresses */</span>
                      <span class='com'>//SO_TYPE</span>

                        <span class='com'>/*
                         * Additional options, not kept in so_options.
                         */</span>
                        SO_SNDBUF       <span class='opr'>=</span> <span class='nbr'>0</span>x1001,        <span class='com'>/* send buffer size */</span>
                        SO_RCVBUF       <span class='opr'>=</span> <span class='nbr'>0</span>x1002,        <span class='com'>/* receive buffer size */</span>
                        SO_ERROR        <span class='opr'>=</span> <span class='nbr'>0</span>x1007,        <span class='com'>/* get error status and clear */</span>

                        <span class='com'>// OptionLevel.IP settings</span>
                        IP_MULTICAST_LOOP <span class='opr'>=</span> <span class='nbr'>11</span>,
                        IP_ADD_MEMBERSHIP <span class='opr'>=</span> <span class='nbr'>12</span>,
                        IP_DROP_MEMBERSHIP <span class='opr'>=</span> <span class='nbr'>13</span>,
                <span class='opr'>}</span>

                <span class='com'>/***************************************************************


                ***************************************************************/</span>

                <span class='kw2'>union</span> linger
                <span class='opr'>{</span>
                        <span class='kw4'>struct</span> <span class='opr'>{</span>
                               <span class='kw4'>int</span> l_onoff;             <span class='com'>// option on/off</span>
                               <span class='kw4'>int</span> l_linger;            <span class='com'>// linger time</span>
                               <span class='opr'>}</span>;
                        <span class='kw4'>int</span><span class='opr'>[</span><span class='nbr'>2</span><span class='opr'>]</span>          array;          <span class='com'>// combined</span>
                <span class='opr'>}</span>

                <span class='com'>/***************************************************************

                        Question: are these correct for Darwin?

                ***************************************************************/</span>

                <span class='kw4'>enum</span> OptionLevel
                <span class='opr'>{</span>
                        SOCKET <span class='opr'>=</span>  <span class='nbr'>1</span>,  <span class='com'>// correct for linux on x86 </span>
                        IP <span class='opr'>=</span>      <span class='nbr'>0</span>,  <span class='com'>// appears to be correct</span>
                        TCP <span class='opr'>=</span>     <span class='nbr'>6</span>,  <span class='com'>// appears to be correct</span>
                        UDP <span class='opr'>=</span>     <span class='nbr'>17</span>, <span class='com'>// appears to be correct</span>
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>linux<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>/***************************************************************

                        these appear to be compatible with x86 platforms, 
                        but not others!

                ***************************************************************/</span>

                <span class='kw4'>enum</span> Option: <span class='kw4'>int</span>
                <span class='opr'>{</span>
                        <span class='com'>//consistent</span>
                        SO_DEBUG        <span class='opr'>=</span> <span class='nbr'>1</span>,
                        SO_BROADCAST    <span class='opr'>=</span> <span class='nbr'>6</span>,
                        SO_REUSEADDR    <span class='opr'>=</span> <span class='nbr'>2</span>,
                        SO_LINGER       <span class='opr'>=</span> <span class='nbr'>13</span>,
                        SO_DONTLINGER   <span class='opr'>=</span> <span class='opr'>~</span><span class='opr'>(</span>SO_LINGER<span class='opr'>)</span>,
                        SO_OOBINLINE    <span class='opr'>=</span> <span class='nbr'>10</span>,
                        SO_SNDBUF       <span class='opr'>=</span> <span class='nbr'>7</span>,
                        SO_RCVBUF       <span class='opr'>=</span> <span class='nbr'>8</span>,
                        SO_ERROR        <span class='opr'>=</span> <span class='nbr'>4</span>,

                        SO_ACCEPTCONN   <span class='opr'>=</span> <span class='nbr'>30</span>,
                        SO_KEEPALIVE    <span class='opr'>=</span> <span class='nbr'>9</span>, 
                        SO_DONTROUTE    <span class='opr'>=</span> <span class='nbr'>5</span>, 
                        SO_TYPE         <span class='opr'>=</span> <span class='nbr'>3</span>, 

                        <span class='com'>// OptionLevel.IP settings</span>
                        IP_MULTICAST_LOOP <span class='opr'>=</span> <span class='nbr'>34</span>,
                        IP_ADD_MEMBERSHIP <span class='opr'>=</span> <span class='nbr'>35</span>,
                        IP_DROP_MEMBERSHIP <span class='opr'>=</span> <span class='nbr'>36</span>,
                <span class='opr'>}</span>

                <span class='com'>/***************************************************************


                ***************************************************************/</span>

                <span class='kw2'>union</span> linger
                <span class='opr'>{</span>
                        <span class='kw4'>struct</span> <span class='opr'>{</span>
                               <span class='kw4'>int</span> l_onoff;             <span class='com'>// option on/off</span>
                               <span class='kw4'>int</span> l_linger;            <span class='com'>// linger time</span>
                               <span class='opr'>}</span>;
                        <span class='kw4'>int</span><span class='opr'>[</span><span class='nbr'>2</span><span class='opr'>]</span>          array;          <span class='com'>// combined</span>
                <span class='opr'>}</span>

                <span class='com'>/***************************************************************


                ***************************************************************/</span>

                <span class='kw4'>enum</span> OptionLevel
                <span class='opr'>{</span>
                        SOCKET <span class='opr'>=</span>  <span class='nbr'>1</span>,  <span class='com'>// correct for linux on x86 </span>
                        IP <span class='opr'>=</span>      <span class='nbr'>0</span>,  <span class='com'>// appears to be correct</span>
                        TCP <span class='opr'>=</span>     <span class='nbr'>6</span>,  <span class='com'>// appears to be correct</span>
                        UDP <span class='opr'>=</span>     <span class='nbr'>17</span>, <span class='com'>// appears to be correct</span>
                <span class='opr'>}</span>
        <span class='opr'>}</span> <span class='com'>// end versioning</span>

        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>enum</span> Shutdown: <span class='kw4'>int</span>
        <span class='opr'>{</span>
                RECEIVE <span class='opr'>=</span>  <span class='nbr'>0</span>,
                SEND <span class='opr'>=</span>     <span class='nbr'>1</span>,
                BOTH <span class='opr'>=</span>     <span class='nbr'>2</span>,
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>enum</span> Flags: <span class='kw4'>int</span>
        <span class='opr'>{</span>
                NONE <span class='opr'>=</span>           <span class='nbr'>0</span>,
                OOB <span class='opr'>=</span>            <span class='nbr'>0</span>x1, <span class='com'>//out of band</span>
                PEEK <span class='opr'>=</span>           <span class='nbr'>0</span>x02, <span class='com'>//only for receiving</span>
                DONTROUTE <span class='opr'>=</span>      <span class='nbr'>0</span>x04, <span class='com'>//only for sending</span>
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>enum</span> Type: <span class='kw4'>int</span>
        <span class='opr'>{</span>
                STREAM <span class='opr'>=</span>     <span class='nbr'>1</span>,
                DGRAM <span class='opr'>=</span>      <span class='nbr'>2</span>,
                RAW <span class='opr'>=</span>        <span class='nbr'>3</span>,
                RDM <span class='opr'>=</span>        <span class='nbr'>4</span>,
                SEQPACKET <span class='opr'>=</span>  <span class='nbr'>5</span>,
        <span class='opr'>}</span>


        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>enum</span> Protocol: <span class='kw4'>int</span>
        <span class='opr'>{</span>
                IP <span class='opr'>=</span>    <span class='nbr'>0</span>,
                ICMP <span class='opr'>=</span>  <span class='nbr'>1</span>,      <span class='com'>// apparently a no-no for linux?</span>
                IGMP <span class='opr'>=</span>  <span class='nbr'>2</span>,
                GGP <span class='opr'>=</span>   <span class='nbr'>3</span>,
                TCP <span class='opr'>=</span>   <span class='nbr'>6</span>,
                PUP <span class='opr'>=</span>   <span class='nbr'>12</span>,
                UDP <span class='opr'>=</span>   <span class='nbr'>17</span>,
                IDP <span class='opr'>=</span>   <span class='nbr'>22</span>,
                ND <span class='opr'>=</span>    <span class='nbr'>77</span>,
                RAW <span class='opr'>=</span>   <span class='nbr'>255</span>,
                MAX <span class='opr'>=</span>   <span class='nbr'>256</span>,
        <span class='opr'>}</span>


        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>enum</span> AddressFamily: <span class='kw4'>int</span>
                <span class='opr'>{</span>
                        UNSPEC <span class='opr'>=</span>     <span class='nbr'>0</span>,
                        UNIX <span class='opr'>=</span>       <span class='nbr'>1</span>,
                        INET <span class='opr'>=</span>       <span class='nbr'>2</span>,
                        IPX <span class='opr'>=</span>        <span class='nbr'>6</span>,
                        APPLETALK <span class='opr'>=</span>  <span class='nbr'>16</span>,
                        <span class='com'>//INET6 =      ? // Need Windows XP ?</span>
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        <span class='kw1'>else</span> <span class='kw4'>version</span><span class='opr'>(</span>BsdSockets<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span> <span class='opr'>(</span>darwin<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw4'>enum</span> AddressFamily: <span class='kw4'>int</span>
                        <span class='opr'>{</span>
                                UNSPEC <span class='opr'>=</span>     <span class='nbr'>0</span>,
                                UNIX <span class='opr'>=</span>       <span class='nbr'>1</span>,
                                INET <span class='opr'>=</span>       <span class='nbr'>2</span>,
                                IPX <span class='opr'>=</span>        <span class='nbr'>23</span>,
                                APPLETALK <span class='opr'>=</span>  <span class='nbr'>16</span>,
                                <span class='com'>//INET6 =      10,</span>
                        <span class='opr'>}</span>
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>linux<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw4'>enum</span> AddressFamily: <span class='kw4'>int</span>
                        <span class='opr'>{</span>
                                UNSPEC <span class='opr'>=</span>     <span class='nbr'>0</span>,
                                UNIX <span class='opr'>=</span>       <span class='nbr'>1</span>,
                                INET <span class='opr'>=</span>       <span class='nbr'>2</span>,
                                IPX <span class='opr'>=</span>        <span class='nbr'>4</span>,
                                APPLETALK <span class='opr'>=</span>  <span class='nbr'>5</span>,
                                <span class='com'>//INET6 =      10,</span>
                        <span class='opr'>}</span>
                <span class='opr'>}</span> <span class='com'>// end version</span>
        <span class='opr'>}</span>

        <span class='com'>/+
        #endif
        +/</span>
        

        
        <span class='com'>/***********************************************************************

                Construct a Socket from a handle. This is used internally
                to create new Sockets via an accept().

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw2'>this</span> <span class='opr'>(</span>socket_t sock<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>// MANGO: exposed the constructor functionality: see below.</span>
                set <span class='opr'>(</span>sock<span class='opr'>)</span>;

                <span class='kw2'>super</span> <span class='opr'>(</span>ConduitStyle.ReadWrite, <span class='kw2'>false</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

       <span class='com'>/***********************************************************************
        
                Callback routine to read content from the socket. Note 
                that the operation may timeout if method setTimeout()
                has been invoked with a non-zero value.         

                Returns the number of bytes read from the socket, or
                IConduit.Eof where there's no more content available

        Note that a timeout is equivalent to Eof. Isolating
        a timeout condition can be achieved via hadTimeout() 

        Note also that a zero return value is not legitimate; 
        such a value indicates Eof

        ***********************************************************************/</span>

        <span class='kw4'>private</span> SocketSet       ss;
        <span class='kw4'>private</span> timeval         tv;
    <span class='kw4'>private</span> <span class='kw4'>bool</span>        timeout;

        <span class='kw4'>protected</span> <span class='kw4'>uint</span> reader <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> dst<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>// ensure just one read at a time </span>
                <span class='kw4'>synchronized</span> <span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>
                <span class='opr'>{</span>
        <span class='com'>// reset timeout; we assume there's no thread contention</span>
        timeout <span class='opr'>=</span> <span class='kw2'>false</span>;

                <span class='com'>// did user disable timeout checks?</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>tv.tv_usec<span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='com'>// nope: ensure we have a SocketSet</span>
                   <span class='kw1'>if</span> <span class='opr'>(</span>ss <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                       ss <span class='opr'>=</span> <span class='kw2'>new</span> SocketSet <span class='opr'>(</span><span class='nbr'>1</span><span class='opr'>)</span>;

                   ss.reset <span class='opr'>(</span><span class='opr'>)</span>;
                   ss.add <span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>;

                   <span class='com'>// wait until data is available, or a timeout occurs</span>
                   <span class='kw4'>int</span> i <span class='opr'>=</span> select <span class='opr'>(</span>ss, <span class='kw2'>null</span>, <span class='kw2'>null</span>, <span class='opr'>&amp;</span>tv<span class='opr'>)</span>;
           <span class='kw1'>if</span> <span class='opr'>(</span>i <span class='opr'>&lt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                      <span class='opr'>{</span>
              <span class='kw1'>if</span> <span class='opr'>(</span>i <span class='opr'>=</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
              timeout <span class='opr'>=</span> <span class='kw2'>true</span>;
                      <span class='kw1'>return</span> Eof;
                      <span class='opr'>}</span>
                   <span class='opr'>}</span>

                <span class='kw4'>int</span> count <span class='opr'>=</span> receive <span class='opr'>(</span>dst<span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>count <span class='opr'>&lt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                    count <span class='opr'>=</span> Eof;
                <span class='kw1'>return</span> count;
                <span class='opr'>}</span>
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Callback routine to write the provided content to the 
                socket. This will stall until the socket responds in
                some manner. Returns the number of bytes sent to the
                output, or IConduit.Eof if the socket cannot write.

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>uint</span> writer <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> src<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> count <span class='opr'>=</span> send <span class='opr'>(</span>src<span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>count <span class='opr'>&lt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                    count <span class='opr'>=</span> Eof;
                <span class='kw1'>return</span> count;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return a preferred size for buffering conduit I/O

        ***********************************************************************/</span>

        <span class='kw4'>uint</span> bufferSize <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='nbr'>1024</span> <span class='opr'>*</span> <span class='nbr'>8</span>;
        <span class='opr'>}</span>
                     
        <span class='com'>/***********************************************************************
        
                Return the underlying OS handle of this Conduit

        ***********************************************************************/</span>

        <span class='kw4'>final</span> Handle getHandle <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span>Handle<span class='opr'>)</span> sock;
        <span class='opr'>}</span>
                     
        <span class='com'>/***********************************************************************
        
                Set the read timeout to the specified microseconds. Set a 
                value of zero to disable timeout support.

        ***********************************************************************/</span>

        <span class='kw4'>void</span> setTimeout <span class='opr'>(</span>Interval us<span class='opr'>)</span>
        <span class='opr'>{</span>
                tv.tv_sec <span class='opr'>=</span> us / Interval.second;
                tv.tv_usec <span class='opr'>=</span> us <span class='opr'>%</span> Interval.second;
        <span class='opr'>}</span>
                         
        <span class='com'>/***********************************************************************
        
        Did the last operation result in a timeout? Note that this
        assumes there is no thread contention on this object.        

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> hadTimeout <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
        <span class='kw1'>return</span> timeout;
        <span class='opr'>}</span>
                         
        <span class='com'>/***********************************************************************

                Is this socket still alive?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> isAlive<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> type, typesize <span class='opr'>=</span> type.sizeof;
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>bool</span><span class='opr'>)</span> <span class='opr'>(</span>getsockopt <span class='opr'>(</span>sock, SOL_SOCKET, SO_TYPE, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span><span class='opr'>)</span> <span class='opr'>&amp;</span>type, <span class='opr'>&amp;</span>typesize<span class='opr'>)</span> <span class='opr'>!=</span> SOCKET_ERROR<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************
        
                MANGO: moved this out from the above constructor so that it
                can be called from the FreeList version of SocketConduit

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> set <span class='opr'>(</span>socket_t sock<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span>.sock <span class='opr'>=</span> sock;
        <span class='opr'>}</span>
                
        <span class='com'>/***********************************************************************
        
                MANGO: added to reset socket

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> reset <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span>.sock <span class='opr'>=</span> INVALID_SOCKET;

                <span class='com'>// dump all filters</span>
                <span class='kw2'>super</span>.close<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw2'>this</span> <span class='opr'>(</span>AddressFamily af, Type type, Protocol protocol<span class='opr'>)</span>
        <span class='opr'>{</span>
                create <span class='opr'>(</span>af, type, protocol<span class='opr'>)</span>;

                <span class='kw2'>super</span> <span class='opr'>(</span>ConduitStyle.ReadWrite, <span class='kw2'>false</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                Create a new socket for binding during another join() or
                connect(), since there doesn't appear to be another means
         
        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> create <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>// can't be abstract, so throw excepion instead</span>
                <span class='kw2'>throw</span> <span class='kw2'>new</span> SocketException <span class='opr'>(</span><span class='str'>&quot;Socket.create() must be overridden&quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************

                MANGO: added for multicast support

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> create <span class='opr'>(</span>AddressFamily af, Type type, Protocol protocol<span class='opr'>)</span>
        <span class='opr'>{</span>
                sock <span class='opr'>=</span> socket <span class='opr'>(</span>af, type, protocol<span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>sock <span class='opr'>=</span><span class='opr'>=</span> sock.init<span class='opr'>)</span>
                   exception<span class='opr'>(</span><span class='str'>&quot;Unable to create socket: &quot;</span><span class='opr'>)</span>;
                _family <span class='opr'>=</span> af;
        <span class='opr'>}</span>
        

        <span class='com'>/***********************************************************************
        
                Re-open this socket

        ***********************************************************************/</span>

        <span class='kw4'>void</span> reopen <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>// drop the original socket handle</span>
                close <span class='opr'>(</span><span class='opr'>)</span>;

                <span class='com'>// create a new socket for binding or connecting, since</span>
                <span class='com'>// there doesn't appear to be a means of unbinding</span>
                create <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        <span class='com'>/***********************************************************************

                get underlying socket handle

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> socket_t handle<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> sock;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>override</span> <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> toString<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='str'>&quot;Socket&quot;</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                getter

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>bool</span> blocking<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> _blocking;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span><span class='opr'>(</span>BsdSockets<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> !<span class='opr'>(</span>fcntl<span class='opr'>(</span>handle, F_GETFL, <span class='nbr'>0</span><span class='opr'>)</span> <span class='opr'>&amp;</span> O_NONBLOCK<span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                setter

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> blocking<span class='opr'>(</span><span class='kw4'>bool</span> byes<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw4'>uint</span> num <span class='opr'>=</span> !byes;
                        <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> ioctlsocket<span class='opr'>(</span>sock, FIONBIO, <span class='opr'>&amp;</span>num<span class='opr'>)</span><span class='opr'>)</span>
                                <span class='kw1'>goto</span> err;
                        _blocking <span class='opr'>=</span> byes;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span><span class='opr'>(</span>BsdSockets<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw4'>int</span> x <span class='opr'>=</span> fcntl<span class='opr'>(</span>handle, F_GETFL, <span class='nbr'>0</span><span class='opr'>)</span>;
                        <span class='kw1'>if</span><span class='opr'>(</span>byes<span class='opr'>)</span>
                                x <span class='opr'>&amp;=</span> <span class='opr'>~</span>O_NONBLOCK;
                        <span class='kw1'>else</span>
                                x <span class='opr'>|=</span> O_NONBLOCK;
                        <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> fcntl<span class='opr'>(</span>sock, F_SETFL, x<span class='opr'>)</span><span class='opr'>)</span>
                                <span class='kw1'>goto</span> err;
                <span class='opr'>}</span>
                <span class='kw1'>return</span>; <span class='com'>//success</span>
                
                err:
                exception<span class='opr'>(</span><span class='str'>&quot;Unable to set socket blocking: &quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> AddressFamily addressFamily<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> _family;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> bind<span class='opr'>(</span>Address addr<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .bind <span class='opr'>(</span>sock, addr.name<span class='opr'>(</span><span class='opr'>)</span>, addr.nameLen<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span><span class='opr'>)</span>
                   exception <span class='opr'>(</span><span class='str'>&quot;Unable to bind socket: &quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>
 
        <span class='kw4'>void</span> connect<span class='opr'>(</span>Address to<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .connect <span class='opr'>(</span>sock, to.name<span class='opr'>(</span><span class='opr'>)</span>, to.nameLen<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>if</span><span class='opr'>(</span>!blocking<span class='opr'>)</span>
                        <span class='opr'>{</span>
                                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                                <span class='opr'>{</span>
                                        <span class='kw1'>if</span><span class='opr'>(</span>WSAEWOULDBLOCK <span class='opr'>=</span><span class='opr'>=</span> WSAGetLastError<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>
                                                <span class='kw1'>return</span>;
                                <span class='opr'>}</span>
                                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                                <span class='opr'>{</span>
                                        <span class='kw1'>if</span><span class='opr'>(</span>EINPROGRESS <span class='opr'>=</span><span class='opr'>=</span> errno<span class='opr'>)</span>
                                                <span class='kw1'>return</span>;
                                <span class='opr'>}</span>
                                <span class='kw1'>else</span>
                                <span class='opr'>{</span>
                                        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                                <span class='opr'>}</span>
                        <span class='opr'>}</span>
                        exception <span class='opr'>(</span><span class='str'>&quot;Unable to connect socket: &quot;</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                need to bind() first

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> listen<span class='opr'>(</span><span class='kw4'>int</span> backlog<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .listen <span class='opr'>(</span>sock, backlog<span class='opr'>)</span><span class='opr'>)</span>
                   exception <span class='opr'>(</span><span class='str'>&quot;Unable to listen on socket: &quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        <span class='com'>/***********************************************************************

                MANGO: added

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> Socket createSocket <span class='opr'>(</span>socket_t handle<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>new</span> Socket <span class='opr'>(</span>handle<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> Socket accept<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>       
                socket_t newsock <span class='opr'>=</span> .accept <span class='opr'>(</span>sock, <span class='kw2'>null</span>, <span class='kw2'>null</span><span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>INVALID_SOCKET <span class='opr'>=</span><span class='opr'>=</span> newsock<span class='opr'>)</span>
                   <span class='com'>// MANGO: return null rather than throwing an exception because</span>
                   <span class='com'>// this is a valid condition upon thread-termination.</span>
                  <span class='opr'>{</span>
                  <span class='kw1'>return</span> <span class='kw2'>null</span>;
                  <span class='com'>//exception(&quot;Unable to accept socket connection.&quot;);</span>
                  <span class='opr'>}</span>

                <span class='com'>// MANGO: changed to indirect construction</span>
                Socket newSocket <span class='opr'>=</span> createSocket <span class='opr'>(</span>newsock<span class='opr'>)</span>;

                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                        newSocket._blocking <span class='opr'>=</span> _blocking; <span class='com'>//inherits blocking mode</span>
                newSocket._family <span class='opr'>=</span> _family; <span class='com'>//same family</span>
                <span class='kw1'>return</span> newSocket;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>void</span> shutdown<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>       <span class='com'>//printf (&quot;shutdown\n&quot;);</span>
                .shutdown <span class='opr'>(</span>sock, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span> Shutdown.BOTH<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> shutdown<span class='opr'>(</span>Shutdown how<span class='opr'>)</span>
        <span class='opr'>{</span>
                .shutdown <span class='opr'>(</span>sock, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>how<span class='opr'>)</span>;
        <span class='opr'>}</span>
        

        <span class='com'>/***********************************************************************

                MANGO: added

        ***********************************************************************/</span>

        <span class='kw4'>void</span> setLingerPeriod <span class='opr'>(</span><span class='kw4'>int</span> period<span class='opr'>)</span>
        <span class='opr'>{</span>
                linger l;

                l.l_onoff <span class='opr'>=</span> <span class='nbr'>1</span>;                          <span class='com'>//option on/off</span>
                l.l_linger <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>ushort</span><span class='opr'>)</span> period;       <span class='com'>//linger time</span>
        
                setOption <span class='opr'>(</span>OptionLevel.SOCKET, Option.SO_LINGER, l.array<span class='opr'>)</span>;
        <span class='opr'>}</span>
        

        <span class='com'>/***********************************************************************


                MANGO: added

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> setAddressReuse <span class='opr'>(</span><span class='kw4'>bool</span> enabled<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span><span class='opr'>[</span><span class='nbr'>1</span><span class='opr'>]</span> x <span class='opr'>=</span> enabled;
                setOption <span class='opr'>(</span>OptionLevel.SOCKET, Option.SO_REUSEADDR, x<span class='opr'>)</span>;
        <span class='opr'>}</span>

        
        <span class='com'>/***********************************************************************

                Helper function to handle the adding and dropping of group
                membership.

                MANGO: Added

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>bool</span> setGroup <span class='opr'>(</span>InternetAddress address, Option option<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>struct</span> ip_mreq 
                <span class='opr'>{</span>
                <span class='kw4'>uint</span>  imr_multiaddr;  <span class='com'>/* IP multicast address of group */</span>
                <span class='kw4'>uint</span>  imr_interface;  <span class='com'>/* local IP address of interface */</span>
                <span class='opr'>}</span>;

                ip_mreq mrq;

                mrq.imr_interface <span class='opr'>=</span> <span class='nbr'>0</span>;
                mrq.imr_multiaddr <span class='opr'>=</span> address.sin.sin_addr;
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>bool</span><span class='opr'>)</span> <span class='opr'>(</span>.setsockopt<span class='opr'>(</span>handle<span class='opr'>(</span><span class='opr'>)</span>, OptionLevel.IP, option, <span class='opr'>&amp;</span>mrq, mrq.sizeof<span class='opr'>)</span> <span class='opr'>!=</span> SOCKET_ERROR<span class='opr'>)</span>;
        <span class='opr'>}</span>


        <span class='com'>/***********************************************************************

                calling shutdown() before this is recommended for connection-
                oriented sockets

        ***********************************************************************/</span>

        <span class='kw4'>override</span> <span class='kw4'>void</span> close <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.close <span class='opr'>(</span><span class='opr'>)</span>;
                collect <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>       
        
        <span class='com'>/***********************************************************************

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>void</span> collect <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>sock <span class='opr'>!=</span> sock.init<span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw4'>version</span> <span class='opr'>(</span>TraceLinux<span class='opr'>)</span>
                            printf <span class='opr'>(</span><span class='str'>&quot;closing socket handle ...\n&quot;</span><span class='opr'>)</span>;

                   <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                           .closesocket <span class='opr'>(</span>sock<span class='opr'>)</span>;
                   <span class='kw1'>else</span> 
                   <span class='kw4'>version</span><span class='opr'>(</span>BsdSockets<span class='opr'>)</span>
                           .close <span class='opr'>(</span>sock<span class='opr'>)</span>;

                   <span class='kw4'>version</span> <span class='opr'>(</span>TraceLinux<span class='opr'>)</span>
                            printf <span class='opr'>(</span><span class='str'>&quot;socket handle closed\n&quot;</span><span class='opr'>)</span>;

                   sock <span class='opr'>=</span> sock.init;
                   <span class='opr'>}</span>
        <span class='opr'>}</span>       
        
        <span class='com'>/***********************************************************************

        ***********************************************************************/</span>

        <span class='opr'>~</span><span class='kw2'>this</span> <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>! isHalting<span class='opr'>)</span>
                       collect <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>private</span> Address newFamilyObject <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                Address result;
                <span class='kw1'>switch</span><span class='opr'>(</span>_family<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>case</span> AddressFamily.INET:
                                result <span class='opr'>=</span> <span class='kw2'>new</span> InternetAddress;
                                <span class='kw1'>break</span>;
                        
                        <span class='kw2'>default</span>:
                                result <span class='opr'>=</span> <span class='kw2'>new</span> UnknownAddress;
                <span class='opr'>}</span>
                <span class='kw1'>return</span> result;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                Mango: added this to return the hostname

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>static</span> <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> hostName <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>64</span><span class='opr'>]</span> name;

                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .gethostname <span class='opr'>(</span>name, name.length<span class='opr'>)</span><span class='opr'>)</span>
                   exception <span class='opr'>(</span><span class='str'>&quot;Unable to obtain host name: &quot;</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> name <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> strlen<span class='opr'>(</span>name<span class='opr'>)</span><span class='opr'>]</span>.dup;
        <span class='opr'>}</span>
        

        <span class='com'>/***********************************************************************

                Mango: added this to return the default host address (IPv4)

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>static</span> <span class='kw4'>uint</span> hostAddress <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                InternetHost ih <span class='opr'>=</span> <span class='kw2'>new</span> InternetHost;

                <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> hostname <span class='opr'>=</span> hostName<span class='opr'>(</span><span class='opr'>)</span>;
                ih.getHostByName <span class='opr'>(</span>hostname<span class='opr'>)</span>;
                <span class='kw2'>assert</span> <span class='opr'>(</span>ih.addrList.length<span class='opr'>)</span>;
                <span class='kw1'>return</span> ih.addrList<span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span>;
        <span class='opr'>}</span>

        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        Address remoteAddress <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                Address addr <span class='opr'>=</span> newFamilyObject <span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw4'>int</span> nameLen <span class='opr'>=</span> addr.nameLen <span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .getpeername <span class='opr'>(</span>sock, addr.name<span class='opr'>(</span><span class='opr'>)</span>, <span class='opr'>&amp;</span>nameLen<span class='opr'>)</span><span class='opr'>)</span>
                   exception <span class='opr'>(</span><span class='str'>&quot;Unable to obtain remote socket address: &quot;</span><span class='opr'>)</span>;
                <span class='kw2'>assert</span> <span class='opr'>(</span>addr.addressFamily<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>=</span><span class='opr'>=</span> _family<span class='opr'>)</span>;
                <span class='kw1'>return</span> addr;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        Address localAddress <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                Address addr <span class='opr'>=</span> newFamilyObject <span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw4'>int</span> nameLen <span class='opr'>=</span> addr.nameLen<span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .getsockname <span class='opr'>(</span>sock, addr.name<span class='opr'>(</span><span class='opr'>)</span>, <span class='opr'>&amp;</span>nameLen<span class='opr'>)</span><span class='opr'>)</span>
                   exception <span class='opr'>(</span><span class='str'>&quot;Unable to obtain local socket address: &quot;</span><span class='opr'>)</span>;
                <span class='kw2'>assert</span> <span class='opr'>(</span>addr.addressFamily<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>=</span><span class='opr'>=</span> _family<span class='opr'>)</span>;
                <span class='kw1'>return</span> addr;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                returns number of bytes actually sent, or -1 on error

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> send <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, Flags flags <span class='opr'>=</span> Flags.NONE<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> sent <span class='opr'>=</span> .send <span class='opr'>(</span>sock, buf, buf.length, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>flags<span class='opr'>)</span>;
                <span class='kw1'>return</span> sent;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                -to- is ignored if connected ?

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> sendTo <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, Flags flags, Address to<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> sent <span class='opr'>=</span> .sendto <span class='opr'>(</span>sock, buf, buf.length, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>flags, to.name<span class='opr'>(</span><span class='opr'>)</span>, to.nameLen<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> sent;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                -to- is ignored if connected ?

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> sendTo <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, Address to<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> sendTo <span class='opr'>(</span>buf, Flags.NONE, to<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                assumes you connect()ed

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> sendTo <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, Flags flags <span class='opr'>=</span> Flags.NONE<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> sent <span class='opr'>=</span> .sendto <span class='opr'>(</span>sock, buf, buf.length, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>flags, <span class='kw2'>null</span>, <span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> sent;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                returns number of bytes actually received, 0 on connection 
                closure, or -1 on error

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> receive <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, Flags flags <span class='opr'>=</span> Flags.NONE<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>!buf.length<span class='opr'>)</span> <span class='com'>//return 0 and don't think the connection closed</span>
                        <span class='kw1'>return</span> <span class='nbr'>0</span>;
                <span class='kw4'>int</span> read <span class='opr'>=</span> .recv<span class='opr'>(</span>sock, buf, buf.length, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>flags<span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>read <span class='opr'>=</span><span class='opr'>=</span> SOCKET_ERROR<span class='opr'>)</span>
                    exception <span class='opr'>(</span><span class='str'>&quot;during socket recieve: &quot;</span><span class='opr'>)</span>;
                <span class='com'>// if(!read) //connection closed</span>
                <span class='kw1'>return</span> read;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                -from- is ignored if connected ?

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> receiveFrom <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, Flags flags, <span class='kw2'>out</span> Address from<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>!buf.length<span class='opr'>)</span> <span class='com'>//return 0 and don't think the connection closed</span>
                        <span class='kw1'>return</span> <span class='nbr'>0</span>;
                <span class='kw4'>version</span> <span class='opr'>(</span>TraceLinux<span class='opr'>)</span>
                        <span class='opr'>{</span>
                        printf <span class='opr'>(</span><span class='str'>&quot;executing recvFrom() \n&quot;</span><span class='opr'>)</span>;
                        <span class='opr'>}</span>
                from <span class='opr'>=</span> newFamilyObject <span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw4'>int</span> nameLen <span class='opr'>=</span> from.nameLen <span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw4'>int</span> read <span class='opr'>=</span> .recvfrom <span class='opr'>(</span>sock, buf, buf.length, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>flags, from.name<span class='opr'>(</span><span class='opr'>)</span>, <span class='opr'>&amp;</span>nameLen<span class='opr'>)</span>;
                <span class='kw4'>version</span> <span class='opr'>(</span>TraceLinux<span class='opr'>)</span>
                        <span class='opr'>{</span>
                        printf <span class='opr'>(</span><span class='str'>&quot;recvFrom returns %d\n&quot;</span>, read<span class='opr'>)</span>;
                        <span class='opr'>}</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>read <span class='opr'>=</span><span class='opr'>=</span> SOCKET_ERROR<span class='opr'>)</span>
                    exception <span class='opr'>(</span><span class='str'>&quot;during socket recieve: &quot;</span><span class='opr'>)</span>;

                <span class='kw2'>assert</span> <span class='opr'>(</span>from.addressFamily<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>=</span><span class='opr'>=</span> _family<span class='opr'>)</span>;
                <span class='com'>// if(!read) //connection closed</span>
                <span class='kw1'>return</span> read;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                -from- is ignored if connected ?

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> receiveFrom <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, <span class='kw2'>out</span> Address from<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> receiveFrom <span class='opr'>(</span>buf, Flags.NONE, from<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                assumes you connect()ed

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> receiveFrom <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf, Flags flags<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>!buf.length<span class='opr'>)</span> <span class='com'>//return 0 and don't think the connection closed</span>
                        <span class='kw1'>return</span> <span class='nbr'>0</span>;
                <span class='kw4'>int</span> read <span class='opr'>=</span> .recvfrom <span class='opr'>(</span>sock, buf, buf.length, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>flags, <span class='kw2'>null</span>, <span class='kw2'>null</span><span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>read <span class='opr'>=</span><span class='opr'>=</span> SOCKET_ERROR<span class='opr'>)</span>
                    exception <span class='opr'>(</span><span class='str'>&quot;during socket recieve: &quot;</span><span class='opr'>)</span>;
                <span class='com'>// if(!read) //connection closde</span>
                <span class='kw1'>return</span> read;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                assumes you connect()ed

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> receiveFrom <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> buf<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> receiveFrom <span class='opr'>(</span>buf, Flags.NONE<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                returns the length, in bytes, of the actual result - very 
                different from getsockopt()

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>int</span> getOption <span class='opr'>(</span>OptionLevel level, Option option, <span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> result<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> len <span class='opr'>=</span> result.length;
                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .getsockopt <span class='opr'>(</span>sock, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>level, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>option, result, <span class='opr'>&amp;</span>len<span class='opr'>)</span><span class='opr'>)</span>
                   exception <span class='opr'>(</span><span class='str'>&quot;Unable to get socket option: &quot;</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> len;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> setOption <span class='opr'>(</span>OptionLevel level, Option option, <span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> value<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>SOCKET_ERROR <span class='opr'>=</span><span class='opr'>=</span> .setsockopt <span class='opr'>(</span>sock, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>level, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>option, value, value.length<span class='opr'>)</span><span class='opr'>)</span>
                   exception <span class='opr'>(</span><span class='str'>&quot;Unable to set socket option: &quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                Mango: added this common function

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>static</span> <span class='kw4'>void</span> exception <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>throw</span> <span class='kw2'>new</span> SocketException <span class='opr'>(</span>msg <span class='opr'>~</span> OS.error <span class='opr'>(</span>lastError<span class='opr'>)</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        

        <span class='com'>/***********************************************************************

                SocketSet's are updated to include only those sockets which an 
                event occured.
                
                Returns the number of events, 0 on timeout, or -1 on interruption

                for a connect()ing socket, writeability means connected 
                for a listen()ing socket, readability means listening 

                Winsock: possibly internally limited to 64 sockets per set

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>static</span> <span class='kw4'>int</span> select <span class='opr'>(</span>SocketSet checkRead, SocketSet checkWrite, SocketSet checkError, timeval<span class='opr'>*</span> tv<span class='opr'>)</span>
        <span class='kw2'>in</span>
        <span class='opr'>{</span>
                <span class='com'>//make sure none of the SocketSet's are the same object</span>
                <span class='kw1'>if</span><span class='opr'>(</span>checkRead<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw2'>assert</span><span class='opr'>(</span>checkRead !<span class='kw2'>is</span> checkWrite<span class='opr'>)</span>;
                        <span class='kw2'>assert</span><span class='opr'>(</span>checkRead !<span class='kw2'>is</span> checkError<span class='opr'>)</span>;
                <span class='opr'>}</span>
                <span class='kw1'>if</span><span class='opr'>(</span>checkWrite<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw2'>assert</span><span class='opr'>(</span>checkWrite !<span class='kw2'>is</span> checkError<span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        <span class='kw2'>body</span>
        <span class='opr'>{</span>
                fd_set<span class='opr'>*</span> fr, fw, fe;
                
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='com'>//Windows has a problem with empty fd_set's that aren't null</span>
                        fr <span class='opr'>=</span> <span class='opr'>(</span>checkRead &amp;&amp; checkRead.count<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span> ? checkRead.toFd_set<span class='opr'>(</span><span class='opr'>)</span> : <span class='kw2'>null</span>;
                        fw <span class='opr'>=</span> <span class='opr'>(</span>checkWrite &amp;&amp; checkWrite.count<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span> ? checkWrite.toFd_set<span class='opr'>(</span><span class='opr'>)</span> : <span class='kw2'>null</span>;
                        fe <span class='opr'>=</span> <span class='opr'>(</span>checkError &amp;&amp; checkError.count<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span> ? checkError.toFd_set<span class='opr'>(</span><span class='opr'>)</span> : <span class='kw2'>null</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        fr <span class='opr'>=</span> checkRead ? checkRead.toFd_set<span class='opr'>(</span><span class='opr'>)</span> : <span class='kw2'>null</span>;
                        fw <span class='opr'>=</span> checkWrite ? checkWrite.toFd_set<span class='opr'>(</span><span class='opr'>)</span> : <span class='kw2'>null</span>;
                        fe <span class='opr'>=</span> checkError ? checkError.toFd_set<span class='opr'>(</span><span class='opr'>)</span> : <span class='kw2'>null</span>;
                <span class='opr'>}</span>
               
                <span class='kw4'>int</span> result;
              
                <span class='com'>// MANGO: if select() was interrupted, we now try again</span>
                <span class='kw1'>while</span> <span class='opr'>(</span><span class='opr'>(</span>result <span class='opr'>=</span> .select <span class='opr'>(</span>socket_t.max <span class='opr'>-</span> <span class='nbr'>1</span>, fr, fw, fe, tv<span class='opr'>)</span><span class='opr'>)</span> <span class='opr'>=</span><span class='opr'>=</span> <span class='opr'>-</span><span class='nbr'>1</span><span class='opr'>)</span>              
                        <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                        <span class='opr'>{</span>
                                <span class='kw1'>if</span><span class='opr'>(</span>WSAGetLastError<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>!=</span> WSAEINTR<span class='opr'>)</span>
                                   <span class='kw1'>break</span>;
                        <span class='opr'>}</span>
                        <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                        <span class='opr'>{</span>
                                <span class='kw1'>if</span><span class='opr'>(</span>errno <span class='opr'>!=</span> EINTR<span class='opr'>)</span>
                                   <span class='kw1'>break</span>;
                        <span class='opr'>}</span>
                        <span class='kw1'>else</span>
                        <span class='opr'>{</span>
                                <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                        <span class='opr'>}</span>
                
                <span class='com'>// MANGO: don't throw an exception here ... wait until we get </span>
                <span class='com'>// a bit further back along the control path</span>
                <span class='com'>//if(SOCKET_ERROR == result)</span>
                <span class='com'>//   throw new SocketException(&quot;Socket select error.&quot;);</span>
                
                <span class='kw1'>return</span> result;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>static</span> <span class='kw4'>int</span> select <span class='opr'>(</span>SocketSet checkRead, SocketSet checkWrite, SocketSet checkError, <span class='kw4'>int</span> microseconds<span class='opr'>)</span>
        <span class='opr'>{</span>
                timeval tv;
                tv.tv_sec <span class='opr'>=</span> <span class='nbr'>0</span>;
                tv.tv_usec <span class='opr'>=</span> microseconds;
                <span class='kw1'>return</span> select <span class='opr'>(</span>checkRead, checkWrite, checkError, <span class='opr'>&amp;</span>tv<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                maximum timeout

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>static</span> <span class='kw4'>int</span> select <span class='opr'>(</span>SocketSet checkRead, SocketSet checkWrite, SocketSet checkError<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> select <span class='opr'>(</span>checkRead, checkWrite, checkError, <span class='kw2'>null</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='com'>/+
        bool poll (events)
        {
                int WSAEventSelect(socket_t s, WSAEVENT hEventObject, int lNetworkEvents); // Winsock 2 ?
                int poll(pollfd* fds, int nfds, int timeout); // Unix ?
        }
        +/</span>


<span class='opr'>}</span>



<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>abstract</span> <span class='kw4'>class</span> Address
<span class='opr'>{</span>
        <span class='kw4'>protected</span> sockaddr<span class='opr'>*</span> name<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='kw4'>protected</span> <span class='kw4'>int</span> nameLen<span class='opr'>(</span><span class='opr'>)</span>;
        Socket.AddressFamily addressFamily<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> toString<span class='opr'>(</span><span class='opr'>)</span>;

        <span class='com'>/***********************************************************************

                Mango: added this common function

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>static</span> <span class='kw4'>void</span> exception <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>throw</span> <span class='kw2'>new</span> AddressException <span class='opr'>(</span>msg<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>class</span> UnknownAddress: Address
<span class='opr'>{</span>
        <span class='kw4'>protected</span>:
        sockaddr sa;
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        sockaddr<span class='opr'>*</span> name<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='opr'>&amp;</span>sa;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>int</span> nameLen<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> sa.sizeof;
        <span class='opr'>}</span>
        
        
        <span class='kw4'>public</span>:
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        Socket.AddressFamily addressFamily<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span>Socket.AddressFamily<span class='opr'>)</span>sa.sa_family;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> toString<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='str'>&quot;Unknown&quot;</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>class</span> InternetHost
<span class='opr'>{</span>
        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> name;
        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span><span class='opr'>[</span><span class='opr'>]</span> aliases;
        <span class='kw4'>uint</span><span class='opr'>[</span><span class='opr'>]</span> addrList;
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>void</span> validHostent<span class='opr'>(</span>hostent<span class='opr'>*</span> he<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span><span class='opr'>(</span>he.h_addrtype <span class='opr'>!=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>Socket.AddressFamily.INET || he.h_length <span class='opr'>!=</span> <span class='nbr'>4</span><span class='opr'>)</span>
                        <span class='kw2'>throw</span> <span class='kw2'>new</span> HostException<span class='opr'>(</span><span class='str'>&quot;Address family mismatch.&quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>void</span> populate<span class='opr'>(</span>hostent<span class='opr'>*</span> he<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> i;
                <span class='kw4'>char</span><span class='opr'>*</span> p;
                
                name <span class='opr'>=</span> .toString<span class='opr'>(</span>he.h_name<span class='opr'>)</span>;
                
                <span class='kw1'>for</span><span class='opr'>(</span>i <span class='opr'>=</span> <span class='nbr'>0</span>;; i<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        p <span class='opr'>=</span> he.h_aliases<span class='opr'>[</span>i<span class='opr'>]</span>;
                        <span class='kw1'>if</span><span class='opr'>(</span>!p<span class='opr'>)</span>
                                <span class='kw1'>break</span>;
                <span class='opr'>}</span>
                
                <span class='kw1'>if</span><span class='opr'>(</span>i<span class='opr'>)</span>
                <span class='opr'>{</span>
                        aliases <span class='opr'>=</span> <span class='kw2'>new</span> <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span><span class='opr'>[</span>i<span class='opr'>]</span>;
                        <span class='kw1'>for</span><span class='opr'>(</span>i <span class='opr'>=</span> <span class='nbr'>0</span>; i <span class='opr'>!=</span> aliases.length; i<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>)</span>
                        <span class='opr'>{</span>
                                aliases<span class='opr'>[</span>i<span class='opr'>]</span> <span class='opr'>=</span> .toString<span class='opr'>(</span>he.h_aliases<span class='opr'>[</span>i<span class='opr'>]</span><span class='opr'>)</span>;
                        <span class='opr'>}</span>
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        aliases <span class='opr'>=</span> <span class='kw2'>null</span>;
                <span class='opr'>}</span>
                
                <span class='kw1'>for</span><span class='opr'>(</span>i <span class='opr'>=</span> <span class='nbr'>0</span>;; i<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        p <span class='opr'>=</span> he.h_addr_list<span class='opr'>[</span>i<span class='opr'>]</span>;
                        <span class='kw1'>if</span><span class='opr'>(</span>!p<span class='opr'>)</span>
                                <span class='kw1'>break</span>;
                <span class='opr'>}</span>
                
                <span class='kw1'>if</span><span class='opr'>(</span>i<span class='opr'>)</span>
                <span class='opr'>{</span>
                        addrList <span class='opr'>=</span> <span class='kw2'>new</span> <span class='kw4'>uint</span><span class='opr'>[</span>i<span class='opr'>]</span>;
                        <span class='kw1'>for</span><span class='opr'>(</span>i <span class='opr'>=</span> <span class='nbr'>0</span>; i <span class='opr'>!=</span> addrList.length; i<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>)</span>
                        <span class='opr'>{</span>
                                addrList<span class='opr'>[</span>i<span class='opr'>]</span> <span class='opr'>=</span> ntohl<span class='opr'>(</span><span class='opr'>*</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>*</span><span class='opr'>)</span>he.h_addr_list<span class='opr'>[</span>i<span class='opr'>]</span><span class='opr'>)</span><span class='opr'>)</span>;
                        <span class='opr'>}</span>
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        addrList <span class='opr'>=</span> <span class='kw2'>null</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>bool</span> getHostByName<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> name<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>1024</span><span class='opr'>]</span> tmp;
                
                hostent<span class='opr'>*</span> he <span class='opr'>=</span> gethostbyname<span class='opr'>(</span>convert2C <span class='opr'>(</span>name, tmp<span class='opr'>)</span><span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>!he<span class='opr'>)</span>
                        <span class='kw1'>return</span> <span class='kw2'>false</span>;
                validHostent<span class='opr'>(</span>he<span class='opr'>)</span>;
                populate<span class='opr'>(</span>he<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>true</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>bool</span> getHostByAddr<span class='opr'>(</span><span class='kw4'>uint</span> addr<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> x <span class='opr'>=</span> htonl<span class='opr'>(</span>addr<span class='opr'>)</span>;
                hostent<span class='opr'>*</span> he <span class='opr'>=</span> gethostbyaddr<span class='opr'>(</span><span class='opr'>&amp;</span>x, <span class='nbr'>4</span>, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>Socket.AddressFamily.INET<span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>!he<span class='opr'>)</span>
                        <span class='kw1'>return</span> <span class='kw2'>false</span>;
                validHostent<span class='opr'>(</span>he<span class='opr'>)</span>;
                populate<span class='opr'>(</span>he<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>true</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='com'>//shortcut</span>
        <span class='kw4'>bool</span> getHostByAddr<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> addr<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>64</span><span class='opr'>]</span> tmp;
                
                <span class='kw4'>uint</span> x <span class='opr'>=</span> inet_addr<span class='opr'>(</span>convert2C <span class='opr'>(</span>addr, tmp<span class='opr'>)</span><span class='opr'>)</span>;
                hostent<span class='opr'>*</span> he <span class='opr'>=</span> gethostbyaddr<span class='opr'>(</span><span class='opr'>&amp;</span>x, <span class='nbr'>4</span>, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span>Socket.AddressFamily.INET<span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>!he<span class='opr'>)</span>
                        <span class='kw1'>return</span> <span class='kw2'>false</span>;
                validHostent<span class='opr'>(</span>he<span class='opr'>)</span>;
                populate<span class='opr'>(</span>he<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>true</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='kw4'>debug</span> <span class='opr'>(</span>UnitText<span class='opr'>)</span>
<span class='opr'>{</span>
<span class='kw2'>extern</span> <span class='opr'>(</span>C<span class='opr'>)</span> <span class='kw4'>int</span> printf<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>*</span>, <span class='opr'>..</span>.<span class='opr'>)</span>;
<span class='kw4'>unittest</span>
<span class='opr'>{</span>
        InternetHost ih <span class='opr'>=</span> <span class='kw2'>new</span> InternetHost;
        <span class='kw2'>assert</span><span class='opr'>(</span>ih.addrList.length<span class='opr'>)</span>;
        InternetAddress ia <span class='opr'>=</span> <span class='kw2'>new</span> InternetAddress<span class='opr'>(</span>ih.addrList<span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span>, InternetAddress.PORT_ANY<span class='opr'>)</span>;
        printf<span class='opr'>(</span><span class='str'>&quot;IP address = %.*s\nname = %.*s\n&quot;</span>, ia.toAddrString<span class='opr'>(</span><span class='opr'>)</span>, ih.name<span class='opr'>)</span>;
        <span class='kw1'>foreach</span><span class='opr'>(</span><span class='kw4'>int</span> i, <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> s; ih.aliases<span class='opr'>)</span>
        <span class='opr'>{</span>
                printf<span class='opr'>(</span><span class='str'>&quot;aliases[%d] = %.*s\n&quot;</span>, i, s<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        printf<span class='opr'>(</span><span class='str'>&quot;---\n&quot;</span><span class='opr'>)</span>;
        
        <span class='kw2'>assert</span><span class='opr'>(</span>ih.getHostByAddr<span class='opr'>(</span>ih.addrList<span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span><span class='opr'>)</span><span class='opr'>)</span>;
        printf<span class='opr'>(</span><span class='str'>&quot;name = %.*s\n&quot;</span>, ih.name<span class='opr'>)</span>;
        <span class='kw1'>foreach</span><span class='opr'>(</span><span class='kw4'>int</span> i, <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> s; ih.aliases<span class='opr'>)</span>
        <span class='opr'>{</span>
                printf<span class='opr'>(</span><span class='str'>&quot;aliases[%d] = %.*s\n&quot;</span>, i, s<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='kw4'>class</span> InternetAddress: Address
<span class='opr'>{</span>
        <span class='com'>/+
        #ifdef INCLUDE_ALL_FOR_DOXYGEN
        +/</span>
        <span class='kw4'>protected</span>:
        <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>8</span><span class='opr'>]</span> _port;

        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>struct</span> sockaddr_in
        <span class='opr'>{</span>
                <span class='kw4'>ushort</span> sin_family <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>ushort</span><span class='opr'>)</span>Socket.AddressFamily.INET;
                <span class='kw4'>ushort</span> sin_port;
                <span class='kw4'>uint</span> sin_addr; <span class='com'>//in_addr</span>
                <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>8</span><span class='opr'>]</span> sin_zero <span class='opr'>=</span> <span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span>;
        <span class='opr'>}</span>
        <span class='com'>/+
        #endif
        +/</span>

        sockaddr_in sin;
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        sockaddr<span class='opr'>*</span> name<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span>sockaddr<span class='opr'>*</span><span class='opr'>)</span><span class='opr'>&amp;</span>sin;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>int</span> nameLen<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> sin.sizeof;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw2'>this</span><span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
        <span class='opr'>}</span>
        
        
        <span class='kw4'>public</span>:
        <span class='kw4'>const</span> <span class='kw4'>uint</span> ADDR_ANY <span class='opr'>=</span> <span class='nbr'>0</span>;
        <span class='kw4'>const</span> <span class='kw4'>uint</span> ADDR_NONE <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span><span class='opr'>-</span><span class='nbr'>1</span>;
        <span class='kw4'>const</span> <span class='kw4'>ushort</span> PORT_ANY <span class='opr'>=</span> <span class='nbr'>0</span>;
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        Socket.AddressFamily addressFamily<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> Socket.AddressFamily.INET;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>ushort</span> port<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> ntohs<span class='opr'>(</span>sin.sin_port<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>uint</span> addr<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> ntohl<span class='opr'>(</span>sin.sin_addr<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                -port- can be PORT_ANY
                -addr- is an IP address or host name

        ***********************************************************************/</span>

        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> addr, <span class='kw4'>int</span> port <span class='opr'>=</span> PORT_ANY<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> uiaddr <span class='opr'>=</span> parse<span class='opr'>(</span>addr<span class='opr'>)</span>;
                <span class='kw1'>if</span><span class='opr'>(</span>ADDR_NONE <span class='opr'>=</span><span class='opr'>=</span> uiaddr<span class='opr'>)</span>
                <span class='opr'>{</span>
                        InternetHost ih <span class='opr'>=</span> <span class='kw2'>new</span> InternetHost;
                        <span class='kw1'>if</span><span class='opr'>(</span>!ih.getHostByName<span class='opr'>(</span>addr<span class='opr'>)</span><span class='opr'>)</span>
                                exception <span class='opr'>(</span><span class='str'>&quot;Unable to resolve '&quot;</span><span class='opr'>~</span>addr<span class='opr'>~</span><span class='str'>&quot;'&quot;</span><span class='opr'>)</span>;
                        uiaddr <span class='opr'>=</span> ih.addrList<span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span>;
                <span class='opr'>}</span>
                sin.sin_addr <span class='opr'>=</span> htonl<span class='opr'>(</span>uiaddr<span class='opr'>)</span>;
                sin.sin_port <span class='opr'>=</span> htons<span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>ushort</span><span class='opr'>)</span> port<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>uint</span> addr, <span class='kw4'>ushort</span> port<span class='opr'>)</span>
        <span class='opr'>{</span>
                sin.sin_addr <span class='opr'>=</span> htonl<span class='opr'>(</span>addr<span class='opr'>)</span>;
                sin.sin_port <span class='opr'>=</span> htons<span class='opr'>(</span>port<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>ushort</span> port<span class='opr'>)</span>
        <span class='opr'>{</span>
                sin.sin_addr <span class='opr'>=</span> <span class='nbr'>0</span>; <span class='com'>//any, &quot;0.0.0.0&quot;</span>
                sin.sin_port <span class='opr'>=</span> htons<span class='opr'>(</span>port<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        <span class='com'>/**********************************************************************
        
        **********************************************************************/</span>
        
        <span class='kw4'>static</span> InternetAddress create <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> host<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>foreach</span> <span class='opr'>(</span><span class='kw4'>int</span> i, <span class='kw4'>char</span> c; host<span class='opr'>)</span>
                         <span class='kw1'>if</span> <span class='opr'>(</span>c <span class='kw2'>is</span> <span class='str'>':'</span><span class='opr'>)</span>
                             <span class='kw1'>return</span> <span class='kw2'>new</span> InternetAddress <span class='opr'>(</span>host<span class='opr'>[</span><span class='nbr'>0.</span>.i<span class='opr'>]</span>, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span> Integer.parse <span class='opr'>(</span>host<span class='opr'>[</span>i<span class='opr'>+</span><span class='nbr'>1.</span>.$<span class='opr'>]</span><span class='opr'>)</span><span class='opr'>)</span>;

                exception <span class='opr'>(</span><span class='str'>&quot;missing port specification in &quot;</span><span class='opr'>~</span>host<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>null</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> toAddrString<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> .toString<span class='opr'>(</span>inet_ntoa<span class='opr'>(</span>sin.sin_addr<span class='opr'>)</span><span class='opr'>)</span>.dup;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> toPortString<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> Integer.format<span class='opr'>(</span>_port, port<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> toString<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> toAddrString<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>~</span> <span class='str'>&quot;:&quot;</span> <span class='opr'>~</span> toPortString<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                -addr- is an IP address in the format &quot;a.b.c.d&quot;
                returns ADDR_NONE on failure

        ***********************************************************************/</span>

        <span class='kw4'>static</span> <span class='kw4'>uint</span> parse<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> addr<span class='opr'>)</span>
        <span class='opr'>{</span>       
                <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>64</span><span class='opr'>]</span> tmp;

                <span class='kw1'>return</span> ntohl<span class='opr'>(</span>inet_addr<span class='opr'>(</span>convert2C <span class='opr'>(</span>addr, tmp<span class='opr'>)</span><span class='opr'>)</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>

<span class='kw4'>debug</span><span class='opr'>(</span>Unittest<span class='opr'>)</span>
<span class='opr'>{</span>
<span class='kw4'>unittest</span>
<span class='opr'>{</span>
        InternetAddress ia <span class='opr'>=</span> <span class='kw2'>new</span> InternetAddress<span class='opr'>(</span><span class='str'>&quot;63.105.9.61&quot;</span>, <span class='nbr'>80</span><span class='opr'>)</span>;
        <span class='kw2'>assert</span><span class='opr'>(</span>ia.toString<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>=</span><span class='opr'>=</span> <span class='str'>&quot;63.105.9.61:80&quot;</span><span class='opr'>)</span>;
<span class='opr'>}</span>
<span class='opr'>}</span>

<span class='com'>/*******************************************************************************


*******************************************************************************/</span>

<span class='com'>//a set of sockets for Socket.select()</span>
<span class='kw4'>class</span> SocketSet
<span class='opr'>{</span>
<span class='com'>//        private:</span>
        <span class='kw4'>private</span> <span class='kw4'>uint</span> nbytes; <span class='com'>//Win32: excludes uint.size &quot;count&quot;</span>
        <span class='kw4'>private</span> <span class='kw4'>byte</span><span class='opr'>*</span> buf;
        
        
        <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> count<span class='opr'>(</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> <span class='opr'>*</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>*</span><span class='opr'>)</span>buf<span class='opr'>)</span>;
                <span class='opr'>}</span>
                
                
                <span class='kw4'>void</span> count<span class='opr'>(</span><span class='kw4'>int</span> setter<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='opr'>*</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>*</span><span class='opr'>)</span>buf<span class='opr'>)</span> <span class='opr'>=</span> setter;
                <span class='opr'>}</span>
                
                
                socket_t<span class='opr'>*</span> first<span class='opr'>(</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span>socket_t<span class='opr'>*</span><span class='opr'>)</span><span class='opr'>(</span>buf <span class='opr'>+</span> <span class='kw4'>uint</span>.sizeof<span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>import</span> tango.core.intrinsic;
                
                
                <span class='kw4'>uint</span> nfdbits;
                
                
                <span class='kw4'>uint</span> fdelt<span class='opr'>(</span>socket_t s<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>s / nfdbits;
                <span class='opr'>}</span>
                
                
                <span class='kw4'>uint</span> fdmask<span class='opr'>(</span>socket_t s<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> <span class='nbr'>1</span> <span class='opr'>&lt;</span><span class='opr'>&lt;</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>s <span class='opr'>%</span> nfdbits;
                <span class='opr'>}</span>
                
                
                <span class='kw4'>uint</span><span class='opr'>*</span> first<span class='opr'>(</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>*</span><span class='opr'>)</span>buf;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='kw4'>public</span>:
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw2'>this</span><span class='opr'>(</span><span class='kw4'>uint</span> max<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        nbytes <span class='opr'>=</span> max <span class='opr'>*</span> socket_t.sizeof;
                        buf <span class='opr'>=</span> <span class='kw2'>new</span> <span class='kw4'>byte</span><span class='opr'>[</span>nbytes <span class='opr'>+</span> <span class='kw4'>uint</span>.sizeof<span class='opr'>]</span>;
                        count <span class='opr'>=</span> <span class='nbr'>0</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>if</span><span class='opr'>(</span>max <span class='opr'>&lt;</span><span class='opr'>=</span> <span class='nbr'>32</span><span class='opr'>)</span>
                                nbytes <span class='opr'>=</span> <span class='nbr'>32</span> <span class='opr'>*</span> <span class='kw4'>uint</span>.sizeof;
                        <span class='kw1'>else</span>
                                nbytes <span class='opr'>=</span> max <span class='opr'>*</span> <span class='kw4'>uint</span>.sizeof;
                        buf <span class='opr'>=</span> <span class='kw2'>new</span> <span class='kw4'>byte</span><span class='opr'>[</span>nbytes<span class='opr'>]</span>;
                        nfdbits <span class='opr'>=</span> nbytes <span class='opr'>*</span> <span class='nbr'>8</span>;
                        <span class='com'>//clear(); //new initializes to 0</span>
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw2'>this</span><span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw2'>this</span><span class='opr'>(</span><span class='nbr'>64</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw2'>this</span><span class='opr'>(</span><span class='nbr'>32</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>void</span> reset<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        count <span class='opr'>=</span> <span class='nbr'>0</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                <span class='opr'>{</span>
                        buf<span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> nbytes<span class='opr'>]</span> <span class='opr'>=</span> <span class='nbr'>0</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>void</span> add<span class='opr'>(</span>socket_t s<span class='opr'>)</span>
        <span class='kw2'>in</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw2'>assert</span><span class='opr'>(</span>count <span class='opr'>&lt;</span> max<span class='opr'>)</span>; <span class='com'>//added too many sockets; specify a higher max in the constructor</span>
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        <span class='kw2'>body</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw4'>uint</span> c <span class='opr'>=</span> count;
                        first<span class='opr'>[</span>c<span class='opr'>]</span> <span class='opr'>=</span> s;
                        count <span class='opr'>=</span> c <span class='opr'>+</span> <span class='nbr'>1</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                <span class='opr'>{</span>
                        bts<span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>*</span><span class='opr'>)</span><span class='opr'>&amp;</span>first<span class='opr'>[</span>fdelt<span class='opr'>(</span>s<span class='opr'>)</span><span class='opr'>]</span>, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>s <span class='opr'>%</span> nfdbits<span class='opr'>)</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>void</span> add<span class='opr'>(</span>Socket s<span class='opr'>)</span>
        <span class='opr'>{</span>
                add<span class='opr'>(</span>s.sock<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>void</span> remove<span class='opr'>(</span>socket_t s<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw4'>uint</span> c <span class='opr'>=</span> count;
                        socket_t<span class='opr'>*</span> start <span class='opr'>=</span> first;
                        socket_t<span class='opr'>*</span> stop <span class='opr'>=</span> start <span class='opr'>+</span> c;
                        
                        <span class='kw1'>for</span><span class='opr'>(</span>; start <span class='opr'>!=</span> stop; start<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>)</span>
                        <span class='opr'>{</span>
                                <span class='kw1'>if</span><span class='opr'>(</span><span class='opr'>*</span>start <span class='opr'>=</span><span class='opr'>=</span> s<span class='opr'>)</span>
                                        <span class='kw1'>goto</span> found;
                        <span class='opr'>}</span>
                        <span class='kw1'>return</span>; <span class='com'>//not found</span>
                        
                        found:
                        <span class='kw1'>for</span><span class='opr'>(</span><span class='opr'>+</span><span class='opr'>+</span>start; start <span class='opr'>!=</span> stop; start<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>)</span>
                        <span class='opr'>{</span>
                                <span class='opr'>*</span><span class='opr'>(</span>start <span class='opr'>-</span> <span class='nbr'>1</span><span class='opr'>)</span> <span class='opr'>=</span> <span class='opr'>*</span>start;
                        <span class='opr'>}</span>
                        
                        count <span class='opr'>=</span> c <span class='opr'>-</span> <span class='nbr'>1</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                <span class='opr'>{</span>
                        btr<span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>*</span><span class='opr'>)</span><span class='opr'>&amp;</span>first<span class='opr'>[</span>fdelt<span class='opr'>(</span>s<span class='opr'>)</span><span class='opr'>]</span>, <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>s <span class='opr'>%</span> nfdbits<span class='opr'>)</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>void</span> remove<span class='opr'>(</span>Socket s<span class='opr'>)</span>
        <span class='opr'>{</span>
                remove<span class='opr'>(</span>s.sock<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>int</span> isSet<span class='opr'>(</span>socket_t s<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span><span class='opr'>(</span>Win32<span class='opr'>)</span>
                <span class='opr'>{</span>
                        socket_t<span class='opr'>*</span> start <span class='opr'>=</span> first;
                        socket_t<span class='opr'>*</span> stop <span class='opr'>=</span> start <span class='opr'>+</span> count;
                        
                        <span class='kw1'>for</span><span class='opr'>(</span>; start <span class='opr'>!=</span> stop; start<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>)</span>
                        <span class='opr'>{</span>
                                <span class='kw1'>if</span><span class='opr'>(</span><span class='opr'>*</span>start <span class='opr'>=</span><span class='opr'>=</span> s<span class='opr'>)</span>
                                        <span class='kw1'>return</span> <span class='kw2'>true</span>;
                        <span class='opr'>}</span>
                        <span class='kw1'>return</span> <span class='kw2'>false</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span> <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='com'>//return bt(cast(uint*)&amp;first[fdelt(s)], cast(uint)s % nfdbits);</span>
                        <span class='kw4'>int</span> index <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>s <span class='opr'>%</span> nfdbits;
                        <span class='kw1'>return</span> <span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>*</span><span class='opr'>)</span><span class='opr'>&amp;</span>first<span class='opr'>[</span>fdelt<span class='opr'>(</span>s<span class='opr'>)</span><span class='opr'>]</span><span class='opr'>)</span><span class='opr'>[</span>index / <span class='opr'>(</span><span class='kw4'>uint</span>.sizeof<span class='opr'>*</span><span class='nbr'>8</span><span class='opr'>)</span><span class='opr'>]</span> <span class='opr'>&amp;</span> <span class='opr'>(</span><span class='nbr'>1</span> <span class='opr'>&lt;</span><span class='opr'>&lt;</span> <span class='opr'>(</span>index <span class='opr'>&amp;</span> <span class='opr'>(</span><span class='opr'>(</span><span class='kw4'>uint</span>.sizeof<span class='opr'>*</span><span class='nbr'>8</span><span class='opr'>)</span> <span class='opr'>-</span> <span class='nbr'>1</span><span class='opr'>)</span><span class='opr'>)</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
                <span class='kw1'>else</span>
                <span class='opr'>{</span>
                        <span class='kw4'>static</span> <span class='kw2'>assert</span><span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        <span class='kw4'>int</span> isSet<span class='opr'>(</span>Socket s<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> isSet<span class='opr'>(</span>s.sock<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************

                max sockets that can be added, like FD_SETSIZE

        ***********************************************************************/</span>

        <span class='kw4'>uint</span> max<span class='opr'>(</span><span class='opr'>)</span> 
        <span class='opr'>{</span>
                <span class='kw1'>return</span> nbytes / socket_t.sizeof;
        <span class='opr'>}</span>
        
        
        <span class='com'>/***********************************************************************


        ***********************************************************************/</span>

        fd_set<span class='opr'>*</span> toFd_set<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span>fd_set<span class='opr'>*</span><span class='opr'>)</span>buf;
        <span class='opr'>}</span>
<span class='opr'>}</span>




<span class='com'>/******************************************************************************/</span>
<span class='com'>/******************* additions for the tango.io package  **********************/</span>           
<span class='com'>/******************************************************************************/</span>


<span class='com'>/******************************************************************************

******************************************************************************/</span>

<span class='kw2'>interface</span> IListener
<span class='opr'>{</span>
        <span class='com'>/***********************************************************************

                Stop listening; this may be delayed until after the next
                valid read operation.

        ***********************************************************************/</span>

        <span class='kw4'>void</span> cancel <span class='opr'>(</span><span class='opr'>)</span>;
<span class='opr'>}</span>


<span class='com'>/******************************************************************************

******************************************************************************/</span>

<span class='kw2'>interface</span> ISocketReader
<span class='opr'>{</span>
        <span class='com'>/***********************************************************************

                Polymorphic contract for readers handed to a listener. 
                Should return the number of bytes read, or -1 on error.

        ***********************************************************************/</span>

        <span class='kw4'>uint</span> read <span class='opr'>(</span>IBuffer buffer<span class='opr'>)</span>;

        <span class='com'>/***********************************************************************

                Is this socket still alive?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> isAlive<span class='opr'>(</span><span class='opr'>)</span>;
<span class='opr'>}</span>



</pre></td></tr></table>	</body>
</html>
