<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="style.css" type="text/css" />
		<title>io/Stdout.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span>
<span>72</span>
<span>73</span>
<span>74</span>
<span>75</span>
<span>76</span>
<span>77</span>
<span>78</span>
<span>79</span>
<span>80</span>
<span>81</span>
<span>82</span>
<span>83</span>
<span>84</span>
<span>85</span>
<span>86</span>
<span>87</span>
<span>88</span>
<span>89</span>
<span>90</span>
<span>91</span>
<span>92</span>
<span>93</span>
<span>94</span>
<span>95</span>
<span>96</span>
<span>97</span>
<span>98</span>
<span>99</span>
<span>100</span>
<span>101</span>
<span>102</span>
<span>103</span>
<span>104</span>
<span>105</span>
<span>106</span>
<span>107</span>
<span>108</span>
<span>109</span>
<span>110</span>
<span>111</span>
<span>112</span>
<span>113</span>
<span>114</span>
<span>115</span>
<span>116</span>
<span>117</span>
<span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
</pre></td><td id='code'><pre><span class='com'>/*******************************************************************************

        copyright:      Copyright (c) 2004 Kris Bell. All rights reserved

        license:        BSD style: $(LICENSE)
        
        version:        Initial release: Nov 2005
        
        author:         Kris

*******************************************************************************/</span>

<span class='kw2'>module</span> tango.io.Stdout;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.Console;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.convert.Format,
                tango.convert.Double;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.model.IBuffer,
                tango.io.model.IConduit;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.support.BufferCodec;

<span class='com'>/*******************************************************************************

        A bridge between a Format instance and a Buffer. This is used for
        the Stdout &amp; Stderr globals, but can be used for general-purpose
        buffer-formatting as desired. The Template type 'T' dictates the 
        text arrangement within the target buffer ~ one of char, wchar or
        dchar (utf8, utf16, or utf32)

*******************************************************************************/</span>

<span class='kw4'>private</span> <span class='kw4'>class</span> BufferFormatT<span class='opr'>(</span>T<span class='opr'>)</span> : FormatClassT!<span class='opr'>(</span>T<span class='opr'>)</span>
<span class='opr'>{</span>
        <span class='kw4'>private</span> <span class='kw4'>bool</span>            flush;
        <span class='kw4'>private</span> IBuffer         target;
        <span class='kw4'>private</span> Importer        importer;

        <span class='com'>/**********************************************************************

                Construct a BufferFormat instance, tying the provided
                buffer to a formatter. Set option 'flush' to true if
                the result should be flushed when complete, and provide
                a 'tail' to append on the completed output (such as a 
                newline).

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>IBuffer target, <span class='kw4'>bool</span> flush <span class='opr'>=</span> <span class='kw2'>true</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>// configure the formatter</span>
                <span class='kw2'>super</span> <span class='opr'>(</span><span class='opr'>&amp;</span>write, <span class='opr'>&amp;</span>render, <span class='opr'>&amp;</span>Double.format<span class='opr'>)</span>;

                <span class='com'>// hook up a unicode converter</span>
                importer <span class='opr'>=</span> <span class='kw2'>new</span> UnicodeImporter!<span class='opr'>(</span>T<span class='opr'>)</span><span class='opr'>(</span>target<span class='opr'>)</span>;

                <span class='com'>// save buffer and tail references</span>
                <span class='kw2'>this</span>.target <span class='opr'>=</span> target;
                <span class='kw2'>this</span>.flush <span class='opr'>=</span> flush;
        <span class='opr'>}</span>
                
        <span class='com'>/**********************************************************************

                return the associated buffer

        **********************************************************************/</span>

        IBuffer buffer <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> target;
        <span class='opr'>}</span>      

        <span class='com'>/**********************************************************************

                return the associated conduit

        **********************************************************************/</span>

        IConduit conduit <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> target.getConduit<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>      

        <span class='com'>/**********************************************************************

                Callback from the Format instance to write an array

        **********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>uint</span> write <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> x, <span class='kw4'>uint</span> type<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> importer <span class='opr'>(</span>x, x.length, type<span class='opr'>)</span>;
        <span class='opr'>}</span>      

        <span class='com'>/**********************************************************************

                Callback from the Format instance to render the content

        **********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>void</span> render <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>flush<span class='opr'>)</span>
                    target.flush <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>      
<span class='opr'>}</span>

<span class='com'>// convenience alias</span>
<span class='kw2'>alias</span> BufferFormatT!<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>)</span> BufferFormat;


<span class='com'>/*******************************************************************************

        Standard, global formatters for console output. If you don't need
        formatted output or unicode translation, consider using the module
        io.Console directly

        Note that both the buffer and conduit in use are exposed by these
        global instances ~ this can be leveraged to, for example, copy a 
        file to the standard output:

        ---
        Stdout.conduit.copy (new FileConduit (&quot;myfile&quot;));
        ---

*******************************************************************************/</span>

<span class='kw4'>public</span> <span class='kw4'>static</span> BufferFormat Stdout, 
                           Stderr;

<span class='kw4'>static</span> <span class='kw2'>this</span><span class='opr'>(</span><span class='opr'>)</span>
<span class='opr'>{</span>
        Stdout <span class='opr'>=</span> <span class='kw2'>new</span> BufferFormat <span class='opr'>(</span>Cerr<span class='opr'>)</span>;
        Stderr <span class='opr'>=</span> <span class='kw2'>new</span> BufferFormat <span class='opr'>(</span>Cout<span class='opr'>)</span>;
<span class='opr'>}</span>

</pre></td></tr></table>	</body>
</html>
