<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="../../style.css" type="text/css" />
		<title>io/protocol/DisplayWriter.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
</pre></td><td id='code'><pre><span class='com'>/*******************************************************************************

        copyright:      Copyright (c) 2004 Kris Bell. All rights reserved

        license:        BSD style: $(LICENSE)

        version:        Initial release: March 2004      
        version:        Rewritten to support format tags; March 2005
       
        author:         Kris

*******************************************************************************/</span>

<span class='kw2'>module</span> tango.io.protocol.DisplayWriter;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.core.Vararg;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.convert.Type,
                tango.convert.Format,
                tango.convert.Double;

<span class='kw4'>public</span>  <span class='kw2'>import</span>  tango.io.protocol.Writer;

<span class='com'>/*******************************************************************************

        Format output suitable for presentation. DisplayWriter provide 
        the means to append formatted  data to an IBuffer, and exposes 
        a convenient method of handling a variety of data types. 
        
        DisplayWriter supports the usual printf() format specifiers &amp; flags, 
        and extends the notion to operate with one dimensional arrays. For
        instance, this code

        ---
        static int x = [1, 2, 3, 4, 5, 6, 7, 8];

        Stdout.print (&quot;%@04b, &quot;, x);
        ---

        results in the following output: 

        ---
        0001, 0010, 0011, 0100, 0101, 0110, 0111, 1000,
        ---

        Note that DisplayWriter itself is a wrapper around the tango.convert 
        package, which can be used directly as desired (Integer, Double, 
        DGDouble, etc). The latter classes are home to a set of static 
        formatting-methods, making them convenient for ad-hoc application.

        tango.convert also has Format and Sprint classes for working directly
        with text arrays.
         
*******************************************************************************/</span>

<span class='kw4'>class</span> DisplayWriter : Writer
<span class='opr'>{</span>
        <span class='kw2'>alias</span> FormatStructT!<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>)</span> Format;

        <span class='kw4'>private</span> Format          format;
        <span class='kw4'>private</span> <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>128</span><span class='opr'>]</span>       workspace;

        <span class='com'>/***********************************************************************
        
                Construct a DisplayWriter upon the specified IBuffer. 
                One can override the default floating-point formatting
                by providing an appropriate handler to this constructor.
                For example, one might configure the DGDouble.format()
                function instead.

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>IBuffer buffer, <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> workspace <span class='opr'>=</span> <span class='kw2'>null</span>, Format.DblFormat df <span class='opr'>=</span> <span class='opr'>&amp;</span>Double.format<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span>buffer<span class='opr'>)</span>;
                
                <span class='kw1'>if</span> <span class='opr'>(</span>workspace <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                    workspace <span class='opr'>=</span> <span class='kw2'>this</span>.workspace;

                <span class='com'>// configure output-handler, workspace, and the</span>
                <span class='com'>// floating-point converter</span>
                format.ctor <span class='opr'>(</span><span class='opr'>&amp;</span>emit, workspace, df<span class='opr'>)</span>;
        <span class='opr'>}</span>
     
        <span class='com'>/***********************************************************************
        
                Construct a DisplayWriter upon the specified IConduit

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>IConduit conduit<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span>conduit<span class='opr'>)</span>;

                <span class='com'>// configure formatter</span>
                format.ctor <span class='opr'>(</span><span class='opr'>&amp;</span>emit, workspace, <span class='opr'>&amp;</span>Double.format<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Format a set of arguments a la printf(). Please see module
                tango.convert.Format for details

        ***********************************************************************/</span>

        <span class='kw4'>int</span> print <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> s, <span class='kw3'>TypeInfo</span><span class='opr'>[</span><span class='opr'>]</span> ti, va_list args<span class='opr'>)</span>
        <span class='opr'>{</span>       
                <span class='kw1'>return</span> format <span class='opr'>(</span>s, ti, args<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Format a set of arguments a la printf(). Please see module
                tango.convert.Format for details

        ***********************************************************************/</span>

        DisplayWriter print <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> s, <span class='opr'>..</span>.<span class='opr'>)</span>
        <span class='opr'>{</span>       
                print <span class='opr'>(</span>s, _arguments, _argptr<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Format a set of arguments a la printf(). Please see module
                tango.convert.Format for details

        ***********************************************************************/</span>

        DisplayWriter println <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> s, <span class='opr'>..</span>.<span class='opr'>)</span>
        <span class='opr'>{</span>       
                print <span class='opr'>(</span>s, _arguments, _argptr<span class='opr'>)</span>;
                put <span class='opr'>(</span>CR<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Is this Writer text oriented?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> isTextBased<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>true</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Intercept discrete output and convert it to printable form

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>override</span> IWriter write <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> src, <span class='kw4'>uint</span> bytes, <span class='kw4'>int</span> type<span class='opr'>)</span>
        <span class='opr'>{</span>
                format.emit <span class='opr'>(</span>src, bytes, type<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                formatting handler

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>uint</span> emit <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> x, <span class='kw4'>uint</span> type<span class='opr'>)</span>
        <span class='opr'>{</span>
                encode <span class='opr'>(</span>x, x.length, type<span class='opr'>)</span>;
                <span class='kw1'>return</span> x.length;
        <span class='opr'>}</span>
<span class='opr'>}</span>
</pre></td></tr></table>	</body>
</html>
