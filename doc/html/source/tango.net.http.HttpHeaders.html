<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="../../style.css" type="text/css" />
		<title>net/http/HttpHeaders.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
</pre></td><td id='code'><pre><span class='com'>/*******************************************************************************

        copyright:      Copyright (c) 2004 Kris Bell. All rights reserved

        license:        BSD style: $(LICENSE)
        
        version:        Initial release: April 2004      
        
        author:         Kris

*******************************************************************************/</span>

<span class='kw2'>module</span> tango.net.http.HttpHeaders;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.text.LineIterator;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.model.IBuffer,
                tango.io.protocol.model.IWriter;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.net.http.HttpStack;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.net.http.HttpTokens;

<span class='com'>/*******************************************************************************

        Headers are distinct types in their own right. This is because they
        are somewhat optimized via a trailing ':' character.

*******************************************************************************/</span>

<span class='kw4'>struct</span> HttpHeaderName
<span class='opr'>{</span>
        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span>     value;  
<span class='opr'>}</span>

<span class='com'>/*******************************************************************************

        Define the traditional set of HTTP header names
        
*******************************************************************************/</span>

<span class='kw4'>struct</span> HttpHeader
<span class='opr'>{</span>   
        <span class='com'>// size of both the request &amp; response buffer (per thread)</span>
        <span class='kw4'>static</span> <span class='kw4'>const</span> <span class='kw4'>int</span> IOBufferSize                 <span class='opr'>=</span> <span class='nbr'>16</span> <span class='opr'>*</span> <span class='nbr'>1024</span>;

        <span class='com'>// maximum length for POST parameters (to avoid DOS ...)</span>
        <span class='kw4'>static</span> <span class='kw4'>const</span> <span class='kw4'>int</span> MaxPostParamSize             <span class='opr'>=</span> <span class='nbr'>4</span> <span class='opr'>*</span> <span class='nbr'>1024</span>;

        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Version           <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;HTTP/1.0&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName TextHtml          <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;text/html&quot;</span><span class='opr'>}</span>;

        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Accept            <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Accept:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName AcceptCharset     <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Accept-Charset:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName AcceptEncoding    <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Accept-Encoding:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName AcceptLanguage    <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Accept-Language:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName AcceptRanges      <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Accept-Ranges:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Age               <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Age:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Allow             <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Allow:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Authorization     <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Authorization:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName CacheControl      <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Cache-Control:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Connection        <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Connection:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ContentEncoding   <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Content-Encoding:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ContentLanguage   <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Content-Language:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ContentLength     <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Content-Length:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ContentLocation   <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Content-Location:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ContentRange      <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Content-Range:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ContentType       <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Content-Type:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Cookie            <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Cookie:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Date              <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Date:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ETag              <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;ETag:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Expect            <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Expect:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Expires           <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Expires:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName From              <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;From:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Host              <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Host:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Identity          <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;identity:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName IfMatch           <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;If-Match:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName IfModifiedSince   <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;If-Modified-Since:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName IfNoneMatch       <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;If-None-Match:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName IfRange           <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;If-Range:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName IfUnmodifiedSince <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;If-Unmodified-Since:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName LastModified      <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Last-Modified:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Location          <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Location:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName MaxForwards       <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Max-Forwards:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName MimeVersion       <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;MIME-Version:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Pragma            <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Pragma:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ProxyAuthenticate <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Proxy-Authenticate:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ProxyConnection   <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Proxy-Connection:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Range             <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Range:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Referrer          <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Referer:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName RetryAfter        <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Retry-After:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Server            <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Server:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName ServletEngine     <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Servlet-Engine:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName SetCookie         <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Set-Cookie:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName SetCookie2        <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Set-Cookie2:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName TE                <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;TE:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Trailer           <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Trailer:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName TransferEncoding  <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Transfer-Encoding:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Upgrade           <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Upgrade:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName UserAgent         <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;User-Agent:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Vary              <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Vary:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName Warning           <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;Warning:&quot;</span><span class='opr'>}</span>;
        <span class='kw4'>static</span> <span class='kw4'>const</span> HttpHeaderName WwwAuthenticate   <span class='opr'>=</span> <span class='opr'>{</span><span class='str'>&quot;WWW-Authenticate:&quot;</span><span class='opr'>}</span>;
<span class='opr'>}</span>


<span class='com'>/******************************************************************************

        Exposes freachable HttpHeader instances 

******************************************************************************/</span>

<span class='kw4'>struct</span> HeaderElement
<span class='opr'>{</span>
        HttpHeaderName  name;
        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span>          value;
<span class='opr'>}</span>

<span class='com'>/******************************************************************************

        Maintains a set of input headers. These are placed into an input
        buffer and indexed via a HttpStack. 

******************************************************************************/</span>

<span class='kw4'>class</span> HttpHeaders : HttpTokens
<span class='opr'>{</span>
        <span class='com'>// tell compiler to used super.parse() also</span>
        <span class='kw2'>alias</span> HttpTokens.parse parse;

        <span class='kw4'>private</span> LineIterator line;

        <span class='com'>/**********************************************************************
                
                Construct this set of headers, using a HttpStack based
                upon a ':' delimeter   
              
        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='com'>// separator is a ':', and specify we want it included as</span>
                <span class='com'>// part of the name whilst iterating</span>
                <span class='kw2'>super</span> <span class='opr'>(</span><span class='str'>':'</span>, <span class='kw2'>true</span><span class='opr'>)</span>;

                <span class='com'>// construct a line tokenizer for later usage</span>
                line <span class='opr'>=</span> <span class='kw2'>new</span> LineIterator;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Clone a source set of HttpHeaders

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>HttpHeaders source<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span>source<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Clone this set of HttpHeaders

        **********************************************************************/</span>

        HttpHeaders clone <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>new</span> HttpHeaders <span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Read all header lines. Everything is mapped rather 
                than being allocated &amp; copied

        **********************************************************************/</span>

        <span class='kw4'>void</span> parse <span class='opr'>(</span>IBuffer input<span class='opr'>)</span>
        <span class='opr'>{</span>
                setParsed <span class='opr'>(</span><span class='kw2'>true</span><span class='opr'>)</span>;
                line.set <span class='opr'>(</span>input<span class='opr'>)</span>;

                <span class='kw1'>while</span> <span class='opr'>(</span>line.next &amp;&amp; line.get.length<span class='opr'>)</span>
                       stack.push <span class='opr'>(</span>line.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Return the value of the provided header, or null if the
                header does not exist

        **********************************************************************/</span>

        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> get <span class='opr'>(</span>HttpHeaderName name, <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> def <span class='opr'>=</span> <span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>super</span>.get <span class='opr'>(</span>name.value, def<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Return the integer value of the provided header, or -1 
                if the header does not exist

        **********************************************************************/</span>

        <span class='kw4'>int</span> getInt <span class='opr'>(</span>HttpHeaderName name, <span class='kw4'>int</span> def <span class='opr'>=</span> <span class='opr'>-</span><span class='nbr'>1</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>super</span>.getInt <span class='opr'>(</span>name.value, def<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Return the date value of the provided header, or -1 
                if the header does not exist

        **********************************************************************/</span>

        <span class='kw4'>ulong</span> getDate <span class='opr'>(</span>HttpHeaderName name, <span class='kw4'>ulong</span> def <span class='opr'>=</span> <span class='opr'>-</span><span class='nbr'>1</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>super</span>.getDate <span class='opr'>(</span>name.value, def<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

                Iterate over the set of headers. This is a shell around
                the superclass, where we can convert the HttpToken into 
                a HeaderElement instead.

        **********************************************************************/</span>

        <span class='kw4'>int</span> opApply <span class='opr'>(</span><span class='kw4'>int</span> <span class='kw2'>delegate</span><span class='opr'>(</span><span class='kw2'>inout</span> HeaderElement<span class='opr'>)</span> dg<span class='opr'>)</span>
        <span class='opr'>{</span>
                HeaderElement   element;
                <span class='kw4'>int</span>             result <span class='opr'>=</span> <span class='nbr'>0</span>;

                <span class='kw1'>foreach</span> <span class='opr'>(</span>HttpToken token; <span class='kw2'>super</span><span class='opr'>)</span>
                        <span class='opr'>{</span>
                        element.name.value <span class='opr'>=</span> token.name;
                        element.value <span class='opr'>=</span> token.value;
                        result <span class='opr'>=</span> dg <span class='opr'>(</span>element<span class='opr'>)</span>;
                        <span class='kw1'>if</span> <span class='opr'>(</span>result<span class='opr'>)</span>
                            <span class='kw1'>break</span>;
                        <span class='opr'>}</span>
                <span class='kw1'>return</span> result;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

                Create a filter for iterating of a set of named headers.
                We have to create a filter since we can't pass additional
                arguments directly to an opApply() method.

        **********************************************************************/</span>

        FilteredHeaders createFilter <span class='opr'>(</span>HttpHeaderName header<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>new</span> FilteredHeaders <span class='opr'>(</span><span class='kw2'>this</span>, header<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

                Filter class for isolating a set of named headers.

        **********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>static</span> <span class='kw4'>class</span> FilteredHeaders : FilteredTokens
        <span class='opr'>{</span>       
                <span class='com'>/**************************************************************

                        Construct a filter upon the specified headers, for
                        the given header name.

                **************************************************************/</span>

                <span class='kw2'>this</span> <span class='opr'>(</span>HttpHeaders headers, HttpHeaderName header<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw2'>super</span> <span class='opr'>(</span>headers, header.value<span class='opr'>)</span>;
                <span class='opr'>}</span>

                <span class='com'>/**************************************************************

                        Iterate over all headers matching the given name. 
                        This wraps the HttpToken iterator to convert the 
                        output into a HeaderElement instead.

                **************************************************************/</span>

                <span class='kw4'>int</span> opApply <span class='opr'>(</span><span class='kw4'>int</span> <span class='kw2'>delegate</span><span class='opr'>(</span><span class='kw2'>inout</span> HeaderElement<span class='opr'>)</span> dg<span class='opr'>)</span>
                <span class='opr'>{</span>
                        HeaderElement   element;
                        <span class='kw4'>int</span>             result <span class='opr'>=</span> <span class='nbr'>0</span>;
                        
                        <span class='kw1'>foreach</span> <span class='opr'>(</span>HttpToken token; <span class='kw2'>super</span><span class='opr'>)</span>
                                <span class='opr'>{</span>
                                element.name.value <span class='opr'>=</span> token.name;
                                element.value <span class='opr'>=</span> token.value;
                                result <span class='opr'>=</span> dg <span class='opr'>(</span>element<span class='opr'>)</span>;
                                <span class='kw1'>if</span> <span class='opr'>(</span>result<span class='opr'>)</span>
                                    <span class='kw1'>break</span>;
                                <span class='opr'>}</span>
                        <span class='kw1'>return</span> result;
                <span class='opr'>}</span>

        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/******************************************************************************

        Maintains a set of output headers. These are held in an output
        buffer, and indexed via a HttpStack. Deleting a header could be 
        supported by setting the HttpStack entry to null, and ignoring
        such values when it's time to write the headers.

******************************************************************************/</span>

<span class='kw4'>class</span> HttpMutableHeaders : HttpHeaders
<span class='opr'>{</span>
        <span class='com'>/**********************************************************************
                
                Construct output headers, using the provided buffer as
                a place to stash the header content.

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>IBuffer output<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw2'>super</span>.setOutputBuffer <span class='opr'>(</span>output<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Clone a source set of HttpMutableHeaders

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>HttpMutableHeaders source<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span>source<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Clone this set of HttpMutableHeaders

        **********************************************************************/</span>

        HttpMutableHeaders clone <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>new</span> HttpMutableHeaders <span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Add the specified header, and use a callback to provide
                the content.

        **********************************************************************/</span>

        <span class='kw4'>void</span> add <span class='opr'>(</span>HttpHeaderName name, <span class='kw4'>void</span> <span class='kw2'>delegate</span> <span class='opr'>(</span>IBuffer<span class='opr'>)</span> dg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.add <span class='opr'>(</span>name.value, dg<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Add the specified header and text 

        **********************************************************************/</span>

        <span class='kw4'>void</span> add <span class='opr'>(</span>HttpHeaderName name, <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> value<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.add <span class='opr'>(</span>name.value, value<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Add the specified header and integer value

        **********************************************************************/</span>

        <span class='kw4'>void</span> addInt <span class='opr'>(</span>HttpHeaderName name, <span class='kw4'>int</span> value<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.addInt <span class='opr'>(</span>name.value, value<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Add the specified header and long/date value

        **********************************************************************/</span>

        <span class='kw4'>void</span> addDate <span class='opr'>(</span>HttpHeaderName name, <span class='kw4'>ulong</span> value<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.addDate <span class='opr'>(</span>name.value, value<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Remove the specified header header. Returns false if not 
                found.

        **********************************************************************/</span>

        <span class='kw4'>bool</span> remove <span class='opr'>(</span>HttpHeaderName name<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>super</span>.remove <span class='opr'>(</span>name.value<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Return the output buffer provided during construction.

        **********************************************************************/</span>

        IBuffer getOutputBuffer <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>super</span>.getOutputBuffer <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>
</pre></td></tr></table>	</body>
</html>
