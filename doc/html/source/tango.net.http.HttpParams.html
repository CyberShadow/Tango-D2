<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="../../style.css" type="text/css" />
		<title>net/http/HttpParams.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
</pre></td><td id='code'><pre><span class='com'>/*******************************************************************************

        copyright:      Copyright (c) 2004 Kris Bell. All rights reserved

        license:        BSD style: $(LICENSE)
        
        version:        Initial release: April 2004      
        
        author:         Kris

*******************************************************************************/</span>

<span class='kw2'>module</span> tango.net.http.HttpParams;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.model.IBuffer;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.text.SimpleIterator;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.net.http.HttpTokens;

<span class='com'>/******************************************************************************

        Maintains a set of query parameters, parsed from an HTTP request.
        Use HttpMutableParams instead for output parameters.

        Note that these input params may have been encoded by the user-
        agent. Unfortunately there has been little consensus on what that
        encoding should be (especially regarding GET query-params). With
        luck, that will change to a consistent usage of UTF-8 within the 
        near future.

******************************************************************************/</span>

<span class='kw4'>class</span> HttpParams : HttpTokens
<span class='opr'>{</span>
        <span class='com'>// tell compiler to used super.parse() also</span>
        <span class='kw2'>alias</span> HttpTokens.parse parse;

        <span class='kw4'>private</span> SimpleIterator amp;

        <span class='com'>/**********************************************************************
                
                Construct parameters by telling the HttpStack that
                name/value pairs are seperated by a '=' character.

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span><span class='str'>'='</span><span class='opr'>)</span>;

                <span class='com'>// construct a line tokenizer for later usage</span>
                amp <span class='opr'>=</span> <span class='kw2'>new</span> SimpleIterator <span class='opr'>(</span><span class='str'>&quot;&amp;&quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Clone a source set of HttpParams

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>HttpParams source<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span>source<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Clone this set of HttpParams

        **********************************************************************/</span>

        HttpParams clone <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>new</span> HttpParams <span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Read all query parameters. Everything is mapped rather 
                than being allocated &amp; copied

        **********************************************************************/</span>

        <span class='kw4'>void</span> parse <span class='opr'>(</span>IBuffer input<span class='opr'>)</span>
        <span class='opr'>{</span>
                setParsed <span class='opr'>(</span><span class='kw2'>true</span><span class='opr'>)</span>;
                amp.set <span class='opr'>(</span>input<span class='opr'>)</span>;

                <span class='kw1'>while</span> <span class='opr'>(</span>amp.next || amp.get.length<span class='opr'>)</span>
                       stack.push <span class='opr'>(</span>amp.get<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/******************************************************************************

        HttpMutableParams are used for output purposes. This can be used
        to add a set of queries and then combine then into a text string
        using method write().

******************************************************************************/</span>

<span class='kw4'>class</span> HttpMutableParams : HttpParams
<span class='opr'>{</span>      
        <span class='com'>/**********************************************************************
                
                Construct output params upon the provided IBuffer

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>IBuffer output<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span><span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw2'>super</span>.setOutputBuffer <span class='opr'>(</span>output<span class='opr'>)</span>;
        <span class='opr'>}</span>
        
        <span class='com'>/**********************************************************************
                
                Clone a source set of HttpMutableParams

        **********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>HttpMutableParams source<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span> <span class='opr'>(</span>source<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Clone this set of HttpMutableParams

        **********************************************************************/</span>

        HttpMutableParams clone <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>new</span> HttpMutableParams <span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Add a name/value pair to the query list

        **********************************************************************/</span>

        <span class='kw4'>void</span> add <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> name, <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> value<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.add <span class='opr'>(</span>name, value<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************
                
                Add a name/integer pair to the query list 

        **********************************************************************/</span>

        <span class='kw4'>void</span> addInt <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> name, <span class='kw4'>int</span> value<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.addInt <span class='opr'>(</span>name, value<span class='opr'>)</span>;
        <span class='opr'>}</span>


        <span class='com'>/**********************************************************************
                
                Add a name/date(long) pair to the query list

        **********************************************************************/</span>

        <span class='kw4'>void</span> addDate <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> name, <span class='kw4'>ulong</span> value<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.addDate <span class='opr'>(</span>name, value<span class='opr'>)</span>;
        <span class='opr'>}</span>
<span class='opr'>}</span>
</pre></td></tr></table>	</body>
</html>
