<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="style.css" type="text/css" />
		<title>/String.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span>
<span>72</span>
<span>73</span>
<span>74</span>
<span>75</span>
<span>76</span>
<span>77</span>
<span>78</span>
<span>79</span>
<span>80</span>
<span>81</span>
<span>82</span>
<span>83</span>
<span>84</span>
<span>85</span>
<span>86</span>
<span>87</span>
<span>88</span>
<span>89</span>
<span>90</span>
<span>91</span>
<span>92</span>
<span>93</span>
<span>94</span>
<span>95</span>
<span>96</span>
<span>97</span>
<span>98</span>
<span>99</span>
<span>100</span>
<span>101</span>
<span>102</span>
<span>103</span>
<span>104</span>
<span>105</span>
<span>106</span>
<span>107</span>
<span>108</span>
<span>109</span>
<span>110</span>
<span>111</span>
<span>112</span>
<span>113</span>
<span>114</span>
<span>115</span>
<span>116</span>
<span>117</span>
<span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
<span>139</span>
<span>140</span>
<span>141</span>
<span>142</span>
<span>143</span>
<span>144</span>
<span>145</span>
<span>146</span>
<span>147</span>
<span>148</span>
<span>149</span>
<span>150</span>
<span>151</span>
<span>152</span>
<span>153</span>
<span>154</span>
<span>155</span>
<span>156</span>
<span>157</span>
<span>158</span>
<span>159</span>
<span>160</span>
<span>161</span>
<span>162</span>
<span>163</span>
<span>164</span>
<span>165</span>
<span>166</span>
<span>167</span>
<span>168</span>
<span>169</span>
<span>170</span>
<span>171</span>
<span>172</span>
<span>173</span>
<span>174</span>
<span>175</span>
<span>176</span>
<span>177</span>
<span>178</span>
<span>179</span>
<span>180</span>
<span>181</span>
<span>182</span>
<span>183</span>
<span>184</span>
<span>185</span>
<span>186</span>
<span>187</span>
<span>188</span>
<span>189</span>
<span>190</span>
<span>191</span>
<span>192</span>
<span>193</span>
<span>194</span>
<span>195</span>
<span>196</span>
<span>197</span>
<span>198</span>
<span>199</span>
<span>200</span>
<span>201</span>
<span>202</span>
<span>203</span>
<span>204</span>
<span>205</span>
<span>206</span>
<span>207</span>
<span>208</span>
<span>209</span>
<span>210</span>
<span>211</span>
<span>212</span>
<span>213</span>
<span>214</span>
<span>215</span>
<span>216</span>
<span>217</span>
<span>218</span>
<span>219</span>
<span>220</span>
<span>221</span>
<span>222</span>
<span>223</span>
<span>224</span>
<span>225</span>
<span>226</span>
<span>227</span>
<span>228</span>
<span>229</span>
<span>230</span>
<span>231</span>
<span>232</span>
<span>233</span>
<span>234</span>
<span>235</span>
<span>236</span>
<span>237</span>
<span>238</span>
<span>239</span>
<span>240</span>
<span>241</span>
<span>242</span>
<span>243</span>
<span>244</span>
<span>245</span>
<span>246</span>
<span>247</span>
<span>248</span>
<span>249</span>
<span>250</span>
<span>251</span>
<span>252</span>
<span>253</span>
<span>254</span>
<span>255</span>
<span>256</span>
<span>257</span>
<span>258</span>
<span>259</span>
<span>260</span>
<span>261</span>
<span>262</span>
<span>263</span>
<span>264</span>
<span>265</span>
<span>266</span>
<span>267</span>
<span>268</span>
<span>269</span>
<span>270</span>
<span>271</span>
<span>272</span>
<span>273</span>
<span>274</span>
<span>275</span>
<span>276</span>
<span>277</span>
<span>278</span>
<span>279</span>
<span>280</span>
<span>281</span>
<span>282</span>
<span>283</span>
<span>284</span>
<span>285</span>
<span>286</span>
<span>287</span>
<span>288</span>
<span>289</span>
<span>290</span>
<span>291</span>
<span>292</span>
<span>293</span>
<span>294</span>
<span>295</span>
<span>296</span>
<span>297</span>
<span>298</span>
<span>299</span>
<span>300</span>
<span>301</span>
<span>302</span>
<span>303</span>
<span>304</span>
<span>305</span>
<span>306</span>
<span>307</span>
<span>308</span>
<span>309</span>
<span>310</span>
<span>311</span>
<span>312</span>
<span>313</span>
<span>314</span>
<span>315</span>
<span>316</span>
<span>317</span>
<span>318</span>
<span>319</span>
<span>320</span>
<span>321</span>
<span>322</span>
<span>323</span>
<span>324</span>
<span>325</span>
<span>326</span>
<span>327</span>
<span>328</span>
<span>329</span>
<span>330</span>
<span>331</span>
<span>332</span>
<span>333</span>
<span>334</span>
<span>335</span>
<span>336</span>
<span>337</span>
<span>338</span>
<span>339</span>
<span>340</span>
<span>341</span>
<span>342</span>
<span>343</span>
<span>344</span>
<span>345</span>
<span>346</span>
<span>347</span>
<span>348</span>
<span>349</span>
<span>350</span>
<span>351</span>
<span>352</span>
<span>353</span>
<span>354</span>
<span>355</span>
<span>356</span>
<span>357</span>
<span>358</span>
<span>359</span>
<span>360</span>
<span>361</span>
<span>362</span>
<span>363</span>
<span>364</span>
<span>365</span>
<span>366</span>
<span>367</span>
<span>368</span>
<span>369</span>
<span>370</span>
<span>371</span>
<span>372</span>
<span>373</span>
<span>374</span>
<span>375</span>
<span>376</span>
<span>377</span>
<span>378</span>
<span>379</span>
<span>380</span>
<span>381</span>
<span>382</span>
<span>383</span>
<span>384</span>
<span>385</span>
<span>386</span>
<span>387</span>
<span>388</span>
<span>389</span>
<span>390</span>
<span>391</span>
<span>392</span>
<span>393</span>
<span>394</span>
<span>395</span>
<span>396</span>
<span>397</span>
<span>398</span>
<span>399</span>
<span>400</span>
<span>401</span>
<span>402</span>
<span>403</span>
<span>404</span>
<span>405</span>
<span>406</span>
<span>407</span>
<span>408</span>
<span>409</span>
<span>410</span>
<span>411</span>
<span>412</span>
<span>413</span>
<span>414</span>
<span>415</span>
<span>416</span>
<span>417</span>
<span>418</span>
<span>419</span>
<span>420</span>
<span>421</span>
<span>422</span>
<span>423</span>
<span>424</span>
<span>425</span>
<span>426</span>
<span>427</span>
<span>428</span>
<span>429</span>
<span>430</span>
<span>431</span>
<span>432</span>
<span>433</span>
<span>434</span>
<span>435</span>
<span>436</span>
<span>437</span>
<span>438</span>
<span>439</span>
<span>440</span>
<span>441</span>
<span>442</span>
<span>443</span>
<span>444</span>
<span>445</span>
<span>446</span>
<span>447</span>
<span>448</span>
<span>449</span>
<span>450</span>
<span>451</span>
<span>452</span>
<span>453</span>
<span>454</span>
<span>455</span>
<span>456</span>
<span>457</span>
<span>458</span>
<span>459</span>
<span>460</span>
<span>461</span>
<span>462</span>
<span>463</span>
<span>464</span>
<span>465</span>
<span>466</span>
<span>467</span>
<span>468</span>
<span>469</span>
<span>470</span>
<span>471</span>
<span>472</span>
<span>473</span>
<span>474</span>
<span>475</span>
<span>476</span>
<span>477</span>
<span>478</span>
<span>479</span>
<span>480</span>
<span>481</span>
<span>482</span>
<span>483</span>
<span>484</span>
<span>485</span>
<span>486</span>
<span>487</span>
<span>488</span>
<span>489</span>
<span>490</span>
<span>491</span>
<span>492</span>
<span>493</span>
<span>494</span>
<span>495</span>
<span>496</span>
<span>497</span>
<span>498</span>
<span>499</span>
<span>500</span>
<span>501</span>
<span>502</span>
<span>503</span>
<span>504</span>
<span>505</span>
<span>506</span>
<span>507</span>
<span>508</span>
<span>509</span>
<span>510</span>
<span>511</span>
<span>512</span>
<span>513</span>
<span>514</span>
<span>515</span>
<span>516</span>
<span>517</span>
<span>518</span>
<span>519</span>
<span>520</span>
<span>521</span>
<span>522</span>
<span>523</span>
<span>524</span>
<span>525</span>
<span>526</span>
<span>527</span>
<span>528</span>
<span>529</span>
<span>530</span>
<span>531</span>
<span>532</span>
<span>533</span>
<span>534</span>
<span>535</span>
<span>536</span>
<span>537</span>
<span>538</span>
<span>539</span>
<span>540</span>
<span>541</span>
<span>542</span>
<span>543</span>
<span>544</span>
<span>545</span>
<span>546</span>
<span>547</span>
<span>548</span>
<span>549</span>
<span>550</span>
<span>551</span>
<span>552</span>
<span>553</span>
<span>554</span>
<span>555</span>
<span>556</span>
<span>557</span>
<span>558</span>
<span>559</span>
<span>560</span>
<span>561</span>
<span>562</span>
<span>563</span>
<span>564</span>
<span>565</span>
<span>566</span>
<span>567</span>
<span>568</span>
<span>569</span>
<span>570</span>
<span>571</span>
<span>572</span>
<span>573</span>
<span>574</span>
<span>575</span>
<span>576</span>
<span>577</span>
<span>578</span>
<span>579</span>
<span>580</span>
<span>581</span>
<span>582</span>
<span>583</span>
<span>584</span>
<span>585</span>
<span>586</span>
<span>587</span>
<span>588</span>
<span>589</span>
<span>590</span>
<span>591</span>
<span>592</span>
<span>593</span>
<span>594</span>
<span>595</span>
<span>596</span>
<span>597</span>
<span>598</span>
<span>599</span>
<span>600</span>
<span>601</span>
<span>602</span>
<span>603</span>
<span>604</span>
<span>605</span>
<span>606</span>
<span>607</span>
<span>608</span>
<span>609</span>
<span>610</span>
<span>611</span>
<span>612</span>
<span>613</span>
<span>614</span>
<span>615</span>
<span>616</span>
<span>617</span>
<span>618</span>
<span>619</span>
<span>620</span>
<span>621</span>
<span>622</span>
<span>623</span>
<span>624</span>
<span>625</span>
<span>626</span>
<span>627</span>
<span>628</span>
<span>629</span>
<span>630</span>
<span>631</span>
<span>632</span>
<span>633</span>
<span>634</span>
<span>635</span>
<span>636</span>
<span>637</span>
<span>638</span>
<span>639</span>
<span>640</span>
<span>641</span>
<span>642</span>
<span>643</span>
<span>644</span>
<span>645</span>
<span>646</span>
<span>647</span>
<span>648</span>
<span>649</span>
<span>650</span>
<span>651</span>
<span>652</span>
<span>653</span>
<span>654</span>
<span>655</span>
<span>656</span>
<span>657</span>
<span>658</span>
<span>659</span>
<span>660</span>
<span>661</span>
<span>662</span>
<span>663</span>
<span>664</span>
<span>665</span>
<span>666</span>
<span>667</span>
<span>668</span>
<span>669</span>
<span>670</span>
<span>671</span>
<span>672</span>
<span>673</span>
<span>674</span>
<span>675</span>
<span>676</span>
<span>677</span>
<span>678</span>
<span>679</span>
<span>680</span>
<span>681</span>
<span>682</span>
<span>683</span>
<span>684</span>
<span>685</span>
<span>686</span>
<span>687</span>
<span>688</span>
<span>689</span>
<span>690</span>
<span>691</span>
<span>692</span>
<span>693</span>
<span>694</span>
<span>695</span>
<span>696</span>
<span>697</span>
<span>698</span>
<span>699</span>
<span>700</span>
<span>701</span>
<span>702</span>
<span>703</span>
<span>704</span>
<span>705</span>
<span>706</span>
<span>707</span>
<span>708</span>
<span>709</span>
<span>710</span>
<span>711</span>
<span>712</span>
<span>713</span>
<span>714</span>
<span>715</span>
<span>716</span>
<span>717</span>
<span>718</span>
<span>719</span>
<span>720</span>
<span>721</span>
<span>722</span>
<span>723</span>
<span>724</span>
<span>725</span>
<span>726</span>
<span>727</span>
<span>728</span>
<span>729</span>
<span>730</span>
<span>731</span>
<span>732</span>
<span>733</span>
<span>734</span>
<span>735</span>
<span>736</span>
<span>737</span>
<span>738</span>
<span>739</span>
<span>740</span>
<span>741</span>
<span>742</span>
<span>743</span>
<span>744</span>
<span>745</span>
<span>746</span>
<span>747</span>
<span>748</span>
<span>749</span>
<span>750</span>
<span>751</span>
<span>752</span>
<span>753</span>
<span>754</span>
<span>755</span>
<span>756</span>
<span>757</span>
<span>758</span>
<span>759</span>
<span>760</span>
<span>761</span>
<span>762</span>
<span>763</span>
<span>764</span>
<span>765</span>
<span>766</span>
<span>767</span>
<span>768</span>
<span>769</span>
<span>770</span>
<span>771</span>
<span>772</span>
<span>773</span>
<span>774</span>
<span>775</span>
<span>776</span>
<span>777</span>
<span>778</span>
<span>779</span>
<span>780</span>
<span>781</span>
<span>782</span>
<span>783</span>
<span>784</span>
<span>785</span>
<span>786</span>
<span>787</span>
<span>788</span>
<span>789</span>
<span>790</span>
<span>791</span>
<span>792</span>
<span>793</span>
<span>794</span>
<span>795</span>
<span>796</span>
<span>797</span>
<span>798</span>
<span>799</span>
<span>800</span>
<span>801</span>
<span>802</span>
<span>803</span>
<span>804</span>
<span>805</span>
<span>806</span>
<span>807</span>
<span>808</span>
<span>809</span>
<span>810</span>
<span>811</span>
<span>812</span>
<span>813</span>
<span>814</span>
<span>815</span>
<span>816</span>
<span>817</span>
<span>818</span>
<span>819</span>
<span>820</span>
<span>821</span>
<span>822</span>
<span>823</span>
<span>824</span>
<span>825</span>
<span>826</span>
<span>827</span>
<span>828</span>
<span>829</span>
<span>830</span>
<span>831</span>
<span>832</span>
<span>833</span>
<span>834</span>
<span>835</span>
<span>836</span>
<span>837</span>
<span>838</span>
<span>839</span>
<span>840</span>
<span>841</span>
<span>842</span>
<span>843</span>
<span>844</span>
<span>845</span>
<span>846</span>
<span>847</span>
<span>848</span>
<span>849</span>
<span>850</span>
<span>851</span>
<span>852</span>
<span>853</span>
<span>854</span>
<span>855</span>
<span>856</span>
<span>857</span>
<span>858</span>
<span>859</span>
<span>860</span>
<span>861</span>
<span>862</span>
<span>863</span>
<span>864</span>
<span>865</span>
<span>866</span>
<span>867</span>
<span>868</span>
<span>869</span>
<span>870</span>
<span>871</span>
<span>872</span>
<span>873</span>
<span>874</span>
<span>875</span>
<span>876</span>
<span>877</span>
<span>878</span>
<span>879</span>
<span>880</span>
<span>881</span>
<span>882</span>
<span>883</span>
<span>884</span>
<span>885</span>
<span>886</span>
<span>887</span>
<span>888</span>
<span>889</span>
<span>890</span>
<span>891</span>
<span>892</span>
<span>893</span>
<span>894</span>
<span>895</span>
<span>896</span>
<span>897</span>
<span>898</span>
<span>899</span>
<span>900</span>
<span>901</span>
<span>902</span>
<span>903</span>
<span>904</span>
<span>905</span>
<span>906</span>
<span>907</span>
<span>908</span>
<span>909</span>
<span>910</span>
<span>911</span>
<span>912</span>
<span>913</span>
<span>914</span>
<span>915</span>
<span>916</span>
<span>917</span>
<span>918</span>
<span>919</span>
<span>920</span>
<span>921</span>
<span>922</span>
<span>923</span>
<span>924</span>
<span>925</span>
<span>926</span>
<span>927</span>
<span>928</span>
<span>929</span>
<span>930</span>
<span>931</span>
<span>932</span>
<span>933</span>
<span>934</span>
<span>935</span>
<span>936</span>
<span>937</span>
<span>938</span>
<span>939</span>
<span>940</span>
<span>941</span>
<span>942</span>
<span>943</span>
<span>944</span>
<span>945</span>
<span>946</span>
<span>947</span>
<span>948</span>
<span>949</span>
<span>950</span>
<span>951</span>
<span>952</span>
<span>953</span>
<span>954</span>
<span>955</span>
<span>956</span>
<span>957</span>
<span>958</span>
<span>959</span>
<span>960</span>
<span>961</span>
<span>962</span>
<span>963</span>
<span>964</span>
<span>965</span>
<span>966</span>
<span>967</span>
<span>968</span>
<span>969</span>
<span>970</span>
<span>971</span>
<span>972</span>
<span>973</span>
<span>974</span>
<span>975</span>
<span>976</span>
<span>977</span>
<span>978</span>
<span>979</span>
<span>980</span>
<span>981</span>
<span>982</span>
<span>983</span>
<span>984</span>
<span>985</span>
<span>986</span>
<span>987</span>
<span>988</span>
<span>989</span>
<span>990</span>
<span>991</span>
<span>992</span>
<span>993</span>
<span>994</span>
<span>995</span>
<span>996</span>
<span>997</span>
<span>998</span>
<span>999</span>
<span>1000</span>
<span>1001</span>
<span>1002</span>
<span>1003</span>
<span>1004</span>
<span>1005</span>
<span>1006</span>
<span>1007</span>
<span>1008</span>
<span>1009</span>
<span>1010</span>
<span>1011</span>
<span>1012</span>
<span>1013</span>
<span>1014</span>
<span>1015</span>
<span>1016</span>
<span>1017</span>
<span>1018</span>
<span>1019</span>
<span>1020</span>
<span>1021</span>
<span>1022</span>
<span>1023</span>
<span>1024</span>
<span>1025</span>
<span>1026</span>
<span>1027</span>
<span>1028</span>
<span>1029</span>
<span>1030</span>
<span>1031</span>
<span>1032</span>
<span>1033</span>
<span>1034</span>
<span>1035</span>
<span>1036</span>
<span>1037</span>
<span>1038</span>
<span>1039</span>
<span>1040</span>
<span>1041</span>
<span>1042</span>
<span>1043</span>
<span>1044</span>
<span>1045</span>
<span>1046</span>
<span>1047</span>
<span>1048</span>
<span>1049</span>
<span>1050</span>
<span>1051</span>
<span>1052</span>
<span>1053</span>
<span>1054</span>
<span>1055</span>
<span>1056</span>
<span>1057</span>
<span>1058</span>
<span>1059</span>
<span>1060</span>
<span>1061</span>
<span>1062</span>
<span>1063</span>
<span>1064</span>
<span>1065</span>
<span>1066</span>
<span>1067</span>
<span>1068</span>
<span>1069</span>
<span>1070</span>
<span>1071</span>
<span>1072</span>
<span>1073</span>
<span>1074</span>
<span>1075</span>
<span>1076</span>
<span>1077</span>
<span>1078</span>
<span>1079</span>
<span>1080</span>
<span>1081</span>
<span>1082</span>
<span>1083</span>
<span>1084</span>
<span>1085</span>
<span>1086</span>
<span>1087</span>
<span>1088</span>
<span>1089</span>
<span>1090</span>
<span>1091</span>
<span>1092</span>
<span>1093</span>
<span>1094</span>
<span>1095</span>
<span>1096</span>
<span>1097</span>
<span>1098</span>
<span>1099</span>
<span>1100</span>
<span>1101</span>
<span>1102</span>
<span>1103</span>
<span>1104</span>
<span>1105</span>
<span>1106</span>
<span>1107</span>
<span>1108</span>
<span>1109</span>
<span>1110</span>
<span>1111</span>
<span>1112</span>
<span>1113</span>
<span>1114</span>
<span>1115</span>
<span>1116</span>
<span>1117</span>
<span>1118</span>
<span>1119</span>
<span>1120</span>
<span>1121</span>
<span>1122</span>
<span>1123</span>
<span>1124</span>
<span>1125</span>
<span>1126</span>
<span>1127</span>
<span>1128</span>
<span>1129</span>
<span>1130</span>
<span>1131</span>
<span>1132</span>
<span>1133</span>
<span>1134</span>
<span>1135</span>
<span>1136</span>
<span>1137</span>
<span>1138</span>
<span>1139</span>
<span>1140</span>
<span>1141</span>
<span>1142</span>
<span>1143</span>
<span>1144</span>
<span>1145</span>
<span>1146</span>
<span>1147</span>
<span>1148</span>
<span>1149</span>
<span>1150</span>
<span>1151</span>
<span>1152</span>
<span>1153</span>
<span>1154</span>
<span>1155</span>
<span>1156</span>
<span>1157</span>
<span>1158</span>
<span>1159</span>
<span>1160</span>
<span>1161</span>
<span>1162</span>
<span>1163</span>
<span>1164</span>
<span>1165</span>
<span>1166</span>
<span>1167</span>
<span>1168</span>
<span>1169</span>
<span>1170</span>
<span>1171</span>
<span>1172</span>
<span>1173</span>
<span>1174</span>
<span>1175</span>
<span>1176</span>
<span>1177</span>
<span>1178</span>
<span>1179</span>
<span>1180</span>
<span>1181</span>
<span>1182</span>
<span>1183</span>
<span>1184</span>
<span>1185</span>
<span>1186</span>
<span>1187</span>
<span>1188</span>
<span>1189</span>
<span>1190</span>
<span>1191</span>
<span>1192</span>
<span>1193</span>
<span>1194</span>
<span>1195</span>
<span>1196</span>
<span>1197</span>
<span>1198</span>
<span>1199</span>
<span>1200</span>
<span>1201</span>
<span>1202</span>
<span>1203</span>
<span>1204</span>
<span>1205</span>
<span>1206</span>
<span>1207</span>
<span>1208</span>
<span>1209</span>
<span>1210</span>
<span>1211</span>
<span>1212</span>
<span>1213</span>
<span>1214</span>
<span>1215</span>
<span>1216</span>
<span>1217</span>
<span>1218</span>
<span>1219</span>
<span>1220</span>
<span>1221</span>
<span>1222</span>
<span>1223</span>
<span>1224</span>
<span>1225</span>
<span>1226</span>
<span>1227</span>
<span>1228</span>
<span>1229</span>
<span>1230</span>
<span>1231</span>
<span>1232</span>
<span>1233</span>
<span>1234</span>
<span>1235</span>
<span>1236</span>
<span>1237</span>
<span>1238</span>
<span>1239</span>
<span>1240</span>
<span>1241</span>
<span>1242</span>
<span>1243</span>
<span>1244</span>
<span>1245</span>
<span>1246</span>
<span>1247</span>
<span>1248</span>
<span>1249</span>
<span>1250</span>
<span>1251</span>
<span>1252</span>
<span>1253</span>
<span>1254</span>
<span>1255</span>
<span>1256</span>
<span>1257</span>
<span>1258</span>
<span>1259</span>
<span>1260</span>
<span>1261</span>
<span>1262</span>
<span>1263</span>
<span>1264</span>
<span>1265</span>
<span>1266</span>
<span>1267</span>
<span>1268</span>
<span>1269</span>
<span>1270</span>
<span>1271</span>
<span>1272</span>
<span>1273</span>
<span>1274</span>
<span>1275</span>
<span>1276</span>
<span>1277</span>
<span>1278</span>
<span>1279</span>
<span>1280</span>
<span>1281</span>
<span>1282</span>
<span>1283</span>
<span>1284</span>
<span>1285</span>
<span>1286</span>
<span>1287</span>
<span>1288</span>
<span>1289</span>
<span>1290</span>
<span>1291</span>
<span>1292</span>
<span>1293</span>
<span>1294</span>
<span>1295</span>
<span>1296</span>
<span>1297</span>
<span>1298</span>
<span>1299</span>
<span>1300</span>
<span>1301</span>
<span>1302</span>
<span>1303</span>
<span>1304</span>
<span>1305</span>
<span>1306</span>
<span>1307</span>
<span>1308</span>
<span>1309</span>
<span>1310</span>
<span>1311</span>
<span>1312</span>
<span>1313</span>
<span>1314</span>
<span>1315</span>
<span>1316</span>
<span>1317</span>
<span>1318</span>
<span>1319</span>
<span>1320</span>
<span>1321</span>
<span>1322</span>
<span>1323</span>
<span>1324</span>
<span>1325</span>
<span>1326</span>
<span>1327</span>
<span>1328</span>
<span>1329</span>
<span>1330</span>
<span>1331</span>
<span>1332</span>
<span>1333</span>
<span>1334</span>
<span>1335</span>
<span>1336</span>
<span>1337</span>
<span>1338</span>
<span>1339</span>
<span>1340</span>
</pre></td><td id='code'><pre><span class='com'>/*******************************************************************************

        copyright:      Copyright (c) 2004 Kris Bell. All rights reserved

        license:        BSD style: $(LICENSE)

        version:        Initial release: December 2005
              
        author:         Kris


        class MutableString(T) : String!(T)
        {
                // reset the content 
                MutableString set (T[] chars, bool mutable=true);
                MutableString set (String other, bool mutable=true);

                // get the index and length of the current selection
                uint selection (inout int length);

                // make a selection
                MutableString select (int start=0, int length=int.max);

                // move the selection around
                bool select (T c);
                bool select (T[] chars);
                bool select (String other);
                bool rselect (T c);
                bool rselect (T[] chars);
                bool rselect (String other);

                // append behind current selection
                MutableString append (String other);
                MutableString append (char[] other);
                MutableString append (wchar[] other);
                MutableString append (dchar[] other);
                MutableString append (T chr, int count=1);
                MutableString append (int value, T[] format=null);
                MutableString append (long value, T[] format=null);
                MutableString append (double value, T[] format=null);

                // format and layout behind current selection
                MutableString format (T[] format, ...);
                MutableString layout (T[] layout ...);
        
                // insert before current selection
                MutableString prepend (T[] other);
                MutableString prepend (String other);
                MutableString prepend (T chr, int count=1);

                // replace current selection
                MutableString replace (T chr);
                MutableString replace (T[] other);
                MutableString replace (String other);

                // remove current selection
                MutableString remove ();

                // truncate at point, or current selection
                MutableString truncate (int point = int.max);

                // trim content
                MutableString trim ();

                // return content
                T[] aliasOf ();
        }

        class String(T) : UniString
        {
                // iterate across content
                opApply (int delegate(inout T) dg);

                // hash content
                uint toHash ();

                // return length of content
                uint length ();

                // compare content
                bool equals  (T[] other);
                bool equals  (String other);
                bool ends    (T[] other);
                bool ends    (String other);
                bool starts  (T[] other);
                bool starts  (String other);
                int compare  (T[] other);
                int compare  (String other);
                int opEquals (Object other);
                int opCmp    (Object other);

                // copy content
                T[] copy (T[] dst);
                T[] copy ();
        }

        abstract class UniString
        {
                // convert content
                abstract char[]  utf8  (char[]  dst = null);
                abstract wchar[] utf16 (wchar[] dst = null);
                abstract dchar[] utf32 (dchar[] dst = null);
        }


*******************************************************************************/</span>

<span class='kw2'>module</span> tango.text.String;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.text.Text;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.convert.Type,
                tango.convert.Format,
                tango.convert.Unicode;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.protocol.model.IWriter;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.text.model.UniString;

<span class='com'>/*******************************************************************************

*******************************************************************************/</span>

<span class='kw4'>private</span> <span class='kw2'>extern</span> <span class='opr'>(</span>C<span class='opr'>)</span> <span class='kw4'>void</span> memmove <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> dst, <span class='kw4'>void</span><span class='opr'>*</span> src, <span class='kw4'>uint</span> bytes<span class='opr'>)</span>;


<span class='com'>/*******************************************************************************

        MutableString is a string class that stores Unicode characters.

        Indexes and lengths of strings always count code units, not code 
        points. This is similar to traditional multi-byte string handling. 
        Operations on strings do not test for code point boundaries since
        the approach taken here is based upon pattern-matching rather than
        direct indexing.

        MutableString maintains a current &quot;selection&quot;, controlled via the 
        select() and rselect() methods. Append(), prepend(), replace() and
        remove() each operate with respect to the selection. The select()
        methods themselves operate with respect to the current selection
        also, providing a means of iterating across matched patterns. To
        reset the selection to the entire string, use the select() method 
        with no arguments. 
       
*******************************************************************************/</span>

<span class='kw4'>class</span> MutableStringT<span class='opr'>(</span>T<span class='opr'>)</span> : StringT!<span class='opr'>(</span>T<span class='opr'>)</span>
<span class='opr'>{</span>
        <span class='kw4'>public</span>  <span class='kw2'>alias</span> append                    opCat;

        <span class='kw4'>private</span> <span class='kw2'>alias</span> FormatStructT!<span class='opr'>(</span>T<span class='opr'>)</span>         Format;
        <span class='kw4'>private</span>  <span class='kw2'>alias</span> Unicode.Into!<span class='opr'>(</span>T<span class='opr'>)</span>         Into;   

        <span class='kw4'>public</span>  Into                    into;           <span class='com'>// unicode converter</span>
        <span class='kw4'>private</span> T<span class='opr'>[</span><span class='opr'>]</span>                     scratch;        <span class='com'>// formatting scratchpad</span>
        <span class='kw4'>private</span> T<span class='opr'>[</span><span class='opr'>]</span>                     converts;       <span class='com'>// unicode buffer</span>
        <span class='kw4'>private</span> Format                  formatter;      <span class='com'>// printf formatter</span>


        <span class='com'>/***********************************************************************
        
                Create an empty MutableString with the specified available 
                space

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span><span class='kw4'>uint</span> space <span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                content.length <span class='opr'>=</span> space;
                mutable <span class='opr'>=</span> <span class='kw2'>true</span>;
                setup <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Create a MutableString upon the provided content. If said 
                content is immutable (read-only) then you might consider 
                setting the 'mutable' parameter to false. Doing so will 
                avoid allocating heap-space for the content until it is 
                modified.

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> content, <span class='kw4'>bool</span> mutable <span class='opr'>=</span> <span class='kw2'>true</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                set <span class='opr'>(</span>content, mutable<span class='opr'>)</span>;
                setup <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Create a MutableString via the content of a MutableString. 
                If said content is immutable (read-only) then you might 
                consider setting the 'mutable' parameter to false. Doing 
                so will avoid allocating heap-space for the content until 
                it is modified via MutableString methods.

        ***********************************************************************/</span>
        
        <span class='kw2'>this</span> <span class='opr'>(</span>MutableStringT other, <span class='kw4'>bool</span> mutable <span class='opr'>=</span> <span class='kw2'>true</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span> <span class='opr'>(</span>other.get, mutable<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Create a MutableString via the content of a String. Note 
                that the default is to assume the content is immutable
                
        ***********************************************************************/</span>
        
        <span class='kw2'>this</span> <span class='opr'>(</span>StringT!<span class='opr'>(</span>T<span class='opr'>)</span> other, <span class='kw4'>bool</span> mutable <span class='opr'>=</span> <span class='kw2'>false</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span> <span class='opr'>(</span>other.get, mutable<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
   
                Set the content to the provided array. Parameter 'mutable'
                specifies whether the given array is likely to change. If 
                not, the array is aliased until such time it is altered.
                     
        ***********************************************************************/</span>

        MutableStringT set <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> chars, <span class='kw4'>bool</span> mutable <span class='opr'>=</span> <span class='kw2'>true</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                contentLength <span class='opr'>=</span> chars.length;
                select <span class='opr'>(</span><span class='nbr'>0</span>, contentLength<span class='opr'>)</span>;

                <span class='kw1'>if</span> <span class='opr'>(</span><span class='opr'>(</span><span class='kw2'>this</span>.mutable <span class='opr'>=</span> mutable<span class='opr'>)</span> <span class='opr'>=</span><span class='opr'>=</span> <span class='kw2'>true</span><span class='opr'>)</span>
                     content <span class='opr'>=</span> chars.dup;
                <span class='kw1'>else</span>
                   content <span class='opr'>=</span> chars;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Replace the content of this MutableString. If the new content
                is immutable (read-only) then you might consider setting the
                'mutable' parameter to false. Doing so will avoid allocating
                heap-space for the content until it is modified via one of
                these methods.

        ***********************************************************************/</span>

        MutableStringT set <span class='opr'>(</span>StringT!<span class='opr'>(</span>T<span class='opr'>)</span> other, <span class='kw4'>bool</span> mutable <span class='opr'>=</span> <span class='kw2'>true</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> set <span class='opr'>(</span>other.get, mutable<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************

                Return the index and length of the current selection

        ***********************************************************************/</span>

        <span class='kw4'>uint</span> selection <span class='opr'>(</span><span class='kw2'>inout</span> <span class='kw4'>int</span> length<span class='opr'>)</span>
        <span class='opr'>{</span>
                length <span class='opr'>=</span> selectLength;
                <span class='kw1'>return</span> selectPoint;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************

                Explicitly set the current selection

        ***********************************************************************/</span>

        MutableStringT select <span class='opr'>(</span><span class='kw4'>int</span> start<span class='opr'>=</span><span class='nbr'>0</span>, <span class='kw4'>int</span> length<span class='opr'>=</span><span class='kw4'>int</span>.max<span class='opr'>)</span>
        <span class='opr'>{</span>
                pinIndices <span class='opr'>(</span>start, length<span class='opr'>)</span>;
                selectPoint <span class='opr'>=</span> start;
                selectLength <span class='opr'>=</span> length;                
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Find the first occurrence of a BMP code point in a string.
                A surrogate code point is found only if its match in the 
                text is not part of a surrogate pair.

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> select <span class='opr'>(</span>T c<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> x <span class='opr'>=</span> utils.indexOf <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, c, selectPoint<span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>x <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   select <span class='opr'>(</span>x, <span class='nbr'>1</span><span class='opr'>)</span>;
                   <span class='kw1'>return</span> <span class='kw2'>true</span>;
                   <span class='opr'>}</span>
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Find the first occurrence of a substring in a string. 

                The substring is found at code point boundaries. That means 
                that if the substring begins with a trail surrogate or ends 
                with a lead surrogate, then it is found only if these 
                surrogates stand alone in the text. Otherwise, the substring 
                edge units would be matched against halves of surrogate pairs.

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> select <span class='opr'>(</span>StringT!<span class='opr'>(</span>T<span class='opr'>)</span> other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> select <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Find the first occurrence of a substring in a string. 

                The substring is found at code point boundaries. That means 
                that if the substring begins with a trail surrogate or ends 
                with a lead surrogate, then it is found only if these 
                surrogates stand alone in the text. Otherwise, the substring 
                edge units would be matched against halves of surrogate pairs.

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> select <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> x <span class='opr'>=</span> utils.indexOf <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, chars, selectPoint<span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>x <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   select <span class='opr'>(</span>x, chars.length<span class='opr'>)</span>;
                   <span class='kw1'>return</span> <span class='kw2'>true</span>;
                   <span class='opr'>}</span>
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Find the last occurrence of a BMP code point in a string.
                A surrogate code point is found only if its match in the 
                text is not part of a surrogate pair.

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> rselect <span class='opr'>(</span>T c<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> x <span class='opr'>=</span> utils.rIndexOf <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, c, selectPoint<span class='opr'>+</span>selectLength<span class='opr'>)</span>;               
                <span class='kw1'>if</span> <span class='opr'>(</span>x <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   select <span class='opr'>(</span>x, <span class='nbr'>1</span><span class='opr'>)</span>;
                   <span class='kw1'>return</span> <span class='kw2'>true</span>;
                   <span class='opr'>}</span>
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Find the last occurrence of a BMP code point in a string.
                A surrogate code point is found only if its match in the 
                text is not part of a surrogate pair.

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> rselect <span class='opr'>(</span>StringT!<span class='opr'>(</span>T<span class='opr'>)</span> other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> rselect <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Find the last occurrence of a substring in a string. 

                The substring is found at code point boundaries. That means 
                that if the substring begins with a trail surrogate or ends 
                with a lead surrogate, then it is found only if these 
                surrogates stand alone in the text. Otherwise, the substring 
                edge units would be matched against halves of surrogate pairs.

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> rselect <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> x <span class='opr'>=</span> utils.rIndexOf <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, chars, selectPoint<span class='opr'>+</span>selectLength<span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>x <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   select <span class='opr'>(</span>x, chars.length<span class='opr'>)</span>;
                   <span class='kw1'>return</span> <span class='kw2'>true</span>;
                   <span class='opr'>}</span>
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append partial text to this MutableString

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span>StringT!<span class='opr'>(</span>T<span class='opr'>)</span> other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> append <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append text to this MutableString

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                convert <span class='opr'>(</span>chars, Type.Utf8<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append text to this MutableString

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span><span class='kw4'>wchar</span><span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                convert <span class='opr'>(</span>chars, Type.Utf16<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append text to this MutableString

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span><span class='kw4'>dchar</span><span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                convert <span class='opr'>(</span>chars, Type.Utf32<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append a count of characters to this MutableString

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span>T chr, <span class='kw4'>int</span> count<span class='opr'>=</span><span class='nbr'>1</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> point <span class='opr'>=</span> selectPoint <span class='opr'>+</span> selectLength;
                expand <span class='opr'>(</span>point, count<span class='opr'>)</span>;
                <span class='kw1'>return</span> set <span class='opr'>(</span>chr, point, count<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append an integer to this MutableString, using standard 
                printf() notation

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span><span class='kw4'>int</span> v, T<span class='opr'>[</span><span class='opr'>]</span> format<span class='opr'>=</span><span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                formatter <span class='opr'>(</span>format, <span class='opr'>&amp;</span>v, v.sizeof, Type.Int<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append a long to this MutableString, using standard 
                printf() notation

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span><span class='kw4'>long</span> v, T<span class='opr'>[</span><span class='opr'>]</span> format<span class='opr'>=</span><span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                formatter <span class='opr'>(</span>format, <span class='opr'>&amp;</span>v, v.sizeof, Type.Long<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Append a double to this MutableString, using standard 
                printf() notation

        ***********************************************************************/</span>

        MutableStringT append <span class='opr'>(</span><span class='kw4'>double</span> v, T<span class='opr'>[</span><span class='opr'>]</span> format<span class='opr'>=</span><span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                formatter <span class='opr'>(</span>format, <span class='opr'>&amp;</span>v, v.sizeof, Type.Double<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

                Format a set of arguments using the standard printf()
                formatting notation

        **********************************************************************/</span>

        MutableStringT format <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> fmt, <span class='opr'>..</span>.<span class='opr'>)</span>
        <span class='opr'>{</span>
                formatter <span class='opr'>(</span>fmt, _arguments, _argptr<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Insert characters into this MutableString

        ***********************************************************************/</span>

        MutableStringT prepend <span class='opr'>(</span>T chr, <span class='kw4'>uint</span> count<span class='opr'>=</span><span class='nbr'>1</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                expand <span class='opr'>(</span>selectPoint, count<span class='opr'>)</span>;
                <span class='kw1'>return</span> set <span class='opr'>(</span>chr, selectPoint, count<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Insert text into this MutableString

        ***********************************************************************/</span>

        MutableStringT prepend <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> other<span class='opr'>)</span>
        <span class='opr'>{</span>
                expand <span class='opr'>(</span>selectPoint, other.length<span class='opr'>)</span>;
                content<span class='opr'>[</span>selectPoint<span class='opr'>..</span>selectPoint<span class='opr'>+</span>other.length<span class='opr'>]</span> <span class='opr'>=</span> other;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Insert another String into this MutableString

        ***********************************************************************/</span>

        MutableStringT prepend <span class='opr'>(</span>StringT!<span class='opr'>(</span>T<span class='opr'>)</span> other<span class='opr'>)</span>
        <span class='opr'>{</span>       
                <span class='kw1'>return</span> prepend <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
                
                Replace a section of this MutableString with the specified 
                character

        ***********************************************************************/</span>

        MutableStringT replace <span class='opr'>(</span>T chr<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> set <span class='opr'>(</span>chr, selectPoint, selectLength<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
                
                Replace a section of this MutableString with the specified 
                array

        ***********************************************************************/</span>

        MutableStringT replace <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> chunk <span class='opr'>=</span> chars.length <span class='opr'>-</span> selectLength;
                <span class='kw1'>if</span> <span class='opr'>(</span>chunk <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                    expand <span class='opr'>(</span>selectPoint, chunk<span class='opr'>)</span>;
                <span class='kw1'>else</span>
                   remove <span class='opr'>(</span><span class='opr'>-</span>chunk<span class='opr'>)</span>;

                content <span class='opr'>[</span>selectPoint <span class='opr'>..</span> selectPoint<span class='opr'>+</span>chars.length<span class='opr'>]</span> <span class='opr'>=</span> chars;
                select <span class='opr'>(</span>selectPoint, chars.length<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
                
                Replace a section of this MutableString with the specified 
                String

        ***********************************************************************/</span>

        MutableStringT replace <span class='opr'>(</span>StringT!<span class='opr'>(</span>T<span class='opr'>)</span> other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> replace <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Remove the selection from this MutableString and reset the
                selection to zero length

        ***********************************************************************/</span>

        MutableStringT remove <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                remove <span class='opr'>(</span>selectLength<span class='opr'>)</span>;
                select <span class='opr'>(</span>selectPoint, <span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Remove the selection from this MutableString and reset the
                selection to zero length

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>int</span> remove <span class='opr'>(</span><span class='kw4'>int</span> count<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> start <span class='opr'>=</span> selectPoint;
                pinIndices <span class='opr'>(</span>start, count<span class='opr'>)</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>count <span class='opr'>&gt;</span> <span class='nbr'>0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw1'>if</span> <span class='opr'>(</span>! mutable<span class='opr'>)</span>
                         realloc <span class='opr'>(</span><span class='opr'>)</span>;

                   <span class='kw4'>uint</span> i <span class='opr'>=</span> start <span class='opr'>+</span> count;
                   memmove <span class='opr'>(</span>content.ptr<span class='opr'>+</span>start, content.ptr<span class='opr'>+</span>i, <span class='opr'>(</span>contentLength<span class='opr'>-</span>i<span class='opr'>)</span> <span class='opr'>*</span> T.sizeof<span class='opr'>)</span>;
                   contentLength <span class='opr'>-=</span> count;
                   <span class='opr'>}</span>
                <span class='kw1'>return</span> count;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Truncate this string. Default behaviour is to truncate at 
                the current append point

        ***********************************************************************/</span>

        MutableStringT truncate <span class='opr'>(</span><span class='kw4'>int</span> index <span class='opr'>=</span> <span class='kw4'>int</span>.max<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>index <span class='kw2'>is</span> <span class='kw4'>int</span>.max<span class='opr'>)</span>
                    index <span class='opr'>=</span> selectPoint <span class='opr'>+</span> selectLength;

                pinIndex <span class='opr'>(</span>index<span class='opr'>)</span>;
                contentLength <span class='opr'>=</span> index;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

                Arranges text strings in order, using indices to specify 
                where each particular argument should be positioned within 
                the text. This is handy for collating I18N components.

                ---
                auto string = new MutableString;

                string.layout (&quot;%2 %1&quot;, &quot;one&quot;, &quot;two&quot;);
                ---

                The index numbers range from one through nine      
              
        **********************************************************************/</span>

        MutableStringT layout <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span><span class='opr'>[</span><span class='opr'>]</span> layout <span class='opr'>..</span>.<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span>     args;
                <span class='kw4'>bool</span>    state;

                args <span class='opr'>=</span> layout.length <span class='opr'>-</span> <span class='nbr'>1</span>;
                <span class='kw1'>foreach</span> <span class='opr'>(</span>T c; layout<span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span><span class='opr'>)</span>
                        <span class='opr'>{</span>
                        <span class='kw1'>if</span> <span class='opr'>(</span>state<span class='opr'>)</span>
                           <span class='opr'>{</span>
                           state <span class='opr'>=</span> <span class='kw2'>false</span>;
                           <span class='kw1'>if</span> <span class='opr'>(</span>c <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='str'>'1'</span> || c <span class='opr'>&lt;</span><span class='opr'>=</span> <span class='str'>'9'</span><span class='opr'>)</span>
                              <span class='opr'>{</span>
                              <span class='kw4'>uint</span> index <span class='opr'>=</span> c <span class='opr'>-</span> <span class='str'>'0'</span>;
                              <span class='kw1'>if</span> <span class='opr'>(</span>index <span class='opr'>&lt;</span><span class='opr'>=</span> args<span class='opr'>)</span>
                                 <span class='opr'>{</span>
                                 append <span class='opr'>(</span>layout<span class='opr'>[</span>index<span class='opr'>]</span><span class='opr'>)</span>;
                                 <span class='kw1'>continue</span>;
                                 <span class='opr'>}</span>
                              <span class='kw1'>else</span>
                                 formatter.error <span class='opr'>(</span><span class='str'>&quot;TextLayout : invalid argument&quot;</span><span class='opr'>)</span>;
                              <span class='opr'>}</span>
                           <span class='opr'>}</span>
                        <span class='kw1'>else</span>
                           <span class='kw1'>if</span> <span class='opr'>(</span>c <span class='opr'>=</span><span class='opr'>=</span> <span class='str'>'%'</span><span class='opr'>)</span>
                              <span class='opr'>{</span>
                              state <span class='opr'>=</span> <span class='kw2'>true</span>;
                              <span class='kw1'>continue</span>;
                              <span class='opr'>}</span>
                        append <span class='opr'>(</span>c<span class='opr'>)</span>;
                        <span class='opr'>}</span>
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Remove leading and trailing whitespace from this String,
                and reset the selection to the trimmed content

        ***********************************************************************/</span>

        MutableStringT trim <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                content <span class='opr'>=</span> utils.trim <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>;
                select <span class='opr'>(</span><span class='nbr'>0</span>, contentLength <span class='opr'>=</span> content.length<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return an alias to the content of this MutableString

        ***********************************************************************/</span>

        T<span class='opr'>[</span><span class='opr'>]</span> aliasOf <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> get <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>


        <span class='com'>/* ================================================================== */</span>


        <span class='com'>/***********************************************************************
        
                make room available to insert or append something

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>final</span> <span class='kw4'>void</span> expand <span class='opr'>(</span><span class='kw4'>uint</span> index, <span class='kw4'>uint</span> count<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>!mutable || <span class='opr'>(</span>contentLength <span class='opr'>+</span> count<span class='opr'>)</span> <span class='opr'>&gt;</span> content.length<span class='opr'>)</span>
                     realloc <span class='opr'>(</span>count<span class='opr'>)</span>;

                memmove <span class='opr'>(</span>content.ptr<span class='opr'>+</span>index<span class='opr'>+</span>count, content.ptr<span class='opr'>+</span>index, <span class='opr'>(</span>contentLength <span class='opr'>-</span> index<span class='opr'>)</span> <span class='opr'>*</span> T.sizeof<span class='opr'>)</span>;
                selectLength <span class='opr'>+=</span> count;
                contentLength <span class='opr'>+=</span> count;                
        <span class='opr'>}</span>
                
        <span class='com'>/***********************************************************************
                
                Replace a section of this MutableString with the specified 
                character

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>final</span> MutableStringT set <span class='opr'>(</span>T chr, <span class='kw4'>uint</span> start, <span class='kw4'>uint</span> count<span class='opr'>)</span>
        <span class='opr'>{</span>
                content <span class='opr'>[</span>start<span class='opr'>..</span>start<span class='opr'>+</span>count<span class='opr'>]</span> <span class='opr'>=</span> chr;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Allocate memory due to a change in the content. We handle 
                the distinction between mutable and immutable here.

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>final</span> <span class='kw4'>void</span> realloc <span class='opr'>(</span><span class='kw4'>uint</span> count <span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> size <span class='opr'>=</span> <span class='opr'>(</span>content.length <span class='opr'>+</span> count <span class='opr'>+</span> <span class='nbr'>127</span><span class='opr'>)</span> <span class='opr'>&amp;</span> <span class='opr'>~</span><span class='nbr'>127</span>;
                
                <span class='kw1'>if</span> <span class='opr'>(</span>mutable<span class='opr'>)</span>
                    content.length <span class='opr'>=</span> size;
                <span class='kw1'>else</span>
                   <span class='opr'>{</span>
                   mutable <span class='opr'>=</span> <span class='kw2'>true</span>;
                   T<span class='opr'>[</span><span class='opr'>]</span> x <span class='opr'>=</span> content;
                   content <span class='opr'>=</span> <span class='kw2'>new</span> T<span class='opr'>[</span>size<span class='opr'>]</span>;
                   <span class='kw1'>if</span> <span class='opr'>(</span>contentLength<span class='opr'>)</span>
                       content<span class='opr'>[</span><span class='nbr'>0.</span>.contentLength<span class='opr'>]</span> <span class='opr'>=</span> x;
                   <span class='opr'>}</span>
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Internal method to support MutableString appending

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>final</span> MutableStringT append <span class='opr'>(</span>T<span class='opr'>*</span> chars, <span class='kw4'>uint</span> count<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> point <span class='opr'>=</span> selectPoint <span class='opr'>+</span> selectLength;
                expand <span class='opr'>(</span>point, count<span class='opr'>)</span>;
                content<span class='opr'>[</span>point <span class='opr'>..</span> point<span class='opr'>+</span>count<span class='opr'>]</span> <span class='opr'>=</span> chars<span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> count<span class='opr'>]</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Initialize this MutableString. Allocate conversion buffers
                and prime the formatter

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>void</span> setup <span class='opr'>(</span>Format.DblFormat df <span class='opr'>=</span> <span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                
                scratch  <span class='opr'>=</span> <span class='kw2'>new</span> T<span class='opr'>[</span><span class='nbr'>64</span><span class='opr'>]</span>;
                converts <span class='opr'>=</span> <span class='kw2'>new</span> T<span class='opr'>[</span><span class='nbr'>256</span><span class='opr'>]</span>;
                formatter.ctor <span class='opr'>(</span><span class='opr'>&amp;</span>convert, <span class='kw2'>null</span>, scratch, df<span class='opr'>)</span>;                
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

                Support for the formatter, to convert from one encoding
                to another

        **********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>uint</span> convert <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> v, <span class='kw4'>uint</span> type<span class='opr'>)</span>   
        <span class='opr'>{</span>
                <span class='com'>// convert as required</span>
                <span class='kw4'>auto</span> s <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span><span class='opr'>)</span> into.convert <span class='opr'>(</span>v, type, converts<span class='opr'>)</span>;
                        
                <span class='com'>// hang onto conversion buffer when it grows</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>s.length <span class='opr'>&gt;</span> converts.length<span class='opr'>)</span>
                    converts <span class='opr'>=</span> s;

                <span class='com'>// append to string</span>
                append <span class='opr'>(</span>s.ptr, s.length<span class='opr'>)</span>;
                <span class='kw1'>return</span> s.length;
        <span class='opr'>}</span>
<span class='opr'>}</span>



<span class='com'>/*******************************************************************************

        Immutable string

*******************************************************************************/</span>

<span class='kw4'>class</span> StringT<span class='opr'>(</span>T<span class='opr'>)</span> : UniString
<span class='opr'>{</span>
        <span class='kw4'>public</span> <span class='kw2'>alias</span> <span class='kw4'>int</span> <span class='kw2'>delegate</span> <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> a, T<span class='opr'>[</span><span class='opr'>]</span> b<span class='opr'>)</span> Comparator;
        <span class='kw4'>public</span> <span class='kw2'>alias</span> get                opIndex;

        <span class='com'>// unicode converter and utility functions</span>
        <span class='kw4'>public</span> Unicode.From!<span class='opr'>(</span>T<span class='opr'>)</span>         from;
        <span class='kw4'>public</span> TextT!<span class='opr'>(</span>T<span class='opr'>)</span>                utils;

        <span class='com'>// the core of the String and MutableString attributes. The name </span>
        <span class='com'>// 'contentLength' is used rather than the more obvious 'length' </span>
        <span class='com'>// since there is a collision with the noxious array[length] sugar</span>
        <span class='kw4'>protected</span> T<span class='opr'>[</span><span class='opr'>]</span>                   content;
        <span class='kw4'>protected</span> <span class='kw4'>uint</span>                  selectPoint,
                                        selectLength,
                                        contentLength;

        <span class='com'>// this should probably be in MutableString only, but there seems to </span>
        <span class='com'>// be a compiler bug where it doesn't get initialised correctly,</span>
        <span class='com'>// and it's perhaps useful to have here for when a MutableString is</span>
        <span class='com'>// passed as a String argument.</span>
        <span class='kw4'>protected</span> <span class='kw4'>bool</span>                  mutable;
        
        <span class='kw4'>private</span> Comparator              comparator;

        <span class='com'>/***********************************************************************
        
                Hidden constructor

        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw2'>this</span> <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span>.comparator <span class='opr'>=</span> <span class='opr'>&amp;</span>simpleComparator;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Construct read-only wrapper around the given content

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> content<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span><span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw2'>this</span>.content <span class='opr'>=</span> content;
                <span class='kw2'>this</span>.selectPoint <span class='opr'>=</span> <span class='nbr'>0</span>;
                <span class='kw2'>this</span>.selectLength <span class='opr'>=</span> <span class='kw2'>this</span>.contentLength <span class='opr'>=</span> content.length;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Get the encoding type

        ***********************************************************************/</span>    

    <span class='kw4'>uint</span> getEncoding<span class='opr'>(</span><span class='opr'>)</span>
    <span class='opr'>{</span>
        <span class='kw4'>static</span> <span class='kw1'>if</span><span class='opr'>(</span> <span class='kw2'>is</span><span class='opr'>(</span> T <span class='opr'>=</span><span class='opr'>=</span> <span class='kw4'>char</span> <span class='opr'>)</span><span class='opr'>)</span>
            <span class='kw1'>return</span> Type.Utf8;
        <span class='kw1'>else</span> <span class='kw4'>static</span> <span class='kw1'>if</span><span class='opr'>(</span> <span class='kw2'>is</span><span class='opr'>(</span> T <span class='opr'>=</span><span class='opr'>=</span> <span class='kw4'>wchar</span> <span class='opr'>)</span><span class='opr'>)</span>
            <span class='kw1'>return</span> Type.Utf16;
        <span class='kw1'>else</span> <span class='kw4'>static</span> <span class='kw1'>if</span><span class='opr'>(</span> <span class='kw2'>is</span><span class='opr'>(</span> T <span class='opr'>=</span><span class='opr'>=</span> <span class='kw4'>dchar</span> <span class='opr'>)</span><span class='opr'>)</span>
            <span class='kw1'>return</span> Type.Utf32;
    <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Set the comparator delegate

        ***********************************************************************/</span>

        <span class='kw4'>void</span> setComparator <span class='opr'>(</span>Comparator comparator<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span>.comparator <span class='opr'>=</span> comparator;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Hash this String

        ***********************************************************************/</span>

        <span class='kw4'>override</span> <span class='kw4'>uint</span> toHash <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> hash <span class='opr'>(</span>content <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> contentLength<span class='opr'>]</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return the length of the valid content

        ***********************************************************************/</span>

        <span class='kw4'>uint</span> length <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> contentLength;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Is this String equal to another?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> equals <span class='opr'>(</span>StringT other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>other <span class='kw2'>is</span> <span class='kw2'>this</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> <span class='kw2'>true</span>;
                <span class='kw1'>return</span> equals <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Is this String equal to the the provided text?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> equals <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>other.length <span class='opr'>=</span><span class='opr'>=</span> contentLength<span class='opr'>)</span>
                    <span class='kw1'>return</span> utils.equal <span class='opr'>(</span>other.ptr, content.ptr, contentLength<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Does this String end with another?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> ends <span class='opr'>(</span>StringT other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> ends <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Does this String end with the specified string?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> ends <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>chars.length <span class='opr'>&lt;</span><span class='opr'>=</span> contentLength<span class='opr'>)</span>
                    <span class='kw1'>return</span> utils.equal <span class='opr'>(</span>content.ptr<span class='opr'>+</span><span class='opr'>(</span>contentLength<span class='opr'>-</span>chars.length<span class='opr'>)</span>, chars.ptr, chars.length<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Does this String start with another?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> starts <span class='opr'>(</span>StringT other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> starts <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Does this String start with the specified string?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> starts <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>chars.length <span class='opr'>&lt;</span><span class='opr'>=</span> contentLength<span class='opr'>)</span>                
                    <span class='kw1'>return</span> utils.equal <span class='opr'>(</span>content.ptr, chars.ptr, chars.length<span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Compare this String start with another. Returns 0 if the 
                content matches, less than zero if this String is &quot;less&quot;
                than the other, or greater than zero where this String 
                is &quot;bigger&quot;.

        ***********************************************************************/</span>

        <span class='kw4'>int</span> compare <span class='opr'>(</span>StringT other<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>other <span class='kw2'>is</span> <span class='kw2'>this</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> <span class='nbr'>0</span>;

                <span class='kw1'>return</span> compare <span class='opr'>(</span>other.get<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Compare this String start with an array. Returns 0 if the 
                content matches, less than zero if this String is &quot;less&quot;
                than the other, or greater than zero where this String 
                is &quot;bigger&quot;.

        ***********************************************************************/</span>

        <span class='kw4'>int</span> compare <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> chars<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> comparator <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, chars<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return content from this String 
                
                A slice of dst is returned, representing a copy of the 
                content. The slice is clipped to the minimum of either 
                the length of the provided array, or the length of the 
                content minus the stipulated start point

        ***********************************************************************/</span>

        T<span class='opr'>[</span><span class='opr'>]</span> copy <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> dst<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> i <span class='opr'>=</span> contentLength;
                <span class='kw1'>if</span> <span class='opr'>(</span>i <span class='opr'>&gt;</span> dst.length<span class='opr'>)</span>
                    i <span class='opr'>=</span> dst.length;

                <span class='kw1'>return</span> dst <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> i<span class='opr'>]</span> <span class='opr'>=</span> content <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> i<span class='opr'>]</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return dup'd content from this String 

        ***********************************************************************/</span>

        T<span class='opr'>[</span><span class='opr'>]</span> copy <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> content <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> contentLength<span class='opr'>]</span>.dup;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************

                Convert to the AbstractString types. The optional argument
                dst will be resized as required to house the conversion. 
                To minimize heap allocation, use the following pattern:

                        String  string;

                        wchar[] buffer;
                        wchar[] result = string.toUtf16 (buffer);

                        if (result.length &gt; buffer.length)
                            buffer = result;

               You can also provide a buffer from the stack, but the output 
               will be moved to the heap if said buffer is not large enough

        ***********************************************************************/</span>

        <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> utf8 <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> dst <span class='opr'>=</span> <span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span><span class='opr'>)</span> from.convert <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, Type.Utf8, dst<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='kw4'>wchar</span><span class='opr'>[</span><span class='opr'>]</span> utf16 <span class='opr'>(</span><span class='kw4'>wchar</span><span class='opr'>[</span><span class='opr'>]</span> dst <span class='opr'>=</span> <span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>wchar</span><span class='opr'>[</span><span class='opr'>]</span><span class='opr'>)</span> from.convert <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, Type.Utf16, dst<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='kw4'>dchar</span><span class='opr'>[</span><span class='opr'>]</span> utf32 <span class='opr'>(</span><span class='kw4'>dchar</span><span class='opr'>[</span><span class='opr'>]</span> dst <span class='opr'>=</span> <span class='kw2'>null</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>dchar</span><span class='opr'>[</span><span class='opr'>]</span><span class='opr'>)</span> from.convert <span class='opr'>(</span>get<span class='opr'>(</span><span class='opr'>)</span>, Type.Utf32, dst<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

                Iterate over the characters in this string. Note that 
                this is a read-only freachable ~ the worst a user can
                do is alter the temporary 'c'

        **********************************************************************/</span>

        <span class='kw4'>int</span> opApply <span class='opr'>(</span><span class='kw4'>int</span> <span class='kw2'>delegate</span><span class='opr'>(</span><span class='kw2'>inout</span> T<span class='opr'>)</span> dg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>int</span> result <span class='opr'>=</span> <span class='nbr'>0</span>;

                <span class='kw1'>foreach</span> <span class='opr'>(</span>T c; get<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>
                         <span class='kw1'>if</span> <span class='opr'>(</span><span class='opr'>(</span>result <span class='opr'>=</span> dg <span class='opr'>(</span>c<span class='opr'>)</span><span class='opr'>)</span> <span class='opr'>!=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                             <span class='kw1'>break</span>;
                <span class='kw1'>return</span> result;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Compare this String to another

        ***********************************************************************/</span>

        <span class='kw4'>final</span> <span class='kw4'>override</span> <span class='kw4'>int</span> opCmp <span class='opr'>(</span><span class='kw3'>Object</span> o<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>auto</span> other <span class='opr'>=</span> <span class='kw2'>cast</span> <span class='opr'>(</span>StringT<span class='opr'>)</span> o;

                <span class='kw1'>if</span> <span class='opr'>(</span>other <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> <span class='opr'>-</span><span class='nbr'>1</span>;

                <span class='kw1'>return</span> compare <span class='opr'>(</span>other<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Is this String equal to another?

        ***********************************************************************/</span>

        <span class='kw4'>final</span> <span class='kw4'>override</span> <span class='kw4'>int</span> opEquals <span class='opr'>(</span><span class='kw3'>Object</span> o<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>auto</span> other <span class='opr'>=</span> <span class='kw2'>cast</span> <span class='opr'>(</span>StringT<span class='opr'>)</span> o;

                <span class='kw1'>if</span> <span class='opr'>(</span>other <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> <span class='nbr'>0</span>;

                <span class='kw1'>return</span> equals <span class='opr'>(</span>other<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**********************************************************************

            hash() -- hash a variable-length key into a 32-bit value

              k     : the key (the unaligned variable-length array of bytes)
              len   : the length of the key, counting by bytes
              level : can be any 4-byte value

            Returns a 32-bit value.  Every bit of the key affects every bit of
            the return value.  Every 1-bit and 2-bit delta achieves avalanche.

            About 4.3*len + 80 X86 instructions, with excellent pipelining

            The best hash table sizes are powers of 2.  There is no need to do
            mod a prime (mod is sooo slow!).  If you need less than 32 bits,
            use a bitmask.  For example, if you need only 10 bits, do

                        h = (h &amp; hashmask(10));

            In which case, the hash table should have hashsize(10) elements.
            If you are hashing n strings (ub1 **)k, do it like this:

                        for (i=0, h=0; i&lt;n; ++i) h = hash( k[i], len[i], h);

            By Bob Jenkins, 1996.  bob_jenkins@burtleburtle.net.  You may use 
            this code any way you wish, private, educational, or commercial.  
            It's free.
            
            See http://burlteburtle.net/bob/hash/evahash.html
            Use for hash table lookup, or anything where one collision in 2^32 
            is acceptable. Do NOT use for cryptographic purposes.

        **********************************************************************/</span>

        <span class='kw4'>static</span> <span class='kw4'>final</span> <span class='kw4'>uint</span> hash <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>[</span><span class='opr'>]</span> x, <span class='kw4'>uint</span> c <span class='opr'>=</span> <span class='nbr'>0</span><span class='opr'>)</span>
        <span class='opr'>{</span>
            <span class='kw4'>uint</span>    a,
                    b;

            a <span class='opr'>=</span> b <span class='opr'>=</span> <span class='nbr'>0</span>x9e3779b9; 

            <span class='kw4'>uint</span> len <span class='opr'>=</span> x.length;
            <span class='kw4'>ubyte</span><span class='opr'>*</span> k <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>ubyte</span> <span class='opr'>*</span><span class='opr'>)</span> x.ptr;

            <span class='com'>// handle most of the key </span>
            <span class='kw1'>while</span> <span class='opr'>(</span>len <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='nbr'>12</span><span class='opr'>)</span> 
                  <span class='opr'>{</span>
                  a <span class='opr'>+=</span> <span class='opr'>*</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span> <span class='opr'>*</span><span class='opr'>)</span><span class='opr'>(</span>k<span class='opr'>+</span><span class='nbr'>0</span><span class='opr'>)</span>;
                  b <span class='opr'>+=</span> <span class='opr'>*</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span> <span class='opr'>*</span><span class='opr'>)</span><span class='opr'>(</span>k<span class='opr'>+</span><span class='nbr'>4</span><span class='opr'>)</span>;
                  c <span class='opr'>+=</span> <span class='opr'>*</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span> <span class='opr'>*</span><span class='opr'>)</span><span class='opr'>(</span>k<span class='opr'>+</span><span class='nbr'>8</span><span class='opr'>)</span>;

                  a <span class='opr'>-=</span> b; a <span class='opr'>-=</span> c; a ^<span class='opr'>=</span> <span class='opr'>(</span>c<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>13</span><span class='opr'>)</span>; 
                  b <span class='opr'>-=</span> c; b <span class='opr'>-=</span> a; b ^<span class='opr'>=</span> <span class='opr'>(</span>a<span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>8</span><span class='opr'>)</span>; 
                  c <span class='opr'>-=</span> a; c <span class='opr'>-=</span> b; c ^<span class='opr'>=</span> <span class='opr'>(</span>b<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>13</span><span class='opr'>)</span>; 
                  a <span class='opr'>-=</span> b; a <span class='opr'>-=</span> c; a ^<span class='opr'>=</span> <span class='opr'>(</span>c<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>12</span><span class='opr'>)</span>;  
                  b <span class='opr'>-=</span> c; b <span class='opr'>-=</span> a; b ^<span class='opr'>=</span> <span class='opr'>(</span>a<span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>16</span><span class='opr'>)</span>; 
                  c <span class='opr'>-=</span> a; c <span class='opr'>-=</span> b; c ^<span class='opr'>=</span> <span class='opr'>(</span>b<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>5</span><span class='opr'>)</span>; 
                  a <span class='opr'>-=</span> b; a <span class='opr'>-=</span> c; a ^<span class='opr'>=</span> <span class='opr'>(</span>c<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>3</span><span class='opr'>)</span>;  
                  b <span class='opr'>-=</span> c; b <span class='opr'>-=</span> a; b ^<span class='opr'>=</span> <span class='opr'>(</span>a<span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>10</span><span class='opr'>)</span>; 
                  c <span class='opr'>-=</span> a; c <span class='opr'>-=</span> b; c ^<span class='opr'>=</span> <span class='opr'>(</span>b<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>15</span><span class='opr'>)</span>; 
                  k <span class='opr'>+=</span> <span class='nbr'>12</span>; len <span class='opr'>-=</span> <span class='nbr'>12</span>;
                  <span class='opr'>}</span>

            <span class='com'>// handle the last 11 bytes </span>
            c <span class='opr'>+=</span> x.length;
            <span class='kw1'>switch</span> <span class='opr'>(</span>len<span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw1'>case</span> <span class='nbr'>11</span>: c<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>10</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>24</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>10</span>: c<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>9</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>16</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>9</span> : c<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>8</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>8</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>8</span> : b<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>7</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>24</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>7</span> : b<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>6</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>16</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>6</span> : b<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>5</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>8</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>5</span> : b<span class='opr'>+=</span>k<span class='opr'>[</span><span class='nbr'>4</span><span class='opr'>]</span>;
                   <span class='kw1'>case</span> <span class='nbr'>4</span> : a<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>3</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>24</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>3</span> : a<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>2</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>16</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>2</span> : a<span class='opr'>+=</span><span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>)</span>k<span class='opr'>[</span><span class='nbr'>1</span><span class='opr'>]</span><span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>8</span><span class='opr'>)</span>;
                   <span class='kw1'>case</span> <span class='nbr'>1</span> : a<span class='opr'>+=</span>k<span class='opr'>[</span><span class='nbr'>0</span><span class='opr'>]</span>;
                   <span class='kw2'>default</span>:
                   <span class='opr'>}</span>

            a <span class='opr'>-=</span> b; a <span class='opr'>-=</span> c; a ^<span class='opr'>=</span> <span class='opr'>(</span>c<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>13</span><span class='opr'>)</span>; 
            b <span class='opr'>-=</span> c; b <span class='opr'>-=</span> a; b ^<span class='opr'>=</span> <span class='opr'>(</span>a<span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>8</span><span class='opr'>)</span>; 
            c <span class='opr'>-=</span> a; c <span class='opr'>-=</span> b; c ^<span class='opr'>=</span> <span class='opr'>(</span>b<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>13</span><span class='opr'>)</span>; 
            a <span class='opr'>-=</span> b; a <span class='opr'>-=</span> c; a ^<span class='opr'>=</span> <span class='opr'>(</span>c<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>12</span><span class='opr'>)</span>;  
            b <span class='opr'>-=</span> c; b <span class='opr'>-=</span> a; b ^<span class='opr'>=</span> <span class='opr'>(</span>a<span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>16</span><span class='opr'>)</span>; 
            c <span class='opr'>-=</span> a; c <span class='opr'>-=</span> b; c ^<span class='opr'>=</span> <span class='opr'>(</span>b<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>5</span><span class='opr'>)</span>; 
            a <span class='opr'>-=</span> b; a <span class='opr'>-=</span> c; a ^<span class='opr'>=</span> <span class='opr'>(</span>c<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>3</span><span class='opr'>)</span>;  
            b <span class='opr'>-=</span> c; b <span class='opr'>-=</span> a; b ^<span class='opr'>=</span> <span class='opr'>(</span>a<span class='opr'>&lt;</span><span class='opr'>&lt;</span><span class='nbr'>10</span><span class='opr'>)</span>; 
            c <span class='opr'>-=</span> a; c <span class='opr'>-=</span> b; c ^<span class='opr'>=</span> <span class='opr'>(</span>b<span class='opr'>&gt;</span><span class='opr'>&gt;</span><span class='nbr'>15</span><span class='opr'>)</span>; 

            <span class='kw1'>return</span> c;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Throw an exception

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>final</span> <span class='kw4'>void</span> error <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>static</span> <span class='kw4'>class</span> TextException : Exception
                <span class='opr'>{</span>
                        <span class='kw2'>this</span> <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
                        <span class='opr'>{</span>
                                <span class='kw2'>super</span> <span class='opr'>(</span>msg<span class='opr'>)</span>;
                        <span class='opr'>}</span>
                <span class='opr'>}</span>

                <span class='kw2'>throw</span> <span class='kw2'>new</span> TextException <span class='opr'>(</span>msg<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return the valid content from this String

        ***********************************************************************/</span>

        <span class='kw4'>package</span> <span class='kw4'>final</span> T<span class='opr'>[</span><span class='opr'>]</span> get <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                    <span class='kw1'>return</span> content <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> contentLength<span class='opr'>]</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Pin the given index to a valid position.

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>final</span> <span class='kw4'>void</span> pinIndex <span class='opr'>(</span><span class='kw2'>inout</span> <span class='kw4'>int</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>x <span class='opr'>&gt;</span> contentLength<span class='opr'>)</span>
                    x <span class='opr'>=</span> contentLength;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Pin the given index and length to a valid position.

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>final</span> <span class='kw4'>void</span> pinIndices <span class='opr'>(</span><span class='kw2'>inout</span> <span class='kw4'>int</span> start, <span class='kw2'>inout</span> <span class='kw4'>int</span> length<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>start <span class='opr'>&gt;</span> contentLength<span class='opr'>)</span> 
                    start <span class='opr'>=</span> contentLength;

                <span class='kw1'>if</span> <span class='opr'>(</span>length <span class='opr'>&gt;</span> <span class='opr'>(</span>contentLength <span class='opr'>-</span> start<span class='opr'>)</span><span class='opr'>)</span>
                    length <span class='opr'>=</span> contentLength <span class='opr'>-</span> start;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Simple comparator

                Compare two arrays. Returns 0 if the content matches, less 
                than zero if A is &quot;less&quot; than B, or greater than zero where 
                A is &quot;bigger&quot;. Where the substrings match, the shorter is 
                considered &quot;less&quot;.

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> <span class='kw4'>final</span> <span class='kw4'>int</span> simpleComparator <span class='opr'>(</span>T<span class='opr'>[</span><span class='opr'>]</span> a, T<span class='opr'>[</span><span class='opr'>]</span> b<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>uint</span> i <span class='opr'>=</span> a.length;
                <span class='kw1'>if</span> <span class='opr'>(</span>b.length <span class='opr'>&lt;</span> i<span class='opr'>)</span>
                    i <span class='opr'>=</span> b.length;

                <span class='kw1'>for</span> <span class='opr'>(</span><span class='kw4'>int</span> j, k; j <span class='opr'>&lt;</span> i; <span class='opr'>+</span><span class='opr'>+</span>j<span class='opr'>)</span>
                     <span class='kw1'>if</span> <span class='opr'>(</span><span class='opr'>(</span>k <span class='opr'>=</span> a<span class='opr'>[</span>j<span class='opr'>]</span> <span class='opr'>-</span> b<span class='opr'>[</span>j<span class='opr'>]</span><span class='opr'>)</span> <span class='opr'>!=</span> <span class='nbr'>0</span><span class='opr'>)</span>
                          <span class='kw1'>return</span> k;
                
                <span class='kw1'>return</span> a.length <span class='opr'>-</span> b.length;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Emit content to the provided writer  (IWritable interface)

        ***********************************************************************/</span>
       
       <span class='kw4'>void</span> write <span class='opr'>(</span>IWriter write<span class='opr'>)</span>
       <span class='opr'>{</span>        
                write <span class='opr'>(</span>content <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> contentLength<span class='opr'>]</span><span class='opr'>)</span>;
       <span class='opr'>}</span>
<span class='opr'>}</span>       


<span class='com'>// convenience alias</span>
<span class='kw2'>alias</span> StringT!<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>)</span> String;

<span class='com'>// convenience alias</span>
<span class='kw2'>alias</span> MutableStringT!<span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>)</span> MutableString;

</pre></td></tr></table>	</body>
</html>
