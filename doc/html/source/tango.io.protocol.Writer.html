<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="style.css" type="text/css" />
		<title>io/protocol/Writer.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span>
<span>72</span>
<span>73</span>
<span>74</span>
<span>75</span>
<span>76</span>
<span>77</span>
<span>78</span>
<span>79</span>
<span>80</span>
<span>81</span>
<span>82</span>
<span>83</span>
<span>84</span>
<span>85</span>
<span>86</span>
<span>87</span>
<span>88</span>
<span>89</span>
<span>90</span>
<span>91</span>
<span>92</span>
<span>93</span>
<span>94</span>
<span>95</span>
<span>96</span>
<span>97</span>
<span>98</span>
<span>99</span>
<span>100</span>
<span>101</span>
<span>102</span>
<span>103</span>
<span>104</span>
<span>105</span>
<span>106</span>
<span>107</span>
<span>108</span>
<span>109</span>
<span>110</span>
<span>111</span>
<span>112</span>
<span>113</span>
<span>114</span>
<span>115</span>
<span>116</span>
<span>117</span>
<span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
<span>139</span>
<span>140</span>
<span>141</span>
<span>142</span>
<span>143</span>
<span>144</span>
<span>145</span>
<span>146</span>
<span>147</span>
<span>148</span>
<span>149</span>
<span>150</span>
<span>151</span>
<span>152</span>
<span>153</span>
<span>154</span>
<span>155</span>
<span>156</span>
<span>157</span>
<span>158</span>
<span>159</span>
<span>160</span>
<span>161</span>
<span>162</span>
<span>163</span>
<span>164</span>
<span>165</span>
<span>166</span>
<span>167</span>
<span>168</span>
<span>169</span>
<span>170</span>
<span>171</span>
<span>172</span>
<span>173</span>
<span>174</span>
<span>175</span>
<span>176</span>
<span>177</span>
<span>178</span>
<span>179</span>
<span>180</span>
<span>181</span>
<span>182</span>
<span>183</span>
<span>184</span>
<span>185</span>
<span>186</span>
<span>187</span>
<span>188</span>
<span>189</span>
<span>190</span>
<span>191</span>
<span>192</span>
<span>193</span>
<span>194</span>
<span>195</span>
<span>196</span>
<span>197</span>
<span>198</span>
<span>199</span>
<span>200</span>
<span>201</span>
<span>202</span>
<span>203</span>
<span>204</span>
<span>205</span>
<span>206</span>
<span>207</span>
<span>208</span>
<span>209</span>
<span>210</span>
<span>211</span>
<span>212</span>
<span>213</span>
<span>214</span>
<span>215</span>
<span>216</span>
<span>217</span>
<span>218</span>
<span>219</span>
<span>220</span>
<span>221</span>
<span>222</span>
<span>223</span>
<span>224</span>
<span>225</span>
<span>226</span>
<span>227</span>
<span>228</span>
<span>229</span>
<span>230</span>
<span>231</span>
<span>232</span>
<span>233</span>
<span>234</span>
<span>235</span>
<span>236</span>
<span>237</span>
<span>238</span>
<span>239</span>
<span>240</span>
<span>241</span>
<span>242</span>
<span>243</span>
<span>244</span>
<span>245</span>
<span>246</span>
<span>247</span>
<span>248</span>
<span>249</span>
<span>250</span>
<span>251</span>
<span>252</span>
<span>253</span>
<span>254</span>
<span>255</span>
<span>256</span>
<span>257</span>
<span>258</span>
<span>259</span>
<span>260</span>
<span>261</span>
<span>262</span>
<span>263</span>
<span>264</span>
<span>265</span>
<span>266</span>
<span>267</span>
<span>268</span>
<span>269</span>
<span>270</span>
<span>271</span>
<span>272</span>
<span>273</span>
<span>274</span>
<span>275</span>
<span>276</span>
<span>277</span>
<span>278</span>
<span>279</span>
<span>280</span>
<span>281</span>
<span>282</span>
<span>283</span>
<span>284</span>
<span>285</span>
<span>286</span>
<span>287</span>
<span>288</span>
<span>289</span>
<span>290</span>
<span>291</span>
<span>292</span>
<span>293</span>
<span>294</span>
<span>295</span>
<span>296</span>
<span>297</span>
<span>298</span>
<span>299</span>
<span>300</span>
<span>301</span>
<span>302</span>
<span>303</span>
<span>304</span>
<span>305</span>
<span>306</span>
<span>307</span>
<span>308</span>
<span>309</span>
<span>310</span>
<span>311</span>
<span>312</span>
<span>313</span>
<span>314</span>
<span>315</span>
<span>316</span>
<span>317</span>
<span>318</span>
<span>319</span>
<span>320</span>
<span>321</span>
<span>322</span>
<span>323</span>
<span>324</span>
<span>325</span>
<span>326</span>
<span>327</span>
<span>328</span>
<span>329</span>
<span>330</span>
<span>331</span>
<span>332</span>
<span>333</span>
<span>334</span>
<span>335</span>
<span>336</span>
<span>337</span>
<span>338</span>
<span>339</span>
<span>340</span>
<span>341</span>
<span>342</span>
<span>343</span>
<span>344</span>
<span>345</span>
<span>346</span>
<span>347</span>
<span>348</span>
<span>349</span>
<span>350</span>
<span>351</span>
<span>352</span>
<span>353</span>
<span>354</span>
<span>355</span>
<span>356</span>
<span>357</span>
<span>358</span>
<span>359</span>
<span>360</span>
<span>361</span>
<span>362</span>
<span>363</span>
<span>364</span>
<span>365</span>
<span>366</span>
<span>367</span>
<span>368</span>
<span>369</span>
<span>370</span>
<span>371</span>
<span>372</span>
<span>373</span>
<span>374</span>
<span>375</span>
<span>376</span>
<span>377</span>
<span>378</span>
<span>379</span>
<span>380</span>
<span>381</span>
<span>382</span>
<span>383</span>
<span>384</span>
<span>385</span>
<span>386</span>
<span>387</span>
<span>388</span>
<span>389</span>
<span>390</span>
<span>391</span>
<span>392</span>
<span>393</span>
<span>394</span>
<span>395</span>
<span>396</span>
<span>397</span>
<span>398</span>
<span>399</span>
<span>400</span>
<span>401</span>
<span>402</span>
<span>403</span>
<span>404</span>
<span>405</span>
<span>406</span>
<span>407</span>
<span>408</span>
<span>409</span>
<span>410</span>
<span>411</span>
<span>412</span>
<span>413</span>
<span>414</span>
<span>415</span>
<span>416</span>
<span>417</span>
<span>418</span>
<span>419</span>
<span>420</span>
<span>421</span>
<span>422</span>
<span>423</span>
<span>424</span>
<span>425</span>
<span>426</span>
<span>427</span>
<span>428</span>
<span>429</span>
<span>430</span>
<span>431</span>
<span>432</span>
<span>433</span>
<span>434</span>
<span>435</span>
<span>436</span>
<span>437</span>
<span>438</span>
<span>439</span>
<span>440</span>
<span>441</span>
<span>442</span>
<span>443</span>
<span>444</span>
<span>445</span>
<span>446</span>
<span>447</span>
<span>448</span>
<span>449</span>
<span>450</span>
<span>451</span>
<span>452</span>
<span>453</span>
<span>454</span>
<span>455</span>
<span>456</span>
<span>457</span>
<span>458</span>
<span>459</span>
<span>460</span>
<span>461</span>
<span>462</span>
<span>463</span>
<span>464</span>
<span>465</span>
<span>466</span>
<span>467</span>
<span>468</span>
<span>469</span>
<span>470</span>
<span>471</span>
<span>472</span>
<span>473</span>
<span>474</span>
<span>475</span>
<span>476</span>
<span>477</span>
<span>478</span>
<span>479</span>
<span>480</span>
<span>481</span>
<span>482</span>
<span>483</span>
<span>484</span>
<span>485</span>
<span>486</span>
<span>487</span>
<span>488</span>
<span>489</span>
<span>490</span>
<span>491</span>
<span>492</span>
<span>493</span>
<span>494</span>
<span>495</span>
<span>496</span>
<span>497</span>
<span>498</span>
<span>499</span>
<span>500</span>
<span>501</span>
<span>502</span>
<span>503</span>
<span>504</span>
<span>505</span>
<span>506</span>
<span>507</span>
<span>508</span>
<span>509</span>
<span>510</span>
<span>511</span>
<span>512</span>
<span>513</span>
<span>514</span>
<span>515</span>
<span>516</span>
<span>517</span>
<span>518</span>
<span>519</span>
<span>520</span>
<span>521</span>
<span>522</span>
<span>523</span>
<span>524</span>
<span>525</span>
<span>526</span>
<span>527</span>
<span>528</span>
<span>529</span>
<span>530</span>
<span>531</span>
<span>532</span>
<span>533</span>
<span>534</span>
<span>535</span>
<span>536</span>
<span>537</span>
<span>538</span>
<span>539</span>
<span>540</span>
<span>541</span>
<span>542</span>
<span>543</span>
<span>544</span>
<span>545</span>
<span>546</span>
<span>547</span>
<span>548</span>
<span>549</span>
<span>550</span>
<span>551</span>
<span>552</span>
<span>553</span>
<span>554</span>
<span>555</span>
<span>556</span>
<span>557</span>
<span>558</span>
<span>559</span>
<span>560</span>
<span>561</span>
<span>562</span>
<span>563</span>
<span>564</span>
<span>565</span>
<span>566</span>
<span>567</span>
<span>568</span>
<span>569</span>
<span>570</span>
<span>571</span>
<span>572</span>
<span>573</span>
<span>574</span>
<span>575</span>
<span>576</span>
<span>577</span>
<span>578</span>
<span>579</span>
<span>580</span>
<span>581</span>
<span>582</span>
<span>583</span>
<span>584</span>
<span>585</span>
<span>586</span>
<span>587</span>
<span>588</span>
<span>589</span>
<span>590</span>
<span>591</span>
<span>592</span>
<span>593</span>
<span>594</span>
<span>595</span>
<span>596</span>
<span>597</span>
<span>598</span>
<span>599</span>
<span>600</span>
<span>601</span>
<span>602</span>
<span>603</span>
<span>604</span>
<span>605</span>
<span>606</span>
<span>607</span>
<span>608</span>
<span>609</span>
<span>610</span>
<span>611</span>
<span>612</span>
<span>613</span>
<span>614</span>
<span>615</span>
<span>616</span>
<span>617</span>
<span>618</span>
<span>619</span>
<span>620</span>
<span>621</span>
<span>622</span>
<span>623</span>
<span>624</span>
<span>625</span>
<span>626</span>
<span>627</span>
<span>628</span>
<span>629</span>
<span>630</span>
<span>631</span>
<span>632</span>
<span>633</span>
<span>634</span>
<span>635</span>
<span>636</span>
<span>637</span>
<span>638</span>
<span>639</span>
<span>640</span>
<span>641</span>
<span>642</span>
<span>643</span>
<span>644</span>
<span>645</span>
<span>646</span>
<span>647</span>
<span>648</span>
<span>649</span>
<span>650</span>
<span>651</span>
<span>652</span>
<span>653</span>
<span>654</span>
<span>655</span>
<span>656</span>
<span>657</span>
<span>658</span>
<span>659</span>
<span>660</span>
<span>661</span>
<span>662</span>
<span>663</span>
<span>664</span>
<span>665</span>
<span>666</span>
<span>667</span>
<span>668</span>
<span>669</span>
<span>670</span>
<span>671</span>
<span>672</span>
<span>673</span>
<span>674</span>
<span>675</span>
<span>676</span>
<span>677</span>
<span>678</span>
<span>679</span>
<span>680</span>
<span>681</span>
<span>682</span>
<span>683</span>
<span>684</span>
<span>685</span>
<span>686</span>
<span>687</span>
<span>688</span>
<span>689</span>
<span>690</span>
<span>691</span>
<span>692</span>
<span>693</span>
<span>694</span>
<span>695</span>
<span>696</span>
<span>697</span>
<span>698</span>
<span>699</span>
<span>700</span>
<span>701</span>
<span>702</span>
<span>703</span>
<span>704</span>
<span>705</span>
<span>706</span>
<span>707</span>
<span>708</span>
<span>709</span>
<span>710</span>
<span>711</span>
<span>712</span>
<span>713</span>
<span>714</span>
</pre></td><td id='code'><pre><span class='com'>/*******************************************************************************

        copyright:      Copyright (c) 2004 Kris Bell. All rights reserved

        license:        BSD style: $(LICENSE)

        version:        Initial release: October 2004    
        
        author:         Kris 

*******************************************************************************/</span>

<span class='kw2'>module</span> tango.io.protocol.Writer;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.convert.Type;

<span class='kw4'>private</span> <span class='kw2'>import</span>  tango.io.Exception;

<span class='kw4'>public</span>  <span class='kw2'>import</span>  tango.io.Buffer;

<span class='kw4'>public</span>  <span class='kw2'>import</span>  tango.io.protocol.model.IWriter,
                tango.io.model.IBuffer,
                tango.io.model.IConduit;

<span class='com'>/*******************************************************************************

        Writer base-class. Writers provide the means to append formatted 
        data to an IBuffer, and expose a convenient method of handling a
        variety of data types. In addition to writing native types such
        as integer and char[], writers also process any class which has
        implemented the IWritable interface (one method).

        All writers support the full set of native data types, plus their
        fundamental array variants. Operations may be chained back-to-back.

        Writers support a C++ iostream type syntax, along with Java-esque 
        put() notation. However, the Mango style is to place IO elements 
        within their own parenthesis, like so:
        
                write (count) (&quot; green bottles&quot;);

        Note that each element is distict; this enables &quot;strong typing&quot;, 
        which should catch any typo errors at compile-time. The style is
        affectionately called &quot;whisper&quot;.

        The code below illustrates basic operation upon a memory buffer:
        
        @code
        Buffer buf = new Buffer (256);

        // map same buffer into both reader and writer
        IReader read = new Reader(buf);
        IWriter write = new Writer(buf);

        int i = 10;
        long j = 20;
        double d = 3.14159;
        char[] c = &quot;fred&quot;;

        // write data types out
        write (c) (i) (j) (d);

        // read them back again
        read (c) (i) (j) (d);

        // reset
        buf.clear();

        // same thing again, but using iostream syntax instead
        write &lt;&lt; c &lt;&lt; i &lt;&lt; j &lt;&lt; d;

        // read them back again
        read &gt;&gt; c &gt;&gt; i &gt;&gt; j &gt;&gt; d;

        // reset
        buf.clear();

        // same thing again, but using put() syntax instead
        write.put(c).put(i).put(j).put(d);
        read.get(c).get(i).get(j).get(d);

        @endcode

        Writers may also be used with any class implementing the IWritable
        interface. See PickleReader for an example of how this can be put
        to good use.

        Note that 'newlines' are emitted via the standard &quot;\n&quot; approach. 
        However, one might consider using the public CR element instead.

        Writers also support formatted output via the DisplayWriter module,
        which has full support for printf() syntax:

        @code
        Stdout.println (&quot;%d green bottles&quot;, 10);
        @endcode
        
        Lastly, each Writer may be configured with a text encoder. These
        encoders convert between an internal text representation, and the
        char/wchar/dchar representaion. BufferCodec.d contains classes for
        handling utf8, utf16, and utf32. The icu.UMango module has support
        for a wide variety of converters. Stdout is pre-configured with
        utf16 &amp; utf8 encoders for Win32 and Posix respectively.
        
*******************************************************************************/</span>

<span class='kw4'>class</span> Writer : IWriter
<span class='opr'>{</span>     
        <span class='kw2'>alias</span> newline                   cr;    

        <span class='com'>// the buffer associated with this writer. Note that this</span>
        <span class='com'>// should not change over the lifetime of the reader, since</span>
        <span class='com'>// it is assumed to be immutable elsewhere </span>
        <span class='kw4'>protected</span> IBuffer               buffer;

        <span class='com'>// should arrays be prefixed with a length?</span>
        <span class='kw4'>private</span>   <span class='kw4'>bool</span>                  prefixArray;

        <span class='com'>// String encoder</span>
        <span class='kw4'>private</span>   IBuffer.Converter     textEncoder;

        <span class='com'>// current encoder type (reset via setEncoder)</span>
        <span class='kw4'>private</span>   <span class='kw4'>int</span>                   encoderType <span class='opr'>=</span> Type.Raw;


        <span class='com'>/***********************************************************************
        
                Construct a Writer upon the provided IBuffer. All formatted
                output will be directed to this buffer.

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>IBuffer buffer<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span>.buffer <span class='opr'>=</span> buffer;

                Buffer.Style s <span class='opr'>=</span> buffer.getStyle;
                <span class='kw1'>if</span> <span class='opr'>(</span>s <span class='opr'>!=</span> Buffer.Mixed<span class='opr'>)</span>
                    <span class='kw1'>if</span> <span class='opr'>(</span><span class='opr'>(</span>s <span class='opr'>=</span><span class='opr'>=</span> Buffer.Text<span class='opr'>)</span> ^ isTextBased<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>
                         error <span class='opr'>(</span><span class='str'>&quot;text/binary mismatch between Writer and Buffer&quot;</span><span class='opr'>)</span>;
                prefixArray <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>bool</span><span class='opr'>)</span> !isTextBased;
        <span class='opr'>}</span>
     
        <span class='com'>/***********************************************************************
        
                Construct a Writer on the buffer associated with the given
                conduit.

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span>IConduit conduit<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span> <span class='opr'>(</span><span class='kw2'>new</span> Buffer<span class='opr'>(</span>conduit<span class='opr'>)</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
        ***********************************************************************/</span>

        <span class='kw4'>final</span> <span class='kw4'>void</span> error <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> msg<span class='opr'>)</span>
        <span class='opr'>{</span>
                buffer.error <span class='opr'>(</span>msg<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return the associated buffer

        ***********************************************************************/</span>

        <span class='kw4'>final</span> IBuffer getBuffer <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>     
                <span class='kw1'>return</span> buffer;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
        ***********************************************************************/</span>

        <span class='kw4'>final</span> IConduit conduit <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> buffer.getConduit<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Bind an IEncoder to the writer. Encoders are intended to
                be used as a conversion mechanism between various character
                representations (encodings). Each writer may be configured 
                with a distinct encoder.

        ***********************************************************************/</span>

        <span class='kw4'>final</span> <span class='kw4'>void</span> setEncoder <span class='opr'>(</span>AbstractEncoder e<span class='opr'>)</span> 
        <span class='opr'>{</span>
                e.bind <span class='opr'>(</span>buffer<span class='opr'>)</span>;
                encoderType <span class='opr'>=</span> e.type;
                textEncoder <span class='opr'>=</span> <span class='opr'>&amp;</span>e.encoder;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Return the current encoder type (Type.Raw if not set)

        ***********************************************************************/</span>

        <span class='kw4'>final</span> <span class='kw4'>int</span> getEncoderType <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> encoderType;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Is this Writer text oriented?

        ***********************************************************************/</span>

        <span class='kw4'>bool</span> isTextBased<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Flush the output of this writer. Returns false if the 
                operation failed, true otherwise.

        ***********************************************************************/</span>

        IWriter flush <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>  
                buffer.flush <span class='opr'>(</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Output a newline. Do this indirectly so that it can be 
                intercepted by subclasses.

        ***********************************************************************/</span>

        IWriter newline <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> put <span class='opr'>(</span>CR<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Flush this writer. This is a convenience method used by
                the &quot;whisper&quot; syntax.
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='opr'>)</span> 
        <span class='opr'>{</span>
                <span class='kw1'>return</span> flush <span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a class to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span>IWritable x<span class='opr'>)</span> 
        <span class='opr'>{</span>
                <span class='kw2'>assert</span> <span class='opr'>(</span>x<span class='opr'>)</span>;
                x.write <span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>; 
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a boolean value to the current buffer-position    
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>bool</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Bool<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an unsigned byte value to the current buffer-position     
                                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>ubyte</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.UByte<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a byte value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>byte</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Byte<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an unsigned short value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>ushort</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.UShort<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a short value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>short</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Short<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a unsigned int value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>uint</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.UInt<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an int value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>int</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Int<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an unsigned long value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>ulong</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.ULong<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a long value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>long</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Long<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a float value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>float</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Float<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a double value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>double</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Double<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a real value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>real</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span><span class='opr'>&amp;</span>x, x.sizeof, Type.Real<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a char value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>char</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> encode <span class='opr'>(</span><span class='opr'>&amp;</span>x, <span class='kw4'>char</span>.sizeof, Type.Utf8<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a wchar value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>wchar</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> encode <span class='opr'>(</span><span class='opr'>&amp;</span>x, <span class='kw4'>wchar</span>.sizeof, Type.Utf16<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a dchar value to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>dchar</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> encode <span class='opr'>(</span><span class='opr'>&amp;</span>x, <span class='kw4'>dchar</span>.sizeof, Type.Utf32<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a byte array to the current buffer-position     
                                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>byte</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>byte</span>.sizeof, Type.Byte<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an unsigned byte array to the current buffer-position     
                                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>ubyte</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>ubyte</span>.sizeof, Type.UByte<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a short array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>short</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>short</span>.sizeof, Type.Short<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an unsigned short array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>ushort</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>ushort</span>.sizeof, Type.UShort<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an int array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>int</span>.sizeof, Type.Int<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an unsigned int array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>uint</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>uint</span>.sizeof, Type.UInt<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a long array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>long</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>long</span>.sizeof, Type.Long<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write an unsigned long array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>ulong</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>ulong</span>.sizeof, Type.ULong<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a float array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>float</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>float</span>.sizeof, Type.Float<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a double array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>double</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>double</span>.sizeof, Type.Double<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a real array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>real</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> write <span class='opr'>(</span>x, length <span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>real</span>.sizeof, Type.Real<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a char array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span> 
        <span class='opr'>{</span>
                <span class='kw1'>return</span> encode <span class='opr'>(</span>x.ptr, length<span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>char</span>.sizeof, Type.Utf8<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a wchar array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>wchar</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span> 
        <span class='opr'>{</span>
                <span class='kw1'>return</span> encode <span class='opr'>(</span>x.ptr, length<span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>wchar</span>.sizeof, Type.Utf16<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write a dchar array to the current buffer-position
                
        ***********************************************************************/</span>

        IWriter put <span class='opr'>(</span><span class='kw4'>dchar</span><span class='opr'>[</span><span class='opr'>]</span> x<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> encode <span class='opr'>(</span>x.ptr, length<span class='opr'>(</span>x.length<span class='opr'>)</span> <span class='opr'>*</span> <span class='kw4'>dchar</span>.sizeof, Type.Utf32<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Dump content into the buffer. This is intercepted by a 
                variety of subclasses 

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> IWriter write <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> src, <span class='kw4'>uint</span> bytes, <span class='kw4'>int</span> type<span class='opr'>)</span>
        <span class='opr'>{</span>
                buffer.append <span class='opr'>(</span>src <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> bytes<span class='opr'>]</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Handle text output. This is intended to be intercepted
                by subclasses, though they should always pump content
                through here to take advantage of configured encoding

        ***********************************************************************/</span>

        <span class='kw4'>protected</span> IWriter encode <span class='opr'>(</span><span class='kw4'>void</span><span class='opr'>*</span> src, <span class='kw4'>uint</span> bytes, <span class='kw4'>int</span> type<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>textEncoder<span class='opr'>)</span>
                    textEncoder <span class='opr'>(</span>src, bytes, type<span class='opr'>)</span>;
                <span class='kw1'>else</span>
                   buffer.append <span class='opr'>(</span>src <span class='opr'>[</span><span class='nbr'>0</span> <span class='opr'>..</span> bytes<span class='opr'>]</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> <span class='kw2'>this</span>;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Emit the length of an array: used for raw binary output
                of arrays. Array lengths are written into the buffer as
                a guide for when reading it back again
                
        ***********************************************************************/</span>

        <span class='kw4'>private</span> <span class='kw4'>final</span> <span class='kw4'>uint</span> length <span class='opr'>(</span><span class='kw4'>uint</span> len<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>prefixArray<span class='opr'>)</span>
                    put <span class='opr'>(</span>len<span class='opr'>)</span>;
                <span class='kw1'>return</span> len;
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************

        A class to handle newline output. One might reasonably expect to 
        emit a char[] for newlines; FileConst.NewlineString for example.
        Turns out that it's much more efficient to intercept line-breaks
        when they're implemented in a more formal manner (such as this).

        For example, ColumnWriter() and TextWriter() both must intercept 
        newline output so they can adjust formatting appropriately. It is 
        much more efficient for such writers to intercept the IWritable 
        put() method instead of scanning each char[] for the various \\n 
        combinations.
        
        Please use the INewlineWriter interface for emitting newlines.

*******************************************************************************/</span>

<span class='kw4'>private</span> <span class='kw2'>import</span> tango.io.FileConst;

<span class='kw4'>class</span> NewlineWriter : INewlineWriter
<span class='opr'>{</span>
        <span class='kw4'>private</span> <span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span>  fmt;

        <span class='com'>/***********************************************************************

                Construct a default newline, using the char[] defined 
                by FileConst.NewlineString
        
        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>version</span> <span class='opr'>(</span>Posix<span class='opr'>)</span>
                         <span class='kw2'>this</span> <span class='opr'>(</span><span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span><span class='opr'>)</span> FileConst.NewlineString<span class='opr'>)</span>;
                <span class='kw1'>else</span>
                   <span class='kw2'>this</span> <span class='opr'>(</span>FileConst.NewlineString<span class='opr'>)</span>;                   
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Construct a newline using the provided character array

        ***********************************************************************/</span>

        <span class='kw2'>this</span> <span class='opr'>(</span><span class='kw4'>char</span><span class='opr'>[</span><span class='opr'>]</span> fmt<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span>.fmt <span class='opr'>=</span> fmt;
        <span class='opr'>}</span>

        <span class='com'>/***********************************************************************
        
                Write this newline through the provided writer. This makes
                NewlineWriter IWritable compatible.

        ***********************************************************************/</span>

        <span class='kw4'>void</span> write <span class='opr'>(</span>IWriter w<span class='opr'>)</span>
        <span class='opr'>{</span>
                w.put <span class='opr'>(</span>fmt<span class='opr'>)</span>;
        <span class='opr'>}</span>     
<span class='opr'>}</span>


<span class='com'>/*******************************************************************************

        public newline adaptor

*******************************************************************************/</span>

<span class='kw4'>public</span> <span class='kw4'>static</span> NewlineWriter CR;

<span class='kw4'>static</span> <span class='kw2'>this</span> <span class='opr'>(</span><span class='opr'>)</span>
<span class='opr'>{</span>
        CR <span class='opr'>=</span> <span class='kw2'>new</span> NewlineWriter;
<span class='opr'>}</span>

</pre></td></tr></table>	</body>
</html>
