<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
		<link rel="stylesheet" href="style.css" type="text/css" />
		<title>/HashSet.d</title>
	</head>
	<body>

<table id='dcode'><tr><td id='lnum'><pre><span>1</span>
<span>2</span>
<span>3</span>
<span>4</span>
<span>5</span>
<span>6</span>
<span>7</span>
<span>8</span>
<span>9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span>
<span>72</span>
<span>73</span>
<span>74</span>
<span>75</span>
<span>76</span>
<span>77</span>
<span>78</span>
<span>79</span>
<span>80</span>
<span>81</span>
<span>82</span>
<span>83</span>
<span>84</span>
<span>85</span>
<span>86</span>
<span>87</span>
<span>88</span>
<span>89</span>
<span>90</span>
<span>91</span>
<span>92</span>
<span>93</span>
<span>94</span>
<span>95</span>
<span>96</span>
<span>97</span>
<span>98</span>
<span>99</span>
<span>100</span>
<span>101</span>
<span>102</span>
<span>103</span>
<span>104</span>
<span>105</span>
<span>106</span>
<span>107</span>
<span>108</span>
<span>109</span>
<span>110</span>
<span>111</span>
<span>112</span>
<span>113</span>
<span>114</span>
<span>115</span>
<span>116</span>
<span>117</span>
<span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
<span>139</span>
<span>140</span>
<span>141</span>
<span>142</span>
<span>143</span>
<span>144</span>
<span>145</span>
<span>146</span>
<span>147</span>
<span>148</span>
<span>149</span>
<span>150</span>
<span>151</span>
<span>152</span>
<span>153</span>
<span>154</span>
<span>155</span>
<span>156</span>
<span>157</span>
<span>158</span>
<span>159</span>
<span>160</span>
<span>161</span>
<span>162</span>
<span>163</span>
<span>164</span>
<span>165</span>
<span>166</span>
<span>167</span>
<span>168</span>
<span>169</span>
<span>170</span>
<span>171</span>
<span>172</span>
<span>173</span>
<span>174</span>
<span>175</span>
<span>176</span>
<span>177</span>
<span>178</span>
<span>179</span>
<span>180</span>
<span>181</span>
<span>182</span>
<span>183</span>
<span>184</span>
<span>185</span>
<span>186</span>
<span>187</span>
<span>188</span>
<span>189</span>
<span>190</span>
<span>191</span>
<span>192</span>
<span>193</span>
<span>194</span>
<span>195</span>
<span>196</span>
<span>197</span>
<span>198</span>
<span>199</span>
<span>200</span>
<span>201</span>
<span>202</span>
<span>203</span>
<span>204</span>
<span>205</span>
<span>206</span>
<span>207</span>
<span>208</span>
<span>209</span>
<span>210</span>
<span>211</span>
<span>212</span>
<span>213</span>
<span>214</span>
<span>215</span>
<span>216</span>
<span>217</span>
<span>218</span>
<span>219</span>
<span>220</span>
<span>221</span>
<span>222</span>
<span>223</span>
<span>224</span>
<span>225</span>
<span>226</span>
<span>227</span>
<span>228</span>
<span>229</span>
<span>230</span>
<span>231</span>
<span>232</span>
<span>233</span>
<span>234</span>
<span>235</span>
<span>236</span>
<span>237</span>
<span>238</span>
<span>239</span>
<span>240</span>
<span>241</span>
<span>242</span>
<span>243</span>
<span>244</span>
<span>245</span>
<span>246</span>
<span>247</span>
<span>248</span>
<span>249</span>
<span>250</span>
<span>251</span>
<span>252</span>
<span>253</span>
<span>254</span>
<span>255</span>
<span>256</span>
<span>257</span>
<span>258</span>
<span>259</span>
<span>260</span>
<span>261</span>
<span>262</span>
<span>263</span>
<span>264</span>
<span>265</span>
<span>266</span>
<span>267</span>
<span>268</span>
<span>269</span>
<span>270</span>
<span>271</span>
<span>272</span>
<span>273</span>
<span>274</span>
<span>275</span>
<span>276</span>
<span>277</span>
<span>278</span>
<span>279</span>
<span>280</span>
<span>281</span>
<span>282</span>
<span>283</span>
<span>284</span>
<span>285</span>
<span>286</span>
<span>287</span>
<span>288</span>
<span>289</span>
<span>290</span>
<span>291</span>
<span>292</span>
<span>293</span>
<span>294</span>
<span>295</span>
<span>296</span>
<span>297</span>
<span>298</span>
<span>299</span>
<span>300</span>
<span>301</span>
<span>302</span>
<span>303</span>
<span>304</span>
<span>305</span>
<span>306</span>
<span>307</span>
<span>308</span>
<span>309</span>
<span>310</span>
<span>311</span>
<span>312</span>
<span>313</span>
<span>314</span>
<span>315</span>
<span>316</span>
<span>317</span>
<span>318</span>
<span>319</span>
<span>320</span>
<span>321</span>
<span>322</span>
<span>323</span>
<span>324</span>
<span>325</span>
<span>326</span>
<span>327</span>
<span>328</span>
<span>329</span>
<span>330</span>
<span>331</span>
<span>332</span>
<span>333</span>
<span>334</span>
<span>335</span>
<span>336</span>
<span>337</span>
<span>338</span>
<span>339</span>
<span>340</span>
<span>341</span>
<span>342</span>
<span>343</span>
<span>344</span>
<span>345</span>
<span>346</span>
<span>347</span>
<span>348</span>
<span>349</span>
<span>350</span>
<span>351</span>
<span>352</span>
<span>353</span>
<span>354</span>
<span>355</span>
<span>356</span>
<span>357</span>
<span>358</span>
<span>359</span>
<span>360</span>
<span>361</span>
<span>362</span>
<span>363</span>
<span>364</span>
<span>365</span>
<span>366</span>
<span>367</span>
<span>368</span>
<span>369</span>
<span>370</span>
<span>371</span>
<span>372</span>
<span>373</span>
<span>374</span>
<span>375</span>
<span>376</span>
<span>377</span>
<span>378</span>
<span>379</span>
<span>380</span>
<span>381</span>
<span>382</span>
<span>383</span>
<span>384</span>
<span>385</span>
<span>386</span>
<span>387</span>
<span>388</span>
<span>389</span>
<span>390</span>
<span>391</span>
<span>392</span>
<span>393</span>
<span>394</span>
<span>395</span>
<span>396</span>
<span>397</span>
<span>398</span>
<span>399</span>
<span>400</span>
<span>401</span>
<span>402</span>
<span>403</span>
<span>404</span>
<span>405</span>
<span>406</span>
<span>407</span>
<span>408</span>
<span>409</span>
<span>410</span>
<span>411</span>
<span>412</span>
<span>413</span>
<span>414</span>
<span>415</span>
<span>416</span>
<span>417</span>
<span>418</span>
<span>419</span>
<span>420</span>
<span>421</span>
<span>422</span>
<span>423</span>
<span>424</span>
<span>425</span>
<span>426</span>
<span>427</span>
<span>428</span>
<span>429</span>
<span>430</span>
<span>431</span>
<span>432</span>
<span>433</span>
<span>434</span>
<span>435</span>
<span>436</span>
<span>437</span>
<span>438</span>
<span>439</span>
<span>440</span>
<span>441</span>
<span>442</span>
<span>443</span>
<span>444</span>
<span>445</span>
<span>446</span>
<span>447</span>
<span>448</span>
<span>449</span>
<span>450</span>
<span>451</span>
<span>452</span>
<span>453</span>
<span>454</span>
<span>455</span>
<span>456</span>
<span>457</span>
<span>458</span>
<span>459</span>
<span>460</span>
<span>461</span>
<span>462</span>
<span>463</span>
<span>464</span>
<span>465</span>
<span>466</span>
<span>467</span>
<span>468</span>
<span>469</span>
<span>470</span>
<span>471</span>
<span>472</span>
<span>473</span>
<span>474</span>
<span>475</span>
<span>476</span>
<span>477</span>
<span>478</span>
<span>479</span>
<span>480</span>
<span>481</span>
<span>482</span>
<span>483</span>
<span>484</span>
<span>485</span>
<span>486</span>
<span>487</span>
<span>488</span>
<span>489</span>
<span>490</span>
<span>491</span>
<span>492</span>
<span>493</span>
<span>494</span>
<span>495</span>
<span>496</span>
<span>497</span>
<span>498</span>
<span>499</span>
<span>500</span>
<span>501</span>
<span>502</span>
<span>503</span>
<span>504</span>
<span>505</span>
<span>506</span>
<span>507</span>
<span>508</span>
<span>509</span>
<span>510</span>
<span>511</span>
<span>512</span>
<span>513</span>
<span>514</span>
<span>515</span>
<span>516</span>
<span>517</span>
<span>518</span>
<span>519</span>
<span>520</span>
<span>521</span>
<span>522</span>
<span>523</span>
<span>524</span>
<span>525</span>
<span>526</span>
<span>527</span>
<span>528</span>
<span>529</span>
<span>530</span>
<span>531</span>
<span>532</span>
<span>533</span>
<span>534</span>
<span>535</span>
<span>536</span>
<span>537</span>
<span>538</span>
<span>539</span>
<span>540</span>
</pre></td><td id='code'><pre><span class='com'>/*
 File: HashSet.d

 Originally written by Doug Lea and released into the public domain. 
 Thanks for the assistance and support of Sun Microsystems Labs, Agorics 
 Inc, Loral, and everyone contributing, testing, and using this code.

 History:
 Date     Who                What
 24Sep95  dl@cs.oswego.edu   Create from store.d  working file
 13Oct95  dl                 Changed protection statuses

*/</span>


<span class='kw2'>module</span> tango.store.HashSet;

<span class='kw4'>private</span> <span class='kw2'>import</span> tango.convert.Integer;

<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.Exception;

<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.impl.LLCell;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.iterator.AbstractIterator;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.impl.MutableSetImpl;

<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.Set;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.Predicate;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.Collection;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.Iterator;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.MutableSet;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.HashTableParams;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.MutableCollection;
<span class='kw4'>private</span> <span class='kw2'>import</span> tango.store.model.CollectionIterator;


<span class='com'>/**
 *
 * Hash table implementation of set
 * 
        author: Doug Lea
 * @version 0.93
 *
 * &lt;P&gt; For an introduction to this package see &lt;A HREF=&quot;index.html&quot;&gt; Overview &lt;/A&gt;.
**/</span>

<span class='kw4'>public</span> <span class='kw4'>class</span> HashSetT<span class='opr'>(</span>T<span class='opr'>)</span> : MutableSetImplT!<span class='opr'>(</span>T<span class='opr'>)</span>, HashTableParams
<span class='opr'>{</span>
        <span class='kw2'>alias</span> LLCellT!<span class='opr'>(</span>T<span class='opr'>)</span>               LLCell;
        <span class='kw2'>alias</span> PredicateT!<span class='opr'>(</span>T<span class='opr'>)</span>            Predicate;
        <span class='kw2'>alias</span> CollectionT!<span class='opr'>(</span>T<span class='opr'>)</span>           Collection;
        <span class='kw2'>alias</span> CollectionIteratorT!<span class='opr'>(</span>T<span class='opr'>)</span>   CollectionIterator;


        <span class='com'>// instance variables</span>

        <span class='com'>/**
         * The table. Each entry is a list. Null if no table allocated
        **/</span>
        <span class='kw4'>package</span> LLCell table_<span class='opr'>[</span><span class='opr'>]</span>;
        <span class='com'>/**
         * The threshold load factor
        **/</span>
        <span class='kw4'>protected</span> <span class='kw4'>float</span> loadFactor_;


        <span class='com'>// constructors</span>

        <span class='com'>/**
         * Make an empty HashedSet.
        **/</span>

        <span class='kw4'>public</span> <span class='kw2'>this</span> <span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span><span class='opr'>(</span><span class='kw2'>null</span>, defaultLoadFactor<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Make an empty HashedSet using given element screener
        **/</span>

        <span class='kw4'>public</span> <span class='kw2'>this</span> <span class='opr'>(</span>Predicate screener<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>this</span><span class='opr'>(</span>screener, defaultLoadFactor<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Special version of constructor needed by clone()
        **/</span>

        <span class='kw4'>protected</span> <span class='kw2'>this</span> <span class='opr'>(</span>Predicate s, <span class='kw4'>float</span> f<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span><span class='opr'>(</span>s<span class='opr'>)</span>;
                table_ <span class='opr'>=</span> <span class='kw2'>null</span>;
                loadFactor_ <span class='opr'>=</span> f;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Make an independent copy of the table. Does not clone elements.
        **/</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> Collection duplicate<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>auto</span> c <span class='opr'>=</span> <span class='kw2'>new</span> HashSetT <span class='opr'>(</span>screener_, loadFactor_<span class='opr'>)</span>;

                <span class='kw1'>if</span> <span class='opr'>(</span>count_ !<span class='kw2'>is</span> <span class='nbr'>0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw4'>int</span> cap <span class='opr'>=</span> <span class='nbr'>2</span> <span class='opr'>*</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span><span class='opr'>(</span>count_ / loadFactor_<span class='opr'>)</span> <span class='opr'>+</span> <span class='nbr'>1</span>;
                   <span class='kw1'>if</span> <span class='opr'>(</span>cap <span class='opr'>&lt;</span> defaultInitialBuckets<span class='opr'>)</span>
                       cap <span class='opr'>=</span> defaultInitialBuckets;

                   c.buckets<span class='opr'>(</span>cap<span class='opr'>)</span>;
                   <span class='kw1'>for</span> <span class='opr'>(</span><span class='kw4'>int</span> i <span class='opr'>=</span> <span class='nbr'>0</span>; i <span class='opr'>&lt;</span> table_.length; <span class='opr'>+</span><span class='opr'>+</span>i<span class='opr'>)</span>
                        <span class='kw1'>for</span> <span class='opr'>(</span>LLCell p <span class='opr'>=</span> table_<span class='opr'>[</span>i<span class='opr'>]</span>; p !<span class='kw2'>is</span> <span class='kw2'>null</span>; p <span class='opr'>=</span> p.next<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>
                             c.include<span class='opr'>(</span>p.element<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>;
                   <span class='opr'>}</span>
                <span class='kw1'>return</span> c;
        <span class='opr'>}</span>


        <span class='com'>// HashTableParams methods</span>

        <span class='com'>/**
         * Implements store.HashTableParams.buckets.
         * Time complexity: O(1).
         * @see store.HashTableParams#buckets.
        **/</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>int</span> buckets<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='opr'>(</span>table_ <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span> ? <span class='nbr'>0</span> : table_.length;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Implements store.HashTableParams.buckets.
         * Time complexity: O(n).
         * @see store.HashTableParams#buckets.
        **/</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> buckets<span class='opr'>(</span><span class='kw4'>int</span> newCap<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>newCap <span class='kw2'>is</span> buckets<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> ;
                <span class='kw1'>else</span>
                   <span class='kw1'>if</span> <span class='opr'>(</span>newCap <span class='opr'>&gt;</span><span class='opr'>=</span> <span class='nbr'>1</span><span class='opr'>)</span>
                       resize<span class='opr'>(</span>newCap<span class='opr'>)</span>;
                   <span class='kw1'>else</span>
                      <span class='opr'>{</span>
                      <span class='kw4'>char</span><span class='opr'>[</span><span class='nbr'>16</span><span class='opr'>]</span> tmp;
                      <span class='kw2'>throw</span> <span class='kw2'>new</span> IllegalArgumentException<span class='opr'>(</span><span class='str'>&quot;Impossible Hash table size:&quot;</span> <span class='opr'>~</span> Integer.format<span class='opr'>(</span>tmp, newCap<span class='opr'>)</span><span class='opr'>)</span>;
                      <span class='opr'>}</span>
        <span class='opr'>}</span>

        <span class='com'>/**
         * Implements store.HashTableParams.thresholdLoadfactor
         * Time complexity: O(1).
         * @see store.HashTableParams#thresholdLoadfactor
        **/</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>float</span> thresholdLoadFactor<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> loadFactor_;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Implements store.HashTableParams.thresholdLoadfactor
         * Time complexity: O(n).
         * @see store.HashTableParams#thresholdLoadfactor
        **/</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> thresholdLoadFactor<span class='opr'>(</span><span class='kw4'>float</span> desired<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>desired <span class='opr'>&gt;</span> <span class='nbr'>0.0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   loadFactor_ <span class='opr'>=</span> desired;
                   checkLoadFactor<span class='opr'>(</span><span class='opr'>)</span>;
                   <span class='opr'>}</span>
                <span class='kw1'>else</span>
                   <span class='kw2'>throw</span> <span class='kw2'>new</span> IllegalArgumentException<span class='opr'>(</span><span class='str'>&quot;Invalid Hash table load factor&quot;</span><span class='opr'>)</span>;
        <span class='opr'>}</span>





        <span class='com'>// Collection methods</span>

        <span class='com'>/**
         * Implements store.Collection.contains.
         * Time complexity: O(1) average; O(n) worst.
         * @see store.Collection#contains
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>bool</span> contains<span class='opr'>(</span>T element<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>!isValidArg<span class='opr'>(</span>element<span class='opr'>)</span> || count_ <span class='kw2'>is</span> <span class='nbr'>0</span><span class='opr'>)</span>
                     <span class='kw1'>return</span> <span class='kw2'>false</span>;

                LLCell p <span class='opr'>=</span> table_<span class='opr'>[</span>hashOf<span class='opr'>(</span>element<span class='opr'>)</span><span class='opr'>]</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>p !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> p.find<span class='opr'>(</span>element<span class='opr'>)</span> !<span class='kw2'>is</span> <span class='kw2'>null</span>;
                <span class='kw1'>else</span>
                   <span class='kw1'>return</span> <span class='kw2'>false</span>;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Implements store.Collection.instances.
         * Time complexity: O(n).
         * @see store.Collection#instances
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>int</span> instances<span class='opr'>(</span>T element<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>contains<span class='opr'>(</span>element<span class='opr'>)</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> <span class='nbr'>1</span>;
                <span class='kw1'>else</span>
                   <span class='kw1'>return</span> <span class='nbr'>0</span>;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Implements store.Collection.elements.
         * Time complexity: O(1).
         * @see store.Collection#elements
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>final</span> CollectionIterator elements<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='kw2'>new</span> CellIterator!<span class='opr'>(</span>T<span class='opr'>)</span><span class='opr'>(</span><span class='kw2'>this</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>// MutableCollection methods</span>

        <span class='com'>/**
         * Implements store.MutableCollection.clear.
         * Time complexity: O(1).
         * @see store.MutableCollection#clear
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> clear<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                setCount<span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                table_ <span class='opr'>=</span> <span class='kw2'>null</span>;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Implements store.MutableCollection.exclude.
         * Time complexity: O(1) average; O(n) worst.
         * @see store.MutableCollection#exclude
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> exclude<span class='opr'>(</span>T element<span class='opr'>)</span>
        <span class='opr'>{</span>
                removeOneOf<span class='opr'>(</span>element<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> removeOneOf<span class='opr'>(</span>T element<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>!isValidArg<span class='opr'>(</span>element<span class='opr'>)</span> || count_ <span class='kw2'>is</span> <span class='nbr'>0</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> ;

                <span class='kw4'>int</span> h <span class='opr'>=</span> hashOf<span class='opr'>(</span>element<span class='opr'>)</span>;
                LLCell hd <span class='opr'>=</span> table_<span class='opr'>[</span>h<span class='opr'>]</span>;
                LLCell p <span class='opr'>=</span> hd;
                LLCell trail <span class='opr'>=</span> p;

                <span class='kw1'>while</span> <span class='opr'>(</span>p !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                      <span class='opr'>{</span>
                      LLCell n <span class='opr'>=</span> p.next<span class='opr'>(</span><span class='opr'>)</span>;
                      <span class='kw1'>if</span> <span class='opr'>(</span>p.element<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>=</span><span class='opr'>=</span> <span class='opr'>(</span>element<span class='opr'>)</span><span class='opr'>)</span>
                         <span class='opr'>{</span>
                         decCount<span class='opr'>(</span><span class='opr'>)</span>;
                         <span class='kw1'>if</span> <span class='opr'>(</span>p <span class='kw2'>is</span> table_<span class='opr'>[</span>h<span class='opr'>]</span><span class='opr'>)</span>
                            <span class='opr'>{</span>
                            table_<span class='opr'>[</span>h<span class='opr'>]</span> <span class='opr'>=</span> n;
                            trail <span class='opr'>=</span> n;
                            <span class='opr'>}</span>
                         <span class='kw1'>else</span>
                            trail.next<span class='opr'>(</span>n<span class='opr'>)</span>;
                         <span class='kw1'>return</span> ;
                         <span class='opr'>}</span> 
                      <span class='kw1'>else</span>
                         <span class='opr'>{</span>
                         trail <span class='opr'>=</span> p;
                         p <span class='opr'>=</span> n;
                         <span class='opr'>}</span>
                      <span class='opr'>}</span>
        <span class='opr'>}</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> replaceOneOf<span class='opr'>(</span>T oldElement, T newElement<span class='opr'>)</span>
        <span class='opr'>{</span>

                <span class='kw1'>if</span> <span class='opr'>(</span>count_ <span class='kw2'>is</span> <span class='nbr'>0</span> || !isValidArg<span class='opr'>(</span>oldElement<span class='opr'>)</span> || oldElement <span class='opr'>=</span><span class='opr'>=</span> <span class='opr'>(</span>newElement<span class='opr'>)</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> ;

                <span class='kw1'>if</span> <span class='opr'>(</span>contains<span class='opr'>(</span>oldElement<span class='opr'>)</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   checkElement<span class='opr'>(</span>newElement<span class='opr'>)</span>;
                   exclude<span class='opr'>(</span>oldElement<span class='opr'>)</span>;
                   include<span class='opr'>(</span>newElement<span class='opr'>)</span>;
                   <span class='opr'>}</span>
        <span class='opr'>}</span>

        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> replaceAllOf<span class='opr'>(</span>T oldElement, T newElement<span class='opr'>)</span>
        <span class='opr'>{</span>
                replaceOneOf<span class='opr'>(</span>oldElement, newElement<span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/**
         * Implements store.MutableCollection.take.
         * Time complexity: O(number of buckets).
         * @see store.MutableCollection#take
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>final</span> T take<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>count_ !<span class='kw2'>is</span> <span class='nbr'>0</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw1'>for</span> <span class='opr'>(</span><span class='kw4'>int</span> i <span class='opr'>=</span> <span class='nbr'>0</span>; i <span class='opr'>&lt;</span> table_.length; <span class='opr'>+</span><span class='opr'>+</span>i<span class='opr'>)</span>
                       <span class='opr'>{</span>
                       <span class='kw1'>if</span> <span class='opr'>(</span>table_<span class='opr'>[</span>i<span class='opr'>]</span> !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                          <span class='opr'>{</span>
                          decCount<span class='opr'>(</span><span class='opr'>)</span>;
                          <span class='kw4'>auto</span> v <span class='opr'>=</span> table_<span class='opr'>[</span>i<span class='opr'>]</span>.element<span class='opr'>(</span><span class='opr'>)</span>;
                          table_<span class='opr'>[</span>i<span class='opr'>]</span> <span class='opr'>=</span> table_<span class='opr'>[</span>i<span class='opr'>]</span>.next<span class='opr'>(</span><span class='opr'>)</span>;
                          <span class='kw1'>return</span> v;
                          <span class='opr'>}</span>
                       <span class='opr'>}</span>
                   <span class='opr'>}</span>

                checkIndex<span class='opr'>(</span><span class='nbr'>0</span><span class='opr'>)</span>;
                <span class='kw1'>return</span> T.init; <span class='com'>// not reached</span>
        <span class='opr'>}</span>


        <span class='com'>// MutableSet methods</span>

        <span class='com'>/**
         * Implements store.MutableSet.include.
         * Time complexity: O(1) average; O(n) worst.
         * @see store.MutableSet#include
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>void</span> include<span class='opr'>(</span>T element<span class='opr'>)</span>
        <span class='opr'>{</span>
                checkElement<span class='opr'>(</span>element<span class='opr'>)</span>;

                <span class='kw1'>if</span> <span class='opr'>(</span>table_ <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                    resize<span class='opr'>(</span>defaultInitialBuckets<span class='opr'>)</span>;

                <span class='kw4'>int</span> h <span class='opr'>=</span> hashOf<span class='opr'>(</span>element<span class='opr'>)</span>;
                LLCell hd <span class='opr'>=</span> table_<span class='opr'>[</span>h<span class='opr'>]</span>;
                <span class='kw1'>if</span> <span class='opr'>(</span>hd !<span class='kw2'>is</span> <span class='kw2'>null</span> &amp;&amp; hd.find<span class='opr'>(</span>element<span class='opr'>)</span> !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                    <span class='kw1'>return</span> ;

                LLCell n <span class='opr'>=</span> <span class='kw2'>new</span> LLCell<span class='opr'>(</span>element, hd<span class='opr'>)</span>;
                table_<span class='opr'>[</span>h<span class='opr'>]</span> <span class='opr'>=</span> n;
                incCount<span class='opr'>(</span><span class='opr'>)</span>;

                <span class='kw1'>if</span> <span class='opr'>(</span>hd !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                    checkLoadFactor<span class='opr'>(</span><span class='opr'>)</span>; <span class='com'>// only check if bin was nonempty</span>
        <span class='opr'>}</span>



        <span class='com'>// Helper methods</span>

        <span class='com'>/**
         * Check to see if we are past load factor threshold. If so, resize
         * so that we are at half of the desired threshold.
         * Also while at it, check to see if we are empty so can just
         * unlink table.
        **/</span>
        <span class='kw4'>protected</span> <span class='kw4'>final</span> <span class='kw4'>void</span> checkLoadFactor<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>if</span> <span class='opr'>(</span>table_ <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw1'>if</span> <span class='opr'>(</span>count_ !<span class='kw2'>is</span> <span class='nbr'>0</span><span class='opr'>)</span>
                       resize<span class='opr'>(</span>defaultInitialBuckets<span class='opr'>)</span>;
                   <span class='opr'>}</span>
                <span class='kw1'>else</span>
                   <span class='opr'>{</span>
                   <span class='kw4'>float</span> fc <span class='opr'>=</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>float</span><span class='opr'>)</span> <span class='opr'>(</span>count_<span class='opr'>)</span>;
                   <span class='kw4'>float</span> ft <span class='opr'>=</span> table_.length;
                   <span class='kw1'>if</span> <span class='opr'>(</span>fc / ft <span class='opr'>&gt;</span> loadFactor_<span class='opr'>)</span>
                      <span class='opr'>{</span>
                      <span class='kw4'>int</span> newCap <span class='opr'>=</span> <span class='nbr'>2</span> <span class='opr'>*</span> <span class='kw2'>cast</span><span class='opr'>(</span><span class='kw4'>int</span><span class='opr'>)</span><span class='opr'>(</span>fc / loadFactor_<span class='opr'>)</span> <span class='opr'>+</span> <span class='nbr'>1</span>;
                      resize<span class='opr'>(</span>newCap<span class='opr'>)</span>;
                      <span class='opr'>}</span>
                   <span class='opr'>}</span>
        <span class='opr'>}</span>

        <span class='com'>/**
         * Mask off and remainder the hashCode for element
         * so it can be used as table index
        **/</span>

        <span class='kw4'>protected</span> <span class='kw4'>final</span> <span class='kw4'>int</span> hashOf<span class='opr'>(</span>T element<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw1'>return</span> <span class='opr'>(</span><span class='kw2'>typeid</span><span class='opr'>(</span>T<span class='opr'>)</span>.getHash<span class='opr'>(</span><span class='opr'>&amp;</span>element<span class='opr'>)</span> <span class='opr'>&amp;</span> <span class='nbr'>0</span>x7FFFFFFF<span class='opr'>)</span> <span class='opr'>%</span> table_.length;
        <span class='opr'>}</span>


        <span class='com'>/**
         * resize table to new capacity, rehashing all elements
        **/</span>
        <span class='kw4'>protected</span> <span class='kw4'>final</span> <span class='kw4'>void</span> resize<span class='opr'>(</span><span class='kw4'>int</span> newCap<span class='opr'>)</span>
        <span class='opr'>{</span>
                LLCell newtab<span class='opr'>[</span><span class='opr'>]</span> <span class='opr'>=</span> <span class='kw2'>new</span> LLCell<span class='opr'>[</span>newCap<span class='opr'>]</span>;

                <span class='kw1'>if</span> <span class='opr'>(</span>table_ !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw1'>for</span> <span class='opr'>(</span><span class='kw4'>int</span> i <span class='opr'>=</span> <span class='nbr'>0</span>; i <span class='opr'>&lt;</span> table_.length; <span class='opr'>+</span><span class='opr'>+</span>i<span class='opr'>)</span>
                       <span class='opr'>{</span>
                       LLCell p <span class='opr'>=</span> table_<span class='opr'>[</span>i<span class='opr'>]</span>;
                       <span class='kw1'>while</span> <span class='opr'>(</span>p !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                             <span class='opr'>{</span>
                             LLCell n <span class='opr'>=</span> p.next<span class='opr'>(</span><span class='opr'>)</span>;
                             <span class='kw4'>int</span> h <span class='opr'>=</span> <span class='opr'>(</span>p.elementHash<span class='opr'>(</span><span class='opr'>)</span> <span class='opr'>&amp;</span> <span class='nbr'>0</span>x7FFFFFFF<span class='opr'>)</span> <span class='opr'>%</span> newCap;
                             p.next<span class='opr'>(</span>newtab<span class='opr'>[</span>h<span class='opr'>]</span><span class='opr'>)</span>;
                             newtab<span class='opr'>[</span>h<span class='opr'>]</span> <span class='opr'>=</span> p;
                             p <span class='opr'>=</span> n;
                             <span class='opr'>}</span>
                       <span class='opr'>}</span>
                   <span class='opr'>}</span>

                table_ <span class='opr'>=</span> newtab;
                incVersion<span class='opr'>(</span><span class='opr'>)</span>;
        <span class='opr'>}</span>

        <span class='com'>/+
        private final void readObject(java.io.ObjectInputStream stream)

        {
                int len = stream.readInt();

                if (len &gt; 0)
                    table_ = new LLCell[len];
                else
                   table_ = null;

                loadFactor_ = stream.readFloat();
                int count = stream.readInt();

                while (count-- &gt; 0)
                      {
                      T element = stream.readObject();
                      int h = hashOf(element);
                      LLCell hd = table_[h];
                      LLCell n = new LLCell(element, hd);
                      table_[h] = n;
                      }
        }

        private final void writeObject(java.io.ObjectOutputStream stream)
        {
                int len;

                if (table_ !is null)
                    len = table_.length;
                else
                   len = 0;

                stream.writeInt(len);
                stream.writeFloat(loadFactor_);
                stream.writeInt(count_);

                if (len &gt; 0)
                   {
                   Iterator e = elements();
                   while (e.more())
                          stream.writeObject(e.value());
                   }
        }

        +/</span>

        <span class='com'>// ImplementationCheckable methods</span>

        <span class='com'>/**
         * Implements store.ImplementationCheckable.checkImplementation.
         * @see store.ImplementationCheckable#checkImplementation
        **/</span>
        <span class='kw4'>public</span> <span class='kw4'>override</span> <span class='kw4'>void</span> checkImplementation<span class='opr'>(</span><span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw2'>super</span>.checkImplementation<span class='opr'>(</span><span class='opr'>)</span>;

                <span class='kw2'>assert</span><span class='opr'>(</span>!<span class='opr'>(</span>table_ <span class='kw2'>is</span> <span class='kw2'>null</span> &amp;&amp; count_ !<span class='kw2'>is</span> <span class='nbr'>0</span><span class='opr'>)</span><span class='opr'>)</span>;
                <span class='kw2'>assert</span><span class='opr'>(</span><span class='opr'>(</span>table_ <span class='kw2'>is</span> <span class='kw2'>null</span> || table_.length <span class='opr'>&gt;</span> <span class='nbr'>0</span><span class='opr'>)</span><span class='opr'>)</span>;
                <span class='kw2'>assert</span><span class='opr'>(</span>loadFactor_ <span class='opr'>&gt;</span> <span class='nbr'>0.0f</span><span class='opr'>)</span>;

                <span class='kw1'>if</span> <span class='opr'>(</span>table_ !<span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                   <span class='opr'>{</span>
                   <span class='kw4'>int</span> c <span class='opr'>=</span> <span class='nbr'>0</span>;
                   <span class='kw1'>for</span> <span class='opr'>(</span><span class='kw4'>int</span> i <span class='opr'>=</span> <span class='nbr'>0</span>; i <span class='opr'>&lt;</span> table_.length; <span class='opr'>+</span><span class='opr'>+</span>i<span class='opr'>)</span>
                       <span class='opr'>{</span>
                       <span class='kw1'>for</span> <span class='opr'>(</span>LLCell p <span class='opr'>=</span> table_<span class='opr'>[</span>i<span class='opr'>]</span>; p !<span class='kw2'>is</span> <span class='kw2'>null</span>; p <span class='opr'>=</span> p.next<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span>
                           <span class='opr'>{</span>
                           <span class='opr'>+</span><span class='opr'>+</span>c;
                           <span class='kw2'>assert</span><span class='opr'>(</span>canInclude<span class='opr'>(</span>p.element<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span><span class='opr'>)</span>;
                           <span class='kw2'>assert</span><span class='opr'>(</span>contains<span class='opr'>(</span>p.element<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span><span class='opr'>)</span>;
                           <span class='kw2'>assert</span><span class='opr'>(</span>instances<span class='opr'>(</span>p.element<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span> <span class='kw2'>is</span> <span class='nbr'>1</span><span class='opr'>)</span>;
                           <span class='kw2'>assert</span><span class='opr'>(</span>hashOf<span class='opr'>(</span>p.element<span class='opr'>(</span><span class='opr'>)</span><span class='opr'>)</span> <span class='kw2'>is</span> i<span class='opr'>)</span>;
                           <span class='opr'>}</span>
                       <span class='opr'>}</span>
                   <span class='kw2'>assert</span><span class='opr'>(</span>c <span class='kw2'>is</span> count_<span class='opr'>)</span>;
                   <span class='opr'>}</span>
        <span class='opr'>}</span>



        <span class='kw4'>private</span> <span class='kw4'>static</span> <span class='kw4'>class</span> CellIterator<span class='opr'>(</span>T<span class='opr'>)</span> : AbstractIteratorT!<span class='opr'>(</span>T<span class='opr'>)</span>
        <span class='opr'>{</span>
                <span class='kw4'>private</span> <span class='kw4'>int</span>             row;
                <span class='kw4'>private</span> LLCell          cell;
                <span class='kw4'>private</span> LLCell<span class='opr'>[</span><span class='opr'>]</span>        table;

                <span class='kw4'>public</span> <span class='kw2'>this</span> <span class='opr'>(</span>HashSetT set<span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw2'>super</span> <span class='opr'>(</span>set<span class='opr'>)</span>;
                        table <span class='opr'>=</span> set.table_;
                <span class='opr'>}</span>

                <span class='kw4'>public</span> <span class='kw4'>final</span> <span class='kw4'>bool</span> more<span class='opr'>(</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>if</span> <span class='opr'>(</span>remaining_<span class='opr'>)</span>
                           <span class='opr'>{</span>
                           <span class='kw1'>if</span> <span class='opr'>(</span>cell<span class='opr'>)</span>
                               cell <span class='opr'>=</span> cell.next<span class='opr'>(</span><span class='opr'>)</span>;

                           <span class='kw1'>while</span> <span class='opr'>(</span>cell <span class='kw2'>is</span> <span class='kw2'>null</span><span class='opr'>)</span>
                                  cell <span class='opr'>=</span> table <span class='opr'>[</span>row<span class='opr'>+</span><span class='opr'>+</span><span class='opr'>]</span>;

                           decRemaining<span class='opr'>(</span><span class='opr'>)</span>;
                           <span class='kw1'>return</span> <span class='kw2'>true</span>;
                           <span class='opr'>}</span>

                        <span class='kw1'>return</span> <span class='kw2'>false</span>;
                <span class='opr'>}</span>

                <span class='kw4'>public</span> <span class='kw4'>final</span> T value<span class='opr'>(</span><span class='opr'>)</span>
                <span class='opr'>{</span>
                        <span class='kw1'>return</span> cell.element<span class='opr'>(</span><span class='opr'>)</span>;
                <span class='opr'>}</span>
        <span class='opr'>}</span>
<span class='opr'>}</span>


<span class='kw2'>alias</span> HashSetT!<span class='opr'>(</span><span class='kw3'>Object</span><span class='opr'>)</span> HashSet;
</pre></td></tr></table>	</body>
</html>
