<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>tango.net.device.SSLSocket</title>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  <!-- no favicon -->
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/utilities.js"></script>
  <script type="text/javascript" src="js/symbols.js"></script>
  <script type="text/javascript" src="js/modules.js"></script>
  <script type="text/javascript" src="js/quicksearch.js"></script>
  <script type="text/javascript" src="js/treeview.js"></script>
  <script type="text/javascript" src="js/navigation.js"></script>
</head>
<body id="tango.net.device.SSLSocket">
<div id="kandil-content">
<div class="module">
  <h1 class="module" id="m-tango.net.device.SSLSocket"><a href="htmlsrc/tango.net.device.SSLSocket.html" class="symbol">tango.net.device.SSLSocket</a></h1>

<p class="sec_header">License:</p><div class="cmnt">BSD style: see <a href="http://www.dsource.org/projects/tango/wiki/LibraryLicense">license.txt</a></div>
<p class="sec_header">Author:</p><div class="cmnt">Jeff Davey <j@submersion.com></div>
<dl>
<dt class="decl"><span class="kw">class</span> <a class="symbol _class" name="SSLSocket" href="htmlsrc/tango.net.device.SSLSocket.html#L55">SSLSocket</a> : <span class="bclass">Socket</span> <a href="tango.net.device.SSLSocket.html#SSLSocket" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">SSLSocket is a sub-class of Socket. It's purpose is to
    provide SSL encryption at the socket level as well as easily fit into
    existing Tango network applications that may already be using Socket.</div></div>
<div class="cmnt">SSLSocket requires the OpenSSL library, and uses a dynamic binding
    to the library. You can find the library at http://www.openssl.org and a
    Win32 specific port at http://www.slproweb.com/products/Win32OpenSSL.html.
<p class="bl"></p>
    SSLSockets have two modes:
<p class="bl"></p>
    1. Client mode, useful for connecting to existing servers, but not
    accepting new connections. Accepting a new connection will cause
    the library to stall on a write on connection.
<p class="bl"></p>
    2. Server mode, useful for creating an SSL server, but not connecting
    to an existing server. Connection will cause the library to stall on a
    read on connection.
<p class="bl"></p>
    Example SSL client
    <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex1" name="L1_ex1">1</a>
<a href="#L2_ex1" name="L2_ex1">2</a>
<a href="#L3_ex1" name="L3_ex1">3</a>
<a href="#L4_ex1" name="L4_ex1">4</a>
<a href="#L5_ex1" name="L5_ex1">5</a>
<a href="#L6_ex1" name="L6_ex1">6</a>
<a href="#L7_ex1" name="L7_ex1">7</a>
<a href="#L8_ex1" name="L8_ex1">8</a>
<a href="#L9_ex1" name="L9_ex1">9</a>
<a href="#L10_ex1" name="L10_ex1">10</a>
</pre></td><td class="d_codetext"><pre>
<span class="k">auto</span> <span class="i">s</span> = <span class="k">new</span> <span class="i">SSLSocket</span>;
<span class="k">if</span> (<span class="i">s</span>.<span class="i">connect</span>(<span class="sl">"www.yahoo.com"</span>, <span class="n">443</span>))
{
    <span class="k">char</span>[<span class="n">1024</span>] <span class="i">buff</span>;

    <span class="i">s</span>.<span class="i">write</span>(<span class="sl">"GET / HTTP/1.0<span class="es">\r</span><span class="es">\n</span><span class="es">\r</span><span class="es">\n</span>"</span>);
    <span class="k">auto</span> <span class="i">bytesRead</span> = <span class="i">s</span>.<span class="i">read</span>(<span class="i">buff</span>);
    <span class="k">if</span> (<span class="i">bytesRead</span> != <span class="i">s</span>.<span class="i">Eof</span>)
        <span class="i">Stdout</span>.<span class="i">formatln</span>(<span class="sl">"received: {}"</span>, <span class="i">buff</span>[<span class="n">0</span>..<span class="i">bytesRead</span>]);
}</pre>
</td></tr>
</table></div>
<dl>
<dt class="decl"><a class="symbol _ctor" name="SSLSocket.this" href="htmlsrc/tango.net.device.SSLSocket.html#L70">this</a><span class="params">(bool <em>config</em> = <span class="defval"><span class="k">true</span></span>)</span> <a href="tango.net.device.SSLSocket.html#SSLSocket.this" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Create a default Client Mode SSLSocket.</div></div></dd>
<dt class="decl"><span class="rettyp">void</span> <a class="symbol _function" name="SSLSocket.detach" href="htmlsrc/tango.net.device.SSLSocket.html#L148">detach</a><span class="params">()</span> <span class="attrs">[<span class="stc">override</span>]</span> <a href="tango.net.device.SSLSocket.html#SSLSocket.detach" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Release this SSLSocket.</div></div>
<div class="cmnt">As per Socket.detach.</div></dd>
<dt class="decl"><span class="rettyp">size_t</span> <a class="symbol _function" name="SSLSocket.write" href="htmlsrc/tango.net.device.SSLSocket.html#L168">write</a><span class="params">(const(void)[] <em>src</em>)</span> <span class="attrs">[<span class="stc">override</span>]</span> <a href="tango.net.device.SSLSocket.html#SSLSocket.write" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Writes the passed buffer to the underlying socket stream. This will
        block until socket error.</div></div>
<div class="cmnt">As per Socket.write</div></dd>
<dt class="decl"><span class="rettyp">size_t</span> <a class="symbol _function" name="SSLSocket.read" href="htmlsrc/tango.net.device.SSLSocket.html#L189">read</a><span class="params">(void[] <em>dst</em>)</span> <span class="attrs">[<span class="stc">override</span>]</span> <a href="tango.net.device.SSLSocket.html#SSLSocket.read" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Reads from the underlying socket stream. If needed, setTimeout will
        set the max length of time the read will take before returning.</div></div>
<div class="cmnt">As per Socket.read</div></dd>
<dt class="decl"><span class="rettyp">SSLSocket</span> <a class="symbol _function" name="SSLSocket.shutdown" href="htmlsrc/tango.net.device.SSLSocket.html#L266">shutdown</a><span class="params">()</span> <span class="attrs">[<span class="stc">override</span>]</span> <a href="tango.net.device.SSLSocket.html#SSLSocket.shutdown" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Shuts down the underlying socket for reading and writing.</div></div>
<div class="cmnt">As per Socket.shutdown</div></dd>
<dt class="decl"><span class="rettyp">void</span> <a class="symbol _function" name="SSLSocket.setCtx" href="htmlsrc/tango.net.device.SSLSocket.html#L291">setCtx</a><span class="params">(SSLCtx <em>ctx</em>, bool <em>clientMode</em> = <span class="defval"><span class="k">true</span></span>)</span> <a href="tango.net.device.SSLSocket.html#SSLSocket.setCtx" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Used in conjuction with the above ctor with the create flag disabled. It is
        useful for accepting a new socket into a SSLSocket, and then re-using
        the Server's existing SSLCtx.</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>ctx</em></td><td>SSLCtx class as provided by PKI</td></tr>
<tr><td><em>clientMode</em></td><td>if true, the socket will be in Client Mode, Server otherwise.</td></tr></table></dd></dl></dd>
<dt class="decl"><span class="kw">class</span> <a class="symbol _class" name="SSLServerSocket" href="htmlsrc/tango.net.device.SSLSocket.html#L350">SSLServerSocket</a> : <span class="bclass">ServerSocket</span> <a href="tango.net.device.SSLSocket.html#SSLServerSocket" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">SSLServerSocket is a sub-class of ServerSocket. It's purpose is to provide
    SSL encryption at the socket level as well as easily tie into existing
    Tango applications that may already be using ServerSocket.</div></div>
<div class="cmnt">SSLServerSocket requires the OpenSSL library, and uses a dynamic binding
    to the library. You can find the library at http://www.openssl.org and a
    Win32 specific port at http://www.slproweb.com/products/Win32OpenSSL.html.
<p class="bl"></p>
    Example SSL server
    <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex2" name="L1_ex2">1</a>
<a href="#L2_ex2" name="L2_ex2">2</a>
<a href="#L3_ex2" name="L3_ex2">3</a>
<a href="#L4_ex2" name="L4_ex2">4</a>
<a href="#L5_ex2" name="L5_ex2">5</a>
<a href="#L6_ex2" name="L6_ex2">6</a>
<a href="#L7_ex2" name="L7_ex2">7</a>
<a href="#L8_ex2" name="L8_ex2">8</a>
<a href="#L9_ex2" name="L9_ex2">9</a>
<a href="#L10_ex2" name="L10_ex2">10</a>
<a href="#L11_ex2" name="L11_ex2">11</a>
</pre></td><td class="d_codetext"><pre>
<span class="k">auto</span> <span class="i">cert</span> = <span class="k">new</span> <span class="i">Certificate</span>(<span class="k">cast</span>(<span class="k">char</span>[])<span class="i">File</span>.<span class="i">get</span>(<span class="sl">"public.pem"</span>));
<span class="k">auto</span> <span class="i">pkey</span> = <span class="k">new</span> <span class="i">PrivateKey</span>(<span class="k">cast</span>(<span class="k">char</span>[])<span class="i">File</span>.<span class="i">get</span>(<span class="sl">"private.pem"</span>));
<span class="k">auto</span> <span class="i">ctx</span> = <span class="k">new</span> <span class="i">SSLCtx</span>;
<span class="i">ctx</span>.<span class="i">certificate</span>(<span class="i">cert</span>).<span class="i">privateKey</span>(<span class="i">pkey</span>);
<span class="k">auto</span> <span class="i">server</span> = <span class="k">new</span> <span class="i">SSLServerSocket</span>(<span class="n">443</span>, <span class="i">ctx</span>);
<span class="k">for</span>(;;)
{
    <span class="k">auto</span> <span class="i">sc</span> = <span class="i">server</span>.<span class="i">accept</span>;
    <span class="i">sc</span>.<span class="i">write</span>(<span class="sl">"HTTP/1.1 200<span class="es">\r</span><span class="es">\n</span><span class="es">\r</span><span class="es">\n</span>&lt;b&gt;Hello World&lt;/b&gt;"</span>);
    <span class="i">sc</span>.<span class="i">shutdown</span>.<span class="i">close</span>;
}</pre>
</td></tr>
</table></div>
<dl>
<dt class="decl"><a class="symbol _ctor" name="SSLServerSocket.this" href="htmlsrc/tango.net.device.SSLSocket.html#L358">this</a><span class="params">(ushort <em>port</em>, SSLCtx <em>ctx</em>, int <em>backlog</em> = <span class="defval"><span class="n">32</span></span>, bool <em>reuse</em> = <span class="defval"><span class="k">false</span></span>)</span> <a href="tango.net.device.SSLSocket.html#SSLServerSocket.this" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt"></div></div></dd>
<dt class="decl"><a class="symbol _ctor" name="SSLServerSocket.this:2" href="htmlsrc/tango.net.device.SSLSocket.html#L377">this</a><span class="params">(Address <em>addr</em>, SSLCtx <em>ctx</em>, int <em>backlog</em> = <span class="defval"><span class="n">32</span></span>, bool <em>reuse</em> = <span class="defval"><span class="k">false</span></span>)</span> <a href="tango.net.device.SSLSocket.html#SSLServerSocket.this:2" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Constructs a new SSLServerSocket. This constructor is similar to
        ServerSocket, except it takes a SSLCtx as provided by PKI.</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>addr</em></td><td>the address to bind and listen on.</td></tr>
<tr><td><em>ctx</em></td><td>the provided SSLCtx</td></tr>
<tr><td><em>backlog</em></td><td>the number of connections to backlog before refusing connection</td></tr>
<tr><td><em>reuse</em></td><td>if enabled, allow rebinding of existing ip/port</td></tr></table></dd>
<dt class="decl"><span class="rettyp">SSLSocket</span> <a class="symbol _function" name="SSLServerSocket.accept" href="htmlsrc/tango.net.device.SSLSocket.html#L392">accept</a><span class="params">(SSLSocket <em>recipient</em> = <span class="defval"><span class="k">null</span></span>)</span> <a href="tango.net.device.SSLSocket.html#SSLServerSocket.accept" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Accepts a new connection and copies the provided server SSLCtx to a new
      SSLSocket.</div></div></dd></dl></dd></dl>
</div>
<div id="kandil-footer">
  <p>Copyright (c) 2008 Jeff Davey. All rights reserved</p>
  <p>Page generated by <a href="http://code.google.com/p/dil">dil</a> on Mon Mar 12 21:33:57 2012. Rendered by <a href="http://code.google.com/p/dil/wiki/Kandil">kandil</a>.</p>
</div>
</div>
</body>
</html>