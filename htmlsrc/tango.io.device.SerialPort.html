<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>tango.io.device.SerialPort</title>
  <style type="text/css">
  .linescolumn > a { display: block; }
  td { vertical-align: top; }
  </style>
  <link href="html.css" rel="stylesheet" type="text/css">
</head>
<body>
<table><tr><td class="linescolumn"><a id="L1" href="#L1">1</a><a id="L2" href="#L2">2</a><a id="L3" href="#L3">3</a><a id="L4" href="#L4">4</a><a id="L5" href="#L5">5</a><a id="L6" href="#L6">6</a><a id="L7" href="#L7">7</a><a id="L8" href="#L8">8</a><a id="L9" href="#L9">9</a><a id="L10" href="#L10">10</a><a id="L11" href="#L11">11</a><a id="L12" href="#L12">12</a><a id="L13" href="#L13">13</a><a id="L14" href="#L14">14</a><a id="L15" href="#L15">15</a><a id="L16" href="#L16">16</a><a id="L17" href="#L17">17</a><a id="L18" href="#L18">18</a><a id="L19" href="#L19">19</a><a id="L20" href="#L20">20</a><a id="L21" href="#L21">21</a><a id="L22" href="#L22">22</a><a id="L23" href="#L23">23</a><a id="L24" href="#L24">24</a><a id="L25" href="#L25">25</a><a id="L26" href="#L26">26</a><a id="L27" href="#L27">27</a><a id="L28" href="#L28">28</a><a id="L29" href="#L29">29</a><a id="L30" href="#L30">30</a><a id="L31" href="#L31">31</a><a id="L32" href="#L32">32</a><a id="L33" href="#L33">33</a><a id="L34" href="#L34">34</a><a id="L35" href="#L35">35</a><a id="L36" href="#L36">36</a><a id="L37" href="#L37">37</a><a id="L38" href="#L38">38</a><a id="L39" href="#L39">39</a><a id="L40" href="#L40">40</a><a id="L41" href="#L41">41</a><a id="L42" href="#L42">42</a><a id="L43" href="#L43">43</a><a id="L44" href="#L44">44</a><a id="L45" href="#L45">45</a><a id="L46" href="#L46">46</a><a id="L47" href="#L47">47</a><a id="L48" href="#L48">48</a><a id="L49" href="#L49">49</a><a id="L50" href="#L50">50</a><a id="L51" href="#L51">51</a><a id="L52" href="#L52">52</a><a id="L53" href="#L53">53</a><a id="L54" href="#L54">54</a><a id="L55" href="#L55">55</a><a id="L56" href="#L56">56</a><a id="L57" href="#L57">57</a><a id="L58" href="#L58">58</a><a id="L59" href="#L59">59</a><a id="L60" href="#L60">60</a><a id="L61" href="#L61">61</a><a id="L62" href="#L62">62</a><a id="L63" href="#L63">63</a><a id="L64" href="#L64">64</a><a id="L65" href="#L65">65</a><a id="L66" href="#L66">66</a><a id="L67" href="#L67">67</a><a id="L68" href="#L68">68</a><a id="L69" href="#L69">69</a><a id="L70" href="#L70">70</a><a id="L71" href="#L71">71</a><a id="L72" href="#L72">72</a><a id="L73" href="#L73">73</a><a id="L74" href="#L74">74</a><a id="L75" href="#L75">75</a><a id="L76" href="#L76">76</a><a id="L77" href="#L77">77</a><a id="L78" href="#L78">78</a><a id="L79" href="#L79">79</a><a id="L80" href="#L80">80</a><a id="L81" href="#L81">81</a><a id="L82" href="#L82">82</a><a id="L83" href="#L83">83</a><a id="L84" href="#L84">84</a><a id="L85" href="#L85">85</a><a id="L86" href="#L86">86</a><a id="L87" href="#L87">87</a><a id="L88" href="#L88">88</a><a id="L89" href="#L89">89</a><a id="L90" href="#L90">90</a><a id="L91" href="#L91">91</a><a id="L92" href="#L92">92</a><a id="L93" href="#L93">93</a><a id="L94" href="#L94">94</a><a id="L95" href="#L95">95</a><a id="L96" href="#L96">96</a><a id="L97" href="#L97">97</a><a id="L98" href="#L98">98</a><a id="L99" href="#L99">99</a><a id="L100" href="#L100">100</a><a id="L101" href="#L101">101</a><a id="L102" href="#L102">102</a><a id="L103" href="#L103">103</a><a id="L104" href="#L104">104</a><a id="L105" href="#L105">105</a><a id="L106" href="#L106">106</a><a id="L107" href="#L107">107</a><a id="L108" href="#L108">108</a><a id="L109" href="#L109">109</a><a id="L110" href="#L110">110</a><a id="L111" href="#L111">111</a><a id="L112" href="#L112">112</a><a id="L113" href="#L113">113</a><a id="L114" href="#L114">114</a><a id="L115" href="#L115">115</a><a id="L116" href="#L116">116</a><a id="L117" href="#L117">117</a><a id="L118" href="#L118">118</a><a id="L119" href="#L119">119</a><a id="L120" href="#L120">120</a><a id="L121" href="#L121">121</a><a id="L122" href="#L122">122</a><a id="L123" href="#L123">123</a><a id="L124" href="#L124">124</a><a id="L125" href="#L125">125</a><a id="L126" href="#L126">126</a><a id="L127" href="#L127">127</a><a id="L128" href="#L128">128</a><a id="L129" href="#L129">129</a><a id="L130" href="#L130">130</a><a id="L131" href="#L131">131</a><a id="L132" href="#L132">132</a><a id="L133" href="#L133">133</a><a id="L134" href="#L134">134</a><a id="L135" href="#L135">135</a><a id="L136" href="#L136">136</a><a id="L137" href="#L137">137</a><a id="L138" href="#L138">138</a><a id="L139" href="#L139">139</a><a id="L140" href="#L140">140</a><a id="L141" href="#L141">141</a><a id="L142" href="#L142">142</a><a id="L143" href="#L143">143</a><a id="L144" href="#L144">144</a><a id="L145" href="#L145">145</a><a id="L146" href="#L146">146</a><a id="L147" href="#L147">147</a><a id="L148" href="#L148">148</a><a id="L149" href="#L149">149</a><a id="L150" href="#L150">150</a><a id="L151" href="#L151">151</a><a id="L152" href="#L152">152</a><a id="L153" href="#L153">153</a><a id="L154" href="#L154">154</a><a id="L155" href="#L155">155</a><a id="L156" href="#L156">156</a><a id="L157" href="#L157">157</a><a id="L158" href="#L158">158</a><a id="L159" href="#L159">159</a><a id="L160" href="#L160">160</a><a id="L161" href="#L161">161</a><a id="L162" href="#L162">162</a><a id="L163" href="#L163">163</a><a id="L164" href="#L164">164</a><a id="L165" href="#L165">165</a><a id="L166" href="#L166">166</a><a id="L167" href="#L167">167</a><a id="L168" href="#L168">168</a><a id="L169" href="#L169">169</a><a id="L170" href="#L170">170</a><a id="L171" href="#L171">171</a><a id="L172" href="#L172">172</a><a id="L173" href="#L173">173</a><a id="L174" href="#L174">174</a><a id="L175" href="#L175">175</a><a id="L176" href="#L176">176</a><a id="L177" href="#L177">177</a><a id="L178" href="#L178">178</a><a id="L179" href="#L179">179</a><a id="L180" href="#L180">180</a><a id="L181" href="#L181">181</a><a id="L182" href="#L182">182</a><a id="L183" href="#L183">183</a><a id="L184" href="#L184">184</a><a id="L185" href="#L185">185</a><a id="L186" href="#L186">186</a><a id="L187" href="#L187">187</a><a id="L188" href="#L188">188</a><a id="L189" href="#L189">189</a><a id="L190" href="#L190">190</a><a id="L191" href="#L191">191</a><a id="L192" href="#L192">192</a><a id="L193" href="#L193">193</a><a id="L194" href="#L194">194</a><a id="L195" href="#L195">195</a><a id="L196" href="#L196">196</a><a id="L197" href="#L197">197</a><a id="L198" href="#L198">198</a><a id="L199" href="#L199">199</a><a id="L200" href="#L200">200</a><a id="L201" href="#L201">201</a><a id="L202" href="#L202">202</a><a id="L203" href="#L203">203</a><a id="L204" href="#L204">204</a><a id="L205" href="#L205">205</a><a id="L206" href="#L206">206</a><a id="L207" href="#L207">207</a><a id="L208" href="#L208">208</a><a id="L209" href="#L209">209</a><a id="L210" href="#L210">210</a><a id="L211" href="#L211">211</a><a id="L212" href="#L212">212</a><a id="L213" href="#L213">213</a><a id="L214" href="#L214">214</a><a id="L215" href="#L215">215</a><a id="L216" href="#L216">216</a><a id="L217" href="#L217">217</a><a id="L218" href="#L218">218</a><a id="L219" href="#L219">219</a><a id="L220" href="#L220">220</a><a id="L221" href="#L221">221</a><a id="L222" href="#L222">222</a><a id="L223" href="#L223">223</a><a id="L224" href="#L224">224</a><a id="L225" href="#L225">225</a><a id="L226" href="#L226">226</a><a id="L227" href="#L227">227</a><a id="L228" href="#L228">228</a><a id="L229" href="#L229">229</a><a id="L230" href="#L230">230</a><a id="L231" href="#L231">231</a><a id="L232" href="#L232">232</a><a id="L233" href="#L233">233</a><a id="L234" href="#L234">234</a><a id="L235" href="#L235">235</a><a id="L236" href="#L236">236</a><a id="L237" href="#L237">237</a><a id="L238" href="#L238">238</a><a id="L239" href="#L239">239</a><a id="L240" href="#L240">240</a><a id="L241" href="#L241">241</a><a id="L242" href="#L242">242</a><a id="L243" href="#L243">243</a><a id="L244" href="#L244">244</a><a id="L245" href="#L245">245</a><a id="L246" href="#L246">246</a><a id="L247" href="#L247">247</a><a id="L248" href="#L248">248</a><a id="L249" href="#L249">249</a><a id="L250" href="#L250">250</a><a id="L251" href="#L251">251</a><a id="L252" href="#L252">252</a><a id="L253" href="#L253">253</a><a id="L254" href="#L254">254</a><a id="L255" href="#L255">255</a><a id="L256" href="#L256">256</a><a id="L257" href="#L257">257</a><a id="L258" href="#L258">258</a><a id="L259" href="#L259">259</a><a id="L260" href="#L260">260</a><a id="L261" href="#L261">261</a><a id="L262" href="#L262">262</a><a id="L263" href="#L263">263</a><a id="L264" href="#L264">264</a><a id="L265" href="#L265">265</a><a id="L266" href="#L266">266</a><a id="L267" href="#L267">267</a><a id="L268" href="#L268">268</a><a id="L269" href="#L269">269</a><a id="L270" href="#L270">270</a><a id="L271" href="#L271">271</a><a id="L272" href="#L272">272</a><a id="L273" href="#L273">273</a><a id="L274" href="#L274">274</a><a id="L275" href="#L275">275</a><a id="L276" href="#L276">276</a><a id="L277" href="#L277">277</a><a id="L278" href="#L278">278</a><a id="L279" href="#L279">279</a><a id="L280" href="#L280">280</a><a id="L281" href="#L281">281</a><a id="L282" href="#L282">282</a><a id="L283" href="#L283">283</a><a id="L284" href="#L284">284</a><a id="L285" href="#L285">285</a><a id="L286" href="#L286">286</a><a id="L287" href="#L287">287</a><a id="L288" href="#L288">288</a><a id="L289" href="#L289">289</a><a id="L290" href="#L290">290</a><a id="L291" href="#L291">291</a><a id="L292" href="#L292">292</a><a id="L293" href="#L293">293</a><a id="L294" href="#L294">294</a><a id="L295" href="#L295">295</a><a id="L296" href="#L296">296</a><a id="L297" href="#L297">297</a><a id="L298" href="#L298">298</a><a id="L299" href="#L299">299</a><a id="L300" href="#L300">300</a><a id="L301" href="#L301">301</a><a id="L302" href="#L302">302</a><a id="L303" href="#L303">303</a><a id="L304" href="#L304">304</a><a id="L305" href="#L305">305</a><a id="L306" href="#L306">306</a><a id="L307" href="#L307">307</a><a id="L308" href="#L308">308</a><a id="L309" href="#L309">309</a><a id="L310" href="#L310">310</a><a id="L311" href="#L311">311</a><a id="L312" href="#L312">312</a><a id="L313" href="#L313">313</a><a id="L314" href="#L314">314</a><a id="L315" href="#L315">315</a><a id="L316" href="#L316">316</a><a id="L317" href="#L317">317</a><a id="L318" href="#L318">318</a><a id="L319" href="#L319">319</a><a id="L320" href="#L320">320</a><a id="L321" href="#L321">321</a><a id="L322" href="#L322">322</a><a id="L323" href="#L323">323</a><a id="L324" href="#L324">324</a><a id="L325" href="#L325">325</a><a id="L326" href="#L326">326</a><a id="L327" href="#L327">327</a><a id="L328" href="#L328">328</a><a id="L329" href="#L329">329</a><a id="L330" href="#L330">330</a><a id="L331" href="#L331">331</a><a id="L332" href="#L332">332</a><a id="L333" href="#L333">333</a><a id="L334" href="#L334">334</a><a id="L335" href="#L335">335</a><a id="L336" href="#L336">336</a><a id="L337" href="#L337">337</a><a id="L338" href="#L338">338</a><a id="L339" href="#L339">339</a><a id="L340" href="#L340">340</a><a id="L341" href="#L341">341</a><a id="L342" href="#L342">342</a><a id="L343" href="#L343">343</a></td>
<td><td><pre class="sourcecode">
<span class="bc">/*******************************************************************************

        copyright:      Copyright (c) 2008 Robin Kreis. All rights reserved

        license:        BSD style: $(LICENSE)

        author:         Robin Kreis

*******************************************************************************/</span>

<span class="d Compound"><span class="d Module"><span class="k">module</span> <span class="i">tango</span>.<span class="i">io</span>.<span class="i">device</span>.<span class="i">SerialPort</span>;</span>

<span class="d Protection"><span class="k">private</span></span> <span class="d Import"><span class="k">import</span>  <span class="i">tango</span>.<span class="i">core</span>.<span class="i">Array</span> : <span class="i">sort</span>;</span>

<span class="d Protection"><span class="k">private</span></span> <span class="d Import"><span class="k">import</span>  <span class="i">tango</span>.<span class="i">core</span>.<span class="i">Exception</span>,
                <span class="i">tango</span>.<span class="i">io</span>.<span class="i">device</span>.<span class="i">Device</span>,
                <span class="i">tango</span>.<span class="i">stdc</span>.<span class="i">stringz</span>,
                <span class="i">tango</span>.<span class="i">sys</span>.<span class="i">Common</span>;</span>

<span class="d Version"><span class="k">version</span>(<span class="i">Windows</span>)
<span class="d Compound">{
<span class="d Protection"><span class="k">private</span></span> <span class="d Import"><span class="k">import</span> <span class="i">Integer</span> = <span class="i">tango</span>.<span class="i">text</span>.<span class="i">convert</span>.<span class="i">Integer</span>;</span>
<span class="d Protection"><span class="k">private</span></span> <span class="d Import"><span class="k">import</span> <span class="i">tango</span>.<span class="i">stdc</span>.<span class="i">stringz</span>;</span>
}</span>
<span class="k">else</span>
<span class="d Version"><span class="k">version</span>(<span class="i">Posix</span>)
<span class="d Compound">{
<span class="d Protection"><span class="k">private</span></span> <span class="d Import"><span class="k">import</span>  <span class="i">tango</span>.<span class="i">io</span>.<span class="i">FilePath</span>,
                <span class="i">tango</span>.<span class="i">stdc</span>.<span class="i">posix</span>.<span class="i">termios</span>;</span>
}</span></span></span>

<span class="bc">/*******************************************************************************

        Enables applications to use a serial port (aka COM-port, ttyS).
        Usage is similar to that of File:
        ---
        auto serCond = new SerialPort("ttyS0");
        serCond.speed = 38400;
        serCond.write("Hello world!");
        serCond.close();
        ----

*******************************************************************************/</span>

<span class="d Class"><span class="k">class</span> <span class="i">SerialPort</span> : <span class="t BaseClass"><span class="t Identifier"><span class="i">Device</span></span></span>
<span class="d Compound">{
    <span class="d Protection"><span class="k">private</span></span> <span class="d Variables"><span class="t Const"><span class="k">const</span>(<span class="t Integral"><span class="k">char</span></span>)</span><span class="t Array">[]</span>              <span class="i">str</span>;</span>
    <span class="d Protection"><span class="k">private</span></span> <span class="d StorageClass"><span class="k">static</span></span> <span class="d Variables"><span class="t Const"><span class="k">const</span>(<span class="t Integral"><span class="k">char</span></span>)</span><span class="t Array">[]</span><span class="t Array">[]</span>     <span class="i">_ports</span>;</span>

    <span class="bc">/***************************************************************************

            Create a new SerialPort instance. The port will be opened and
            set to raw mode with 9600-8N1.

            Params:
            port = A string identifying the port. On Posix, this must be a
                   device file like /dev/ttyS0. If the input doesn't begin
                   with "/", "/dev/" is automatically prepended, so "ttyS0"
                   is sufficent. On Windows, this must be a device name like
                   COM1.

    ***************************************************************************/</span>

    <span class="d Constructor"><span class="k">this</span> <span class="o Parameters">(<span class="o Parameter"><span class="t Const"><span class="k">const</span>(<span class="t Integral"><span class="k">char</span></span>)</span><span class="t Array">[]</span> <span class="i">port</span></span>)</span>
    <span class="s FuncBody"><span class="s Compound">{
        <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">create</span></span> (<span class="i">port</span>);</span></span>
    }</span></span></span>

    <span class="bc">/***************************************************************************

            Returns a string describing this serial port.
            For example: "ttyS0", "COM1", "cuad0".

    ***************************************************************************/</span>

    <span class="d StorageClass"><span class="k">override</span></span> <span class="d Function"><span class="t Identifier"><span class="i">string</span></span> <span class="i">toString</span> <span class="o Parameters">()</span>
    <span class="s FuncBody"><span class="s Compound">{
        <span class="s Return"><span class="k">return</span> <span class="e Identifier"><span class="i">str</span></span>.<span class="e Identifier"><span class="i">idup</span></span>;</span>
    }</span></span></span>

    <span class="bc">/***************************************************************************

            Sets the baud rate of this port. Usually, the baud rate can
            only be set to fixed values (common values are 1200 * 2^n).

            Note that for Posix, the specification only mandates speeds up
            to 38400, excluding speeds such as 7200, 14400 and 28800.
            Most Posix systems have chosen to support at least higher speeds
            though.

            See_also: maxSpeed

            Throws: IOException if speed is unsupported.

    ***************************************************************************/</span>

    <span class="d Function"><span class="t Identifier"><span class="i">SerialPort</span></span> <span class="i">speed</span> <span class="o Parameters">(<span class="o Parameter"><span class="t Integral"><span class="k">uint</span></span> <span class="i">speed</span></span>)</span>
    <span class="s FuncBody"><span class="s Compound">{
        <span class="s Version"><span class="k">version</span>(<span class="i">Posix</span>) <span class="s Compound">{
            <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">speed_t</span></span> <span class="t Pointer">*</span><span class="i">baud</span> = <span class="e In"><span class="e Identifier"><span class="i">speed</span></span> <span class="k">in</span> <span class="e Identifier"><span class="i">baudRates</span></span></span>;</span></span>
            <span class="s If"><span class="k">if</span>(<span class="e Identity"><span class="e Identifier"><span class="i">baud</span></span> <span class="k">is</span> <span class="e Null"><span class="k">null</span></span></span>) <span class="s Scope"><span class="s Compound">{
                <span class="s Throw"><span class="k">throw</span> <span class="e New"><span class="k">new</span> <span class="t Identifier"><span class="i">IOException</span></span>(<span class="e String"><span class="sl">"Invalid baud rate."</span></span>)</span>;</span>
            }</span></span></span>

            <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">termios</span></span> <span class="i">options</span>;</span></span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">tcgetattr</span></span>(<span class="i">handle</span>, &amp;<span class="i">options</span>)</span>;</span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">cfsetospeed</span></span>(&amp;<span class="i">options</span>, *<span class="i">baud</span>)</span>;</span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">tcsetattr</span></span>(<span class="i">handle</span>, <span class="i">TCSANOW</span>, &amp;<span class="i">options</span>)</span>;</span>
        }</span></span>
        <span class="s Version"><span class="k">version</span>(<span class="i">Win32</span>) <span class="s Compound">{
            <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">DCB</span></span> <span class="i">config</span>;</span></span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">GetCommState</span></span>(<span class="i">io</span>.<span class="i">handle</span>, &amp;<span class="i">config</span>)</span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">config</span></span>.<span class="e Identifier"><span class="i">BaudRate</span></span> = <span class="e Identifier"><span class="i">speed</span></span></span>;</span>
            <span class="s If"><span class="k">if</span>(<span class="e Call"><span class="e Not">!<span class="e Identifier"><span class="i">SetCommState</span></span></span>(<span class="i">io</span>.<span class="i">handle</span>, &amp;<span class="i">config</span>)</span>) <span class="s Scope"><span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">error</span></span>()</span>;</span></span></span>
        }</span></span>
        <span class="s Return"><span class="k">return</span> <span class="e This"><span class="k">this</span></span>;</span>
    }</span></span></span>

    <span class="bc">/***************************************************************************

            Tries to enumerate all serial ports. While this usually works on
            Windows, it's more problematic on other OS. Posix provides no way
            to list serial ports, and the only option is searching through
            "/dev".

            Because there's no naming standard for the device files, this method
            must be ported for each OS. This method is also unreliable because
            the user could have created invalid device files, or deleted them.

            Returns:
            A string array of all the serial ports that could be found, in
            alphabetical order. Every string is formatted as a valid argument
            to the constructor, but the port may not be accessible.

    ***************************************************************************/</span>

    <span class="d StorageClass"><span class="k">static</span></span> <span class="d Function"><span class="t Const"><span class="k">const</span>(<span class="t Integral"><span class="k">char</span></span>)</span><span class="t Array">[]</span><span class="t Array">[]</span> <span class="i">ports</span> <span class="o Parameters">()</span>
    <span class="s FuncBody"><span class="s Compound">{
        <span class="s If"><span class="k">if</span>(<span class="e Identity"><span class="e Identifier"><span class="i">_ports</span></span> !<span class="k">is</span> <span class="e Null"><span class="k">null</span></span></span>) <span class="s Scope"><span class="s Compound">{
            <span class="s Return"><span class="k">return</span> <span class="e Identifier"><span class="i">_ports</span></span>;</span>
        }</span></span></span>
        <span class="s Version"><span class="k">version</span>(<span class="i">Windows</span>) <span class="s Compound">{
            <span class="lc">// try opening COM1...COM255</span>
            <span class="s Declaration"><span class="d StorageClass"><span class="k">auto</span></span> <span class="d Variables"><span class="i">pre</span> = <span class="e String"><span class="sl">`\\.\COM`</span></span>;</span></span>
            <span class="s Declaration"><span class="d Variables"><span class="t Integral"><span class="k">char</span></span><span class="t Array">[<span class="e Int"><span class="n">11</span></span>]</span> <span class="i">p</span> = <span class="e VoidInit"><span class="k">void</span></span>;</span></span>
            <span class="s Declaration"><span class="d Variables"><span class="t Integral"><span class="k">char</span></span><span class="t Array">[<span class="e Int"><span class="n">3</span></span>]</span> <span class="i">num</span> = <span class="e VoidInit"><span class="k">void</span></span>;</span></span>
            <span class="s Expression"><span class="e Assign"><span class="e Slice"><span class="e Identifier"><span class="i">p</span></span>[<span class="e Int"><span class="n">0</span></span>..<span class="e Identifier"><span class="i">pre</span></span>.<span class="e Identifier"><span class="i">length</span></span>]</span> = <span class="e Identifier"><span class="i">pre</span></span></span>;</span>
            <span class="s For"><span class="k">for</span>(<span class="s Declaration"><span class="d Variables"><span class="t Integral"><span class="k">int</span></span> <span class="i">i</span> = <span class="e Int"><span class="n">1</span></span>;</span></span> <span class="e Rel"><span class="e Identifier"><span class="i">i</span></span> &lt;= <span class="e Int"><span class="n">255</span></span></span>; <span class="e PreIncr">++<span class="e Identifier"><span class="i">i</span></span></span>) <span class="s Scope"><span class="s Compound">{
                <span class="s Declaration"><span class="d Variables"><span class="t Integral"><span class="k">char</span></span><span class="t Array">[]</span> <span class="i">portNum</span> = <span class="e Call"><span class="e Identifier"><span class="i">Integer</span></span>.<span class="e Identifier"><span class="i">format</span></span>(<span class="i">num</span>, <span class="i">i</span>)</span>;</span></span>
                <span class="s Expression"><span class="e Assign"><span class="e Slice"><span class="e Identifier"><span class="i">p</span></span>[<span class="e Identifier"><span class="i">pre</span></span>.<span class="e Identifier"><span class="i">length</span></span>..<span class="e Plus"><span class="e Identifier"><span class="i">pre</span></span>.<span class="e Identifier"><span class="i">length</span></span> + <span class="e Identifier"><span class="i">portNum</span></span>.<span class="e Identifier"><span class="i">length</span></span></span>]</span> = <span class="e Identifier"><span class="i">portNum</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">p</span></span>[<span class="e Plus"><span class="e Identifier"><span class="i">pre</span></span>.<span class="e Identifier"><span class="i">length</span></span> + <span class="e Identifier"><span class="i">portNum</span></span>.<span class="e Identifier"><span class="i">length</span></span></span>]</span> = <span class="e Char"><span class="cl">'<span class="es">\0</span>'</span></span></span>;</span>
                <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">HANDLE</span></span> <span class="i">port</span> = <span class="e Call"><span class="e Identifier"><span class="i">CreateFileA</span></span>(<span class="i">p</span>.<span class="i">ptr</span>, <span class="i">GENERIC_READ</span> | <span class="i">GENERIC_WRITE</span>, <span class="n">0</span>, <span class="k">null</span>, <span class="i">OPEN_EXISTING</span>, <span class="n">0</span>, <span class="k">null</span>)</span>;</span></span>
                <span class="s If"><span class="k">if</span>(<span class="e Equal"><span class="e Identifier"><span class="i">port</span></span> != <span class="e Identifier"><span class="i">INVALID_HANDLE_VALUE</span></span></span>) <span class="s Scope"><span class="s Compound">{
                    <span class="s Expression"><span class="e CatAssign"><span class="e Identifier"><span class="i">_ports</span></span> ~= <span class="e Slice"><span class="e Identifier"><span class="i">p</span></span>[<span class="e String"><span class="sl">`\\.\`</span></span>.<span class="e Identifier"><span class="i">length</span></span>..<span class="e Dollar">$</span>]</span>.<span class="e Identifier"><span class="i">dup</span></span></span>;</span> <span class="lc">// cut the leading \\.\</span>
                    <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">CloseHandle</span></span>(<span class="i">port</span>);</span></span>
                }</span></span></span>
            }</span></span></span>
        }</span> <span class="k">else</span> <span class="s Version"><span class="k">version</span>(<span class="i">Posix</span>) <span class="s Compound">{
            <span class="s Declaration"><span class="d StorageClass"><span class="k">auto</span></span> <span class="d Variables"><span class="i">dev</span> = <span class="e Call"><span class="e Identifier"><span class="i">FilePath</span></span>(<span class="sl">"/dev"</span>.<span class="i">dup</span>)</span>;</span></span>
            <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">FilePath</span></span><span class="t Array">[]</span> <span class="i">serPorts</span> = <span class="e Call"><span class="e Identifier"><span class="i">dev</span></span>.<span class="e Identifier"><span class="i">toList</span></span>((<span class="i">FilePath</span> <span class="i">path</span>, <span class="k">bool</span> <span class="i">isFolder</span>) {
                <span class="k">if</span>(<span class="i">isFolder</span>) <span class="k">return</span> <span class="k">false</span>;
                <span class="k">version</span>(<span class="i">linux</span>) {
                    <span class="k">auto</span> <span class="i">r</span> = <span class="i">rest</span>(<span class="i">path</span>.<span class="i">name</span>, <span class="sl">"ttyUSB"</span>);
                    <span class="k">if</span>(<span class="i">r</span> <span class="k">is</span> <span class="k">null</span>) <span class="i">r</span> = <span class="i">rest</span>(<span class="i">path</span>.<span class="i">name</span>, <span class="sl">"ttyS"</span>);
                    <span class="k">if</span>(<span class="i">r</span>.<span class="i">length</span> == <span class="n">0</span>) <span class="k">return</span> <span class="k">false</span>;
                    <span class="k">return</span> <span class="i">isInRange</span>(<span class="i">r</span>, <span class="cl">'0'</span>, <span class="cl">'9'</span>);
                } <span class="k">else</span> <span class="k">version</span> (<span class="i">darwin</span>) { <span class="lc">// untested</span>
                    <span class="k">auto</span> <span class="i">r</span> = <span class="i">rest</span>(<span class="i">path</span>.<span class="i">name</span>, <span class="sl">"cu"</span>);
                    <span class="k">if</span>(<span class="i">r</span>.<span class="i">length</span> == <span class="n">0</span>) <span class="k">return</span> <span class="k">false</span>;
                    <span class="k">return</span> <span class="k">true</span>;
                } <span class="k">else</span> <span class="k">version</span>(<span class="i">FreeBSD</span>) { <span class="lc">// untested</span>
                    <span class="k">auto</span> <span class="i">r</span> = <span class="i">rest</span>(<span class="i">path</span>.<span class="i">name</span>, <span class="sl">"cuaa"</span>);
                    <span class="k">if</span>(<span class="i">r</span> <span class="k">is</span> <span class="k">null</span>) <span class="i">r</span> = <span class="i">rest</span>(<span class="i">path</span>.<span class="i">name</span>, <span class="sl">"cuad"</span>);
                    <span class="k">if</span>(<span class="i">r</span>.<span class="i">length</span> == <span class="n">0</span>) <span class="k">return</span> <span class="k">false</span>;
                    <span class="k">return</span> <span class="i">isInRange</span>(<span class="i">r</span>, <span class="cl">'0'</span>, <span class="cl">'9'</span>);
                } <span class="k">else</span> <span class="k">version</span>(<span class="i">openbsd</span>) { <span class="lc">// untested</span>
                    <span class="k">auto</span> <span class="i">r</span> = <span class="i">rest</span>(<span class="i">path</span>.<span class="i">name</span>, <span class="sl">"tty"</span>);
                    <span class="k">if</span>(<span class="i">r</span>.<span class="i">length</span> != <span class="n">2</span>) <span class="k">return</span> <span class="k">false</span>;
                    <span class="k">return</span> <span class="i">isInRange</span>(<span class="i">r</span>, <span class="cl">'0'</span>, <span class="cl">'9'</span>);
                } <span class="k">else</span> <span class="k">version</span>(<span class="i">solaris</span>) { <span class="lc">// untested</span>
                    <span class="k">auto</span> <span class="i">r</span> = <span class="i">rest</span>(<span class="i">path</span>.<span class="i">name</span>, <span class="sl">"tty"</span>);
                    <span class="k">if</span>(<span class="i">r</span>.<span class="i">length</span> != <span class="n">1</span>) <span class="k">return</span> <span class="k">false</span>;
                    <span class="k">return</span> <span class="i">isInRange</span>(<span class="i">r</span>, <span class="cl">'a'</span>, <span class="cl">'z'</span>);
                } <span class="k">else</span> {
                    <span class="k">return</span> <span class="k">false</span>;
                }
            })</span>;</span></span>
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">_ports</span></span>.<span class="e Identifier"><span class="i">length</span></span> = <span class="e Identifier"><span class="i">serPorts</span></span>.<span class="e Identifier"><span class="i">length</span></span></span>;</span>
            <span class="s Foreach"><span class="k">foreach</span>(<span class="o Parameters"><span class="o Parameter"><span class="i">i</span></span>, <span class="o Parameter"><span class="i">path</span></span></span>; <span class="e Identifier"><span class="i">serPorts</span></span>) <span class="s Scope"><span class="s Compound">{
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">_ports</span></span>[<span class="e Identifier"><span class="i">i</span></span>]</span> = <span class="e Identifier"><span class="i">path</span></span>.<span class="e Identifier"><span class="i">name</span></span></span>;</span>
            }</span></span></span>
        }</span></span></span>
        <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">sort</span></span>(<span class="i">_ports</span>);</span></span>
        <span class="s Return"><span class="k">return</span> <span class="e Identifier"><span class="i">_ports</span></span>;</span>
    }</span></span></span>

    <span class="d Version"><span class="k">version</span>(<span class="i">Win32</span>) <span class="d Compound">{
        <span class="d Protection"><span class="k">private</span></span> <span class="d Function"><span class="t Integral"><span class="k">void</span></span> <span class="i">create</span> <span class="o Parameters">(<span class="o Parameter"><span class="t Const"><span class="k">const</span>(<span class="t Integral"><span class="k">char</span></span>)</span><span class="t Array">[]</span> <span class="i">port</span></span>)</span>
        <span class="s FuncBody"><span class="s Compound">{
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">str</span></span> = <span class="e Identifier"><span class="i">port</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">io</span></span>.<span class="e Identifier"><span class="i">handle</span></span> = <span class="e Call"><span class="e Identifier"><span class="i">CreateFileA</span></span>((<span class="sl">`\\.\`</span> ~ <span class="i">port</span>).<span class="i">toStringz</span>(), <span class="i">GENERIC_READ</span> | <span class="i">GENERIC_WRITE</span>, <span class="n">0</span>, <span class="k">null</span>, <span class="i">OPEN_EXISTING</span>, <span class="n">0</span>, <span class="k">null</span>)</span></span>;</span>
            <span class="s If"><span class="k">if</span>(<span class="e Identity"><span class="e Identifier"><span class="i">io</span></span>.<span class="e Identifier"><span class="i">handle</span></span> <span class="k">is</span> <span class="e Identifier"><span class="i">INVALID_HANDLE_VALUE</span></span></span>) <span class="s Scope"><span class="s Compound">{
                <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">error</span></span>()</span>;</span>
            }</span></span></span>
            <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">DCB</span></span> <span class="i">config</span>;</span></span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">GetCommState</span></span>(<span class="i">io</span>.<span class="i">handle</span>, &amp;<span class="i">config</span>)</span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">config</span></span>.<span class="e Identifier"><span class="i">BaudRate</span></span> = <span class="e Int"><span class="n">9600</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">config</span></span>.<span class="e Identifier"><span class="i">ByteSize</span></span> = <span class="e Int"><span class="n">8</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">config</span></span>.<span class="e Identifier"><span class="i">Parity</span></span> = <span class="e Identifier"><span class="i">NOPARITY</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">config</span></span>.<span class="e Identifier"><span class="i">StopBits</span></span> = <span class="e Identifier"><span class="i">ONESTOPBIT</span></span></span>;</span>
            <span class="s Expression"><span class="e OrAssign"><span class="e Identifier"><span class="i">config</span></span>.<span class="e Identifier"><span class="i">flag0</span></span> |= <span class="e Or"><span class="e Identifier"><span class="i">bm_DCB_fBinary</span></span> | <span class="e Identifier"><span class="i">bm_DCB_fParity</span></span></span></span>;</span>
            <span class="s If"><span class="k">if</span>(<span class="e Call"><span class="e Not">!<span class="e Identifier"><span class="i">SetCommState</span></span></span>(<span class="i">io</span>.<span class="i">handle</span>, &amp;<span class="i">config</span>)</span>) <span class="s Scope"><span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">error</span></span>()</span>;</span></span></span>
        }</span></span></span>
    }</span></span>

    <span class="d Version"><span class="k">version</span>(<span class="i">Posix</span>) <span class="d Compound">{
        <span class="d Protection"><span class="k">private</span></span> <span class="d StorageClass"><span class="k">__gshared</span></span> <span class="d StorageClass"><span class="k">static</span></span> <span class="d Variables"><span class="t Identifier"><span class="i">speed_t</span></span><span class="t Array">[<span class="t Integral"><span class="k">uint</span></span>]</span> <span class="i">baudRates</span>;</span>

        <span class="d StorageClass"><span class="k">shared</span></span> <span class="d StaticCtor"><span class="k">static</span> <span class="k">this</span>()
        <span class="s FuncBody"><span class="s Compound">{
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">50</span></span>]</span> = <span class="e Identifier"><span class="i">B50</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">75</span></span>]</span> = <span class="e Identifier"><span class="i">B75</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">110</span></span>]</span> = <span class="e Identifier"><span class="i">B110</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">134</span></span>]</span> = <span class="e Identifier"><span class="i">B134</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">150</span></span>]</span> = <span class="e Identifier"><span class="i">B150</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">200</span></span>]</span> = <span class="e Identifier"><span class="i">B200</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">300</span></span>]</span> = <span class="e Identifier"><span class="i">B300</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">600</span></span>]</span> = <span class="e Identifier"><span class="i">B600</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">1200</span></span>]</span> = <span class="e Identifier"><span class="i">B1200</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">1800</span></span>]</span> = <span class="e Identifier"><span class="i">B1800</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">2400</span></span>]</span> = <span class="e Identifier"><span class="i">B2400</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">9600</span></span>]</span> = <span class="e Identifier"><span class="i">B9600</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">4800</span></span>]</span> = <span class="e Identifier"><span class="i">B4800</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">19200</span></span>]</span> = <span class="e Identifier"><span class="i">B19200</span></span></span>;</span>
            <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">38400</span></span>]</span> = <span class="e Identifier"><span class="i">B38400</span></span></span>;</span>

            <span class="s Version"><span class="k">version</span>( <span class="i">linux</span> )
            <span class="s Compound">{
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">57600</span></span>]</span> = <span class="e Identifier"><span class="i">B57600</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">115200</span></span>]</span> = <span class="e Identifier"><span class="i">B115200</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">230400</span></span>]</span> = <span class="e Identifier"><span class="i">B230400</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">460800</span></span>]</span> = <span class="e Identifier"><span class="i">B460800</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">500000</span></span>]</span> = <span class="e Identifier"><span class="i">B500000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">576000</span></span>]</span> = <span class="e Identifier"><span class="i">B576000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">921600</span></span>]</span> = <span class="e Identifier"><span class="i">B921600</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">1000000</span></span>]</span> = <span class="e Identifier"><span class="i">B1000000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">1152000</span></span>]</span> = <span class="e Identifier"><span class="i">B1152000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">1500000</span></span>]</span> = <span class="e Identifier"><span class="i">B1500000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">2000000</span></span>]</span> = <span class="e Identifier"><span class="i">B2000000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">2500000</span></span>]</span> = <span class="e Identifier"><span class="i">B2500000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">3000000</span></span>]</span> = <span class="e Identifier"><span class="i">B3000000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">3500000</span></span>]</span> = <span class="e Identifier"><span class="i">B3500000</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">4000000</span></span>]</span> = <span class="e Identifier"><span class="i">B4000000</span></span></span>;</span>
            }</span>
            <span class="k">else</span> <span class="s Version"><span class="k">version</span>( <span class="i">FreeBSD</span> )
            <span class="s Compound">{
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">7200</span></span>]</span> = <span class="e Identifier"><span class="i">B7200</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">14400</span></span>]</span> = <span class="e Identifier"><span class="i">B14400</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">28800</span></span>]</span> = <span class="e Identifier"><span class="i">B28800</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">57600</span></span>]</span> = <span class="e Identifier"><span class="i">B57600</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">76800</span></span>]</span> = <span class="e Identifier"><span class="i">B76800</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">115200</span></span>]</span> = <span class="e Identifier"><span class="i">B115200</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">230400</span></span>]</span> = <span class="e Identifier"><span class="i">B230400</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">460800</span></span>]</span> = <span class="e Identifier"><span class="i">B460800</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">921600</span></span>]</span> = <span class="e Identifier"><span class="i">B921600</span></span></span>;</span>
            }</span>
            <span class="k">else</span> <span class="s Version"><span class="k">version</span>( <span class="i">solaris</span> )
            <span class="s Compound">{
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">57600</span></span>]</span> = <span class="e Identifier"><span class="i">B57600</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">76800</span></span>]</span> = <span class="e Identifier"><span class="i">B76800</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">115200</span></span>]</span> = <span class="e Identifier"><span class="i">B115200</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">153600</span></span>]</span> = <span class="e Identifier"><span class="i">B153600</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">230400</span></span>]</span> = <span class="e Identifier"><span class="i">B230400</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">307200</span></span>]</span> = <span class="e Identifier"><span class="i">B307200</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">460800</span></span>]</span> = <span class="e Identifier"><span class="i">B460800</span></span></span>;</span>
            }</span>
            <span class="k">else</span> <span class="s Version"><span class="k">version</span> ( <span class="i">darwin</span> )
            <span class="s Compound">{
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">7200</span></span>]</span> = <span class="e Identifier"><span class="i">B7200</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">14400</span></span>]</span> = <span class="e Identifier"><span class="i">B14400</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">28800</span></span>]</span> = <span class="e Identifier"><span class="i">B28800</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">57600</span></span>]</span> = <span class="e Identifier"><span class="i">B57600</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">76800</span></span>]</span> = <span class="e Identifier"><span class="i">B76800</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">115200</span></span>]</span> = <span class="e Identifier"><span class="i">B115200</span></span></span>;</span>
                <span class="s Expression"><span class="e Assign"><span class="e Index"><span class="e Identifier"><span class="i">baudRates</span></span>[<span class="e Int"><span class="n">230400</span></span>]</span> = <span class="e Identifier"><span class="i">B230400</span></span></span>;</span>
            }</span></span></span></span></span>
        }</span></span></span>

        <span class="d Protection"><span class="k">private</span></span> <span class="d Function"><span class="t Integral"><span class="k">void</span></span> <span class="i">create</span> <span class="o Parameters">(<span class="o Parameter"><span class="t Const"><span class="k">const</span>(<span class="t Integral"><span class="k">char</span></span>)</span><span class="t Array">[]</span> <span class="i">file</span></span>)</span>
        <span class="s FuncBody"><span class="s Compound">{
            <span class="s If"><span class="k">if</span>(<span class="e Equal"><span class="e Identifier"><span class="i">file</span></span>.<span class="e Identifier"><span class="i">length</span></span> == <span class="e Int"><span class="n">0</span></span></span>) <span class="s Scope"><span class="s Throw"><span class="k">throw</span> <span class="e New"><span class="k">new</span> <span class="t Identifier"><span class="i">IOException</span></span>(<span class="e String"><span class="sl">"Empty port name"</span></span>)</span>;</span></span></span>
            <span class="s If"><span class="k">if</span>(<span class="e Equal"><span class="e Index"><span class="e Identifier"><span class="i">file</span></span>[<span class="e Int"><span class="n">0</span></span>]</span> != <span class="e Char"><span class="cl">'/'</span></span></span>) <span class="s Scope"><span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">file</span></span> = <span class="e Cat"><span class="e String"><span class="sl">"/dev/"</span></span> ~ <span class="e Identifier"><span class="i">file</span></span></span></span>;</span></span></span>

            <span class="s If"><span class="k">if</span>(<span class="e AndAnd"><span class="e Rel"><span class="e Identifier"><span class="i">file</span></span>.<span class="e Identifier"><span class="i">length</span></span> &gt; <span class="e Int"><span class="n">5</span></span></span> &amp;&amp; <span class="e Equal"><span class="e Slice"><span class="e Identifier"><span class="i">file</span></span>[<span class="e Int"><span class="n">0</span></span>..<span class="e Int"><span class="n">5</span></span>]</span> == <span class="e String"><span class="sl">"/dev/"</span></span></span></span>)
                <span class="s Scope"><span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">str</span></span> = <span class="e Slice"><span class="e Identifier"><span class="i">file</span></span>[<span class="e Int"><span class="n">5</span></span>..<span class="e Dollar">$</span>]</span></span>;</span></span>
            <span class="k">else</span>
                <span class="s Scope"><span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">str</span></span> = <span class="e Cat"><span class="e String"><span class="sl">"SerialPort@"</span></span> ~ <span class="e Identifier"><span class="i">file</span></span></span></span>;</span></span></span>

            <span class="s Expression"><span class="e Assign"><span class="e Identifier"><span class="i">handle</span></span> = <span class="e Call"><span class="e Identifier"><span class="i">posix</span></span>.<span class="e Identifier"><span class="i">open</span></span>(<span class="i">file</span>.<span class="i">toStringz</span>(), <span class="i">O_RDWR</span> | <span class="i">O_NOCTTY</span> | <span class="i">O_NONBLOCK</span>)</span></span>;</span>
            <span class="s If"><span class="k">if</span>(<span class="e Equal"><span class="e Identifier"><span class="i">handle</span></span> == <span class="e Sign">-<span class="e Int"><span class="n">1</span></span></span></span>) <span class="s Scope"><span class="s Compound">{
                <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">error</span></span>()</span>;</span>
            }</span></span></span>
            <span class="s If"><span class="k">if</span>(<span class="e Equal"><span class="e Call"><span class="e Identifier"><span class="i">posix</span></span>.<span class="e Identifier"><span class="i">fcntl</span></span>(<span class="i">handle</span>, <span class="i">F_SETFL</span>, <span class="n">0</span>)</span> == <span class="e Sign">-<span class="e Int"><span class="n">1</span></span></span></span>) <span class="s Scope"><span class="s Compound">{ <span class="lc">// disable O_NONBLOCK</span>
                <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">error</span></span>()</span>;</span>
            }</span></span></span>

            <span class="s Declaration"><span class="d Variables"><span class="t Identifier"><span class="i">termios</span></span> <span class="i">options</span>;</span></span>
            <span class="s If"><span class="k">if</span>(<span class="e Equal"><span class="e Call"><span class="e Identifier"><span class="i">tcgetattr</span></span>(<span class="i">handle</span>, &amp;<span class="i">options</span>)</span> == <span class="e Sign">-<span class="e Int"><span class="n">1</span></span></span></span>) <span class="s Scope"><span class="s Compound">{
                <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">error</span></span>()</span>;</span>
            }</span></span></span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">cfsetispeed</span></span>(&amp;<span class="i">options</span>, <span class="i">B0</span>)</span>;</span> <span class="lc">// same as output baud rate</span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">cfsetospeed</span></span>(&amp;<span class="i">options</span>, <span class="i">B9600</span>)</span>;</span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">makeRaw</span></span>(&amp;<span class="i">options</span>)</span>;</span> <span class="lc">// disable echo and special characters</span>
            <span class="s Expression"><span class="e Call"><span class="e Identifier"><span class="i">tcsetattr</span></span>(<span class="i">handle</span>, <span class="i">TCSANOW</span>, &amp;<span class="i">options</span>)</span>;</span>
        }</span></span></span>

        <span class="d Protection"><span class="k">private</span></span> <span class="d Function"><span class="t Integral"><span class="k">void</span></span> <span class="i">makeRaw</span> <span class="o Parameters">(<span class="o Parameter"><span class="t Identifier"><span class="i">termios</span></span> <span class="t Pointer">*</span><span class="i">options</span></span>)</span>
        <span class="s FuncBody"><span class="s Compound">{
            <span class="s Expression"><span class="e AndAssign"><span class="e Identifier"><span class="i">options</span></span>.<span class="e Identifier"><span class="i">c_iflag</span></span> &amp;= <span class="e Comp">~<span class="e Paren">(<span class="e Or"><span class="e Or"><span class="e Or"><span class="e Or"><span class="e Or"><span class="e Or"><span class="e Or"><span class="e Identifier"><span class="i">IGNBRK</span></span> | <span class="e Identifier"><span class="i">BRKINT</span></span></span> | <span class="e Identifier"><span class="i">PARMRK</span></span></span> | <span class="e Identifier"><span class="i">ISTRIP</span></span></span>
                    | <span class="e Identifier"><span class="i">INLCR</span></span></span> | <span class="e Identifier"><span class="i">IGNCR</span></span></span> | <span class="e Identifier"><span class="i">ICRNL</span></span></span> | <span class="e Identifier"><span class="i">IXON</span></span></span>)</span></span></span>;</span>
            <span class="s Expression"><span class="e AndAssign"><span class="e Identifier"><span class="i">options</span></span>.<span class="e Identifier"><span class="i">c_oflag</span></span> &amp;= <span class="e Comp">~<span class="e Identifier"><span class="i">OPOST</span></span></span></span>;</span>
            <span class="s Expression"><span class="e AndAssign"><span class="e Identifier"><span class="i">options</span></span>.<span class="e Identifier"><span class="i">c_lflag</span></span> &amp;= <span class="e Comp">~<span class="e Paren">(<span class="e Or"><span class="e Or"><span class="e Or"><span class="e Or"><span class="e Identifier"><span class="i">ECHO</span></span> | <span class="e Identifier"><span class="i">ECHONL</span></span></span> | <span class="e Identifier"><span class="i">ICANON</span></span></span> | <span class="e Identifier"><span class="i">ISIG</span></span></span> | <span class="e Identifier"><span class="i">IEXTEN</span></span></span>)</span></span></span>;</span>
            <span class="s Expression"><span class="e AndAssign"><span class="e Identifier"><span class="i">options</span></span>.<span class="e Identifier"><span class="i">c_cflag</span></span> &amp;= <span class="e Comp">~<span class="e Paren">(<span class="e Or"><span class="e Identifier"><span class="i">CSIZE</span></span> | <span class="e Identifier"><span class="i">PARENB</span></span></span>)</span></span></span>;</span>
            <span class="s Expression"><span class="e OrAssign"><span class="e Identifier"><span class="i">options</span></span>.<span class="e Identifier"><span class="i">c_cflag</span></span> |= <span class="e Identifier"><span class="i">CS8</span></span></span>;</span>
        }</span></span></span>


        <span class="d Protection"><span class="k">private</span></span> <span class="d StorageClass"><span class="k">static</span></span> <span class="d Function"><span class="t Wild"><span class="k">inout</span>(<span class="k">char</span>)</span><span class="t Array">[]</span> <span class="i">rest</span> <span class="o Parameters">(<span class="o Parameter"><span class="t Wild"><span class="k">inout</span>(<span class="k">char</span>)</span><span class="t Array">[]</span> <span class="i">str</span></span>, <span class="o Parameter"><span class="k">in</span> <span class="t Integral"><span class="k">char</span></span><span class="t Array">[]</span> <span class="i">prefix</span></span>)</span> <span class="s FuncBody"><span class="s Compound">{
            <span class="s If"><span class="k">if</span>(<span class="e Rel"><span class="e Identifier"><span class="i">str</span></span>.<span class="e Identifier"><span class="i">length</span></span> &lt; <span class="e Identifier"><span class="i">prefix</span></span>.<span class="e Identifier"><span class="i">length</span></span></span>) <span class="s Scope"><span class="s Return"><span class="k">return</span> <span class="e Null"><span class="k">null</span></span>;</span></span></span>
            <span class="s If"><span class="k">if</span>(<span class="e Equal"><span class="e Slice"><span class="e Identifier"><span class="i">str</span></span>[<span class="e Int"><span class="n">0</span></span>..<span class="e Identifier"><span class="i">prefix</span></span>.<span class="e Identifier"><span class="i">length</span></span>]</span> != <span class="e Identifier"><span class="i">prefix</span></span></span>) <span class="s Scope"><span class="s Return"><span class="k">return</span> <span class="e Null"><span class="k">null</span></span>;</span></span></span>
            <span class="s Return"><span class="k">return</span> <span class="e Slice"><span class="e Identifier"><span class="i">str</span></span>[<span class="e Identifier"><span class="i">prefix</span></span>.<span class="e Identifier"><span class="i">length</span></span>..<span class="e Dollar">$</span>]</span>;</span>
        }</span></span></span>

        <span class="d Protection"><span class="k">private</span></span> <span class="d StorageClass"><span class="k">static</span></span> <span class="d Function"><span class="t Integral"><span class="k">bool</span></span> <span class="i">isInRange</span> <span class="o Parameters">(<span class="o Parameter"><span class="t Const"><span class="k">const</span>(<span class="t Integral"><span class="k">char</span></span>)</span><span class="t Array">[]</span> <span class="i">str</span></span>, <span class="o Parameter"><span class="t Integral"><span class="k">char</span></span> <span class="i">lower</span></span>, <span class="o Parameter"><span class="t Integral"><span class="k">char</span></span> <span class="i">upper</span></span>)</span> <span class="s FuncBody"><span class="s Compound">{
            <span class="s Foreach"><span class="k">foreach</span>(<span class="o Parameters"><span class="o Parameter"><span class="i">c</span></span></span>; <span class="e Identifier"><span class="i">str</span></span>) <span class="s Scope"><span class="s Compound">{
                <span class="s If"><span class="k">if</span>(<span class="e OrOr"><span class="e Rel"><span class="e Identifier"><span class="i">c</span></span> &lt; <span class="e Identifier"><span class="i">lower</span></span></span> || <span class="e Rel"><span class="e Identifier"><span class="i">c</span></span> &gt; <span class="e Identifier"><span class="i">upper</span></span></span></span>) <span class="s Scope"><span class="s Return"><span class="k">return</span> <span class="e Bool"><span class="k">false</span></span>;</span></span></span>
            }</span></span></span>
            <span class="s Return"><span class="k">return</span> <span class="e Bool"><span class="k">true</span></span>;</span>
        }</span></span></span>
    }</span></span>
}</span></span></span>


</pre></td>
</tr></table>
</body>
</html>