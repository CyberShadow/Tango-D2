<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>tango.sys.SharedLib</title>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  <!-- no favicon -->
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/utilities.js"></script>
  <script type="text/javascript" src="js/symbols.js"></script>
  <script type="text/javascript" src="js/modules.js"></script>
  <script type="text/javascript" src="js/quicksearch.js"></script>
  <script type="text/javascript" src="js/treeview.js"></script>
  <script type="text/javascript" src="js/navigation.js"></script>
</head>
<body id="tango.sys.SharedLib">
<div id="kandil-content">
<div class="module">
  <h1 class="module" id="m-tango.sys.SharedLib"><a href="htmlsrc/tango.sys.SharedLib.html" class="symbol">tango.sys.SharedLib</a></h1>

<div class="summary"><div class="cmnt">The shared library module provides a basic layer around the native functions
 used to load symbols from shared libraries.</div></div>
<p class="sec_header">License:</p><div class="cmnt">BSD style: see <a href="http://www.dsource.org/projects/tango/wiki/LibraryLicense">license.txt</a></div>
<p class="sec_header">Authors:</p><div class="cmnt">Tomasz Stachowiak, Anders Bergh</div>
<dl>
<dt class="decl"><span class="kw">class</span> <a class="symbol _class" name="SharedLib" href="htmlsrc/tango.sys.SharedLib.html#L87">SharedLib</a> <span class="attrs">[<span class="stc">final</span>]</span> <a href="tango.sys.SharedLib.html#SharedLib" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">SharedLib is an interface to system-specific shared libraries, such
    as ".dll", ".so" or ".dylib" files. It provides a simple interface to obtain
    symbol addresses (such as function pointers) from these libraries.</div></div>
<p class="sec_header">Example:</p><div class="cmnt"><table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex1" name="L1_ex1">1</a>
<a href="#L2_ex1" name="L2_ex1">2</a>
<a href="#L3_ex1" name="L3_ex1">3</a>
<a href="#L4_ex1" name="L4_ex1">4</a>
<a href="#L5_ex1" name="L5_ex1">5</a>
<a href="#L6_ex1" name="L6_ex1">6</a>
<a href="#L7_ex1" name="L7_ex1">7</a>
<a href="#L8_ex1" name="L8_ex1">8</a>
<a href="#L9_ex1" name="L9_ex1">9</a>
<a href="#L10_ex1" name="L10_ex1">10</a>
<a href="#L11_ex1" name="L11_ex1">11</a>
<a href="#L12_ex1" name="L12_ex1">12</a>
<a href="#L13_ex1" name="L13_ex1">13</a>
<a href="#L14_ex1" name="L14_ex1">14</a>
<a href="#L15_ex1" name="L15_ex1">15</a>
<a href="#L16_ex1" name="L16_ex1">16</a>
<a href="#L17_ex1" name="L17_ex1">17</a>
<a href="#L18_ex1" name="L18_ex1">18</a>
<a href="#L19_ex1" name="L19_ex1">19</a>
<a href="#L20_ex1" name="L20_ex1">20</a>
</pre></td><td class="d_codetext"><pre>

<span class="k">void</span> <span class="i">main</span>() {
    <span class="k">if</span> (<span class="k">auto</span> <span class="i">lib</span> = <span class="i">SharedLib</span>.<span class="i">load</span>(<span class="sl">`c:\windows\system32\opengl32.dll`</span>)) {
        <span class="i">Trace</span>.<span class="i">formatln</span>(<span class="sl">"Library successfully loaded"</span>);

        <span class="k">void</span>* <span class="i">ptr</span> = <span class="i">lib</span>.<span class="i">getSymbol</span>(<span class="sl">"glClear"</span>);
        <span class="k">if</span> (<span class="i">ptr</span>) {
            <span class="i">Trace</span>.<span class="i">formatln</span>(<span class="sl">"Symbol glClear found. Address = 0x{:x}"</span>, <span class="i">ptr</span>);
        } <span class="k">else</span> {
            <span class="i">Trace</span>.<span class="i">formatln</span>(<span class="sl">"Symbol glClear not found"</span>);
        }

        <span class="i">lib</span>.<span class="i">unload</span>();
    } <span class="k">else</span> {
        <span class="i">Trace</span>.<span class="i">formatln</span>(<span class="sl">"Could not load the library"</span>);
    }

    <span class="k">assert</span> (<span class="n">0</span> == <span class="i">SharedLib</span>.<span class="i">numLoadedLibs</span>);
}
</pre>
</td></tr>
</table>
<p class="bl"></p>
    This implementation uses reference counting, thus a library is not loaded
    again if it has been loaded before and not unloaded by the user.
    Unloading a SharedLib decreases its reference count. When it reaches 0,
    the shared library associated with it is unloaded and the SharedLib instance
    is deleted. Please do not delete SharedLib instances manually, unload() will
    take care of it.</div>
<p class="sec_header">Note:</p><div class="cmnt">SharedLib is thread-safe.</div>
<dl>
<dt class="decl"><span class="kw">enum</span> <a class="symbol _enum" name="SharedLib.LoadMode" href="htmlsrc/tango.sys.SharedLib.html#L89">LoadMode</a> <a href="tango.sys.SharedLib.html#SharedLib.LoadMode" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Mapped from RTLD_NOW, RTLD_LAZY, RTLD_GLOBAL and RTLD_LOCAL</div></div>
</dd>
<dt class="decl"><span class="rettyp">SharedLib</span> <a class="symbol _function" name="SharedLib.load" href="htmlsrc/tango.sys.SharedLib.html#L111">load</a><span class="params">(const(char)[] <em>path</em>, LoadMode <em>mode</em> = <span class="defval"><span class="i">LoadMode</span>.<span class="i">Now</span> | <span class="i">LoadMode</span>.<span class="i">Global</span></span>)</span> <span class="attrs">[<span class="stc">static</span>]</span> <a href="tango.sys.SharedLib.html#SharedLib.load" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Loads an OS-specific shared library.</div></div>
<p class="sec_header">Note:</p><div class="cmnt">Please use this function instead of the constructor, which is private.</div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>path</em></td><td>The path to a shared library to be loaded</td></tr>
<tr><td><em>mode</em></td><td>Library loading mode. See LoadMode</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">A SharedLib instance being a handle to the library, or throws
            SharedLibException if it could not be loaded</div></dd>
<dt class="decl"><span class="rettyp">SharedLib</span> <a class="symbol _function" name="SharedLib.loadNoThrow" href="htmlsrc/tango.sys.SharedLib.html#L131">loadNoThrow</a><span class="params">(const(char)[] <em>path</em>, LoadMode <em>mode</em> = <span class="defval"><span class="i">LoadMode</span>.<span class="i">Now</span> | <span class="i">LoadMode</span>.<span class="i">Global</span></span>)</span> <span class="attrs">[<span class="stc">static</span>]</span> <a href="tango.sys.SharedLib.html#SharedLib.loadNoThrow" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Loads an OS-specific shared library.</div></div>
<p class="sec_header">Note:</p><div class="cmnt">Please use this function instead of the constructor, which is private.</div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>path</em></td><td>The path to a shared library to be loaded</td></tr>
<tr><td><em>mode</em></td><td>Library loading mode. See LoadMode</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">A SharedLib instance being a handle to the library, or null if it
            could not be loaded</div></dd>
<dt class="decl"><span class="rettyp">void</span> <a class="symbol _function" name="SharedLib.unload" href="htmlsrc/tango.sys.SharedLib.html#L208">unload</a><span class="params">()</span> <a href="tango.sys.SharedLib.html#SharedLib.unload" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Unloads the OS-specific shared library associated with this SharedLib instance.</div></div>
<p class="sec_header">Note:</p><div class="cmnt">It's invalid to use the object after unload() has been called, as unload()
        will delete it if it's not referenced any more.
<p class="bl"></p>
        Throws SharedLibException on failure. In this case, the SharedLib object is not deleted.</div></dd>
<dt class="decl"><span class="rettyp">void</span> <a class="symbol _function" name="SharedLib.unloadNoThrow" href="htmlsrc/tango.sys.SharedLib.html#L220">unloadNoThrow</a><span class="params">()</span> <a href="tango.sys.SharedLib.html#SharedLib.unloadNoThrow" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Unloads the OS-specific shared library associated with this SharedLib instance.</div></div>
<p class="sec_header">Note:</p><div class="cmnt">It's invalid to use the object after unload() has been called, as unload()
        will delete it if it's not referenced any more.</div></dd>
<dt class="decl"><span class="rettyp">const(char)[]</span> <a class="symbol _function" name="SharedLib.path" href="htmlsrc/tango.sys.SharedLib.html#L259">path</a><span class="params">()</span> <span class="attrs">[<span class="stc">@property</span>]</span> <a href="tango.sys.SharedLib.html#SharedLib.path" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Returns the path to the OS-specific shared library associated with this object.</div></div></dd>
<dt class="decl"><span class="rettyp">void*</span> <a class="symbol _function" name="SharedLib.getSymbol" href="htmlsrc/tango.sys.SharedLib.html#L274">getSymbol</a><span class="params">(const(char)* <em>name</em>)</span> <a href="tango.sys.SharedLib.html#SharedLib.getSymbol" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Obtains the address of a symbol within the shared library</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>name</em></td><td>The name of the symbol; must be a null-terminated C string</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">A pointer to the symbol or throws SharedLibException if it's
            not present in the library.</div></dd>
<dt class="decl"><span class="rettyp">void*</span> <a class="symbol _function" name="SharedLib.getSymbolNoThrow" href="htmlsrc/tango.sys.SharedLib.html#L288">getSymbolNoThrow</a><span class="params">(const(char)* <em>name</em>)</span> <a href="tango.sys.SharedLib.html#SharedLib.getSymbolNoThrow" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Obtains the address of a symbol within the shared library</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>name</em></td><td>The name of the symbol; must be a null-terminated C string</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">A pointer to the symbol or null if it's not present in the library.</div></dd>
<dt class="decl"><span class="rettyp">uint</span> <a class="symbol _function" name="SharedLib.numLoadedLibs" href="htmlsrc/tango.sys.SharedLib.html#L303">numLoadedLibs</a><span class="params">()</span> <span class="attrs">[<span class="stc">static</span>]</span> <a href="tango.sys.SharedLib.html#SharedLib.numLoadedLibs" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Returns the total number of libraries currently loaded by SharedLib</div></div></dd></dl></dd></dl>
</div>
<div id="kandil-footer">
  <p>Copyright (C) 2007 Tomasz Stachowiak</p>
  <p>Page generated by <a href="http://code.google.com/p/dil">DIL</a> on Mon May  7 18:12:31 2012. Rendered by <a href="http://code.google.com/p/dil/wiki/Kandil">Kandil</a>.</p>
</div>
</div>
</body>
</html>